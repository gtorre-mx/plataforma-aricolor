<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>INTEL·ARICOLOR·MX - Centro de Inteligencia Comercial</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --aricolor-blue: #0033CC;
            --aricolor-light-blue: #6BB6FF;
            --primary: #0033CC;
            --secondary: #1a4d9e;
            --accent: #6BB6FF;
            --bg-white: #FFFFFF;
            --bg-light: #F8F9FA;
            --text-dark: #2C3E50;
            --text-muted: #6C757D;
            --border: #E0E0E0;
            --shadow: rgba(0, 0, 0, 0.08);
            --success: #28A745;
            --warning: #FFC107;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            -webkit-tap-highlight-color: transparent; /* Quita highlight azul en iOS */
            touch-action: manipulation; /* Mejora respuesta táctil */
        }

        /* Franja multicolor ARICOLOR */
        .rainbow-bar {
            height: 12px;
            background-image: url('franja.jpg');
            background-size: 100% 100%;
            background-position: center;
            background-repeat: repeat-x;
            width: 100%;
        }

        .app-container {
            position: relative;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0;
            background: var(--bg-white);
            min-height: 100vh;
            box-shadow: 0 0 40px var(--shadow);
            background-image: 
                linear-gradient(to bottom, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.7)),
                url('masterazul.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        .header {
            background: white;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo-container {
            height: 50px;
            display: flex;
            align-items: center;
        }

        .logo-container img {
            height: 100%;
            width: auto;
            object-fit: contain;
        }

        .header h1 {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--aricolor-blue);
            margin: 0;
            letter-spacing: -0.02em;
        }

        .header-subtitle {
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-muted);
            font-size: 0.85rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            margin-top: 0.25rem;
        }
        }

        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: var(--bg-white);
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .nav-tab {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-white);
            border: 2px solid var(--border);
            color: var(--text-muted);
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .nav-tab:hover {
            border-color: var(--aricolor-blue);
            color: var(--aricolor-blue);
            background: rgba(0, 51, 204, 0.05);
        }

        .nav-tab.active {
            background: var(--aricolor-blue);
            border-color: var(--aricolor-blue);
            color: white;
        }

        .content-panel {
            background: var(--bg-light);
            padding: 2rem;
            min-height: 600px;
        }

        .search-container {
            position: relative;
            margin-bottom: 2rem;
        }

        .filters-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .filter-group {
            flex: 1;
            position: relative;
        }

        .filter-group-narrow {
            flex: 0 0 200px;
        }

        .search-input {
            width: 100%;
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 1rem 1.25rem 1rem 3rem;
            color: var(--text-dark);
            font-size: 1rem;
            font-family: 'Outfit', sans-serif;
            transition: all 0.2s ease;
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--aricolor-blue);
            box-shadow: 0 0 0 3px rgba(0, 51, 204, 0.1);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent);
            font-size: 1.2rem;
        }

        .btn {
            background: var(--aricolor-blue);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            font-family: 'Outfit', sans-serif;
        }

        .btn:hover {
            background: var(--secondary);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px var(--shadow);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-white);
            border: 2px solid var(--aricolor-blue);
            color: var(--aricolor-blue);
        }

        .btn-secondary:hover {
            background: rgba(0, 51, 204, 0.05);
        }

        .setup-panel {
            max-width: 700px;
            margin: 3rem auto;
            text-align: center;
        }

        .setup-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--aricolor-blue);
            font-weight: 700;
        }

        .setup-description {
            color: var(--text-muted);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .input-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .input-label {
            display: block;
            color: var(--aricolor-blue);
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .input-field {
            width: 100%;
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: 6px;
            padding: 0.875rem;
            color: var(--text-dark);
            font-size: 0.95rem;
            font-family: 'Outfit', sans-serif;
            transition: all 0.2s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--aricolor-blue);
            box-shadow: 0 0 0 3px rgba(0, 51, 204, 0.1);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: linear-gradient(135deg, #003399 0%, #6BB6FF 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px var(--shadow);
            color: white;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 51, 153, 0.4);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: white;
        }

        .card-title-bar {
            height: 6px;
            background-image: url('franja.jpg');
            background-size: 100% 100%;
            background-position: center;
            background-repeat: repeat-x;
            margin-bottom: 1rem;
            border-radius: 2px;
            mix-blend-mode: multiply;
            opacity: 0.8;
        }

        .card-subtitle {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
        }

        .card .info-row {
            display: flex;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: white;
            margin-bottom: 0.5rem;
        }
        
        .card .info-label {
            color: rgba(255, 255, 255, 0.8);
        }

        .info-row {
            display: flex;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .info-label {
            font-weight: 600;
            color: var(--aricolor-blue);
            min-width: 90px;
        }

        .detail-panel {
            background: var(--bg-white);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .detail-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--aricolor-blue);
            margin-bottom: 0.5rem;
        }

        .detail-subtitle {
            color: var(--text-muted);
            font-size: 1rem;
        }
            margin-bottom: 2rem;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .detail-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .detail-subtitle {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .section-title {
            font-size: 1.1rem;
            color: var(--aricolor-blue);
            font-weight: 700;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border);
        }

        .status-badge {
            display: inline-block;
            padding: 0.35rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-activo {
            background: #E8F5E9;
            color: #2E7D32;
            border: 1px solid #81C784;
        }

        .status-inactivo {
            background: #FFEBEE;
            color: #C62828;
            border: 1px solid #EF5350;
        }
        
        .status-cerrado {
            background: #E0E0E0;
            color: #424242;
            border: 1px solid #9E9E9E;
        }

        .asana-panel {
            background: rgba(10, 22, 40, 0.4);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .asana-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .asana-stat {
            text-align: center;
            padding: 1rem;
            background: rgba(26, 41, 66, 0.5);
            border-radius: 8px;
        }

        .asana-stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            font-family: 'IBM Plex Mono', monospace;
        }

        .asana-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.25rem;
        }

        .task-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .task-item {
            background: rgba(26, 41, 66, 0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
        }

        .task-item:hover {
            background: rgba(26, 41, 66, 0.5);
            border-color: var(--accent);
        }

        .task-name {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .task-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .config-panel {
            background: rgba(26, 41, 66, 0.5);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .config-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .config-row:last-child {
            border-bottom: none;
        }

        .config-label {
            font-weight: 600;
            color: var(--text);
        }

        .config-value {
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.9rem;
        }

        .product-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background: var(--bg-white);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .product-table th {
            background: #F5F7FA;
            color: var(--aricolor-blue);
            padding: 1rem 0.75rem;
            text-align: left;
            font-size: 0.85rem;
            font-weight: 700;
            border-bottom: 2px solid var(--border);
        }

        .product-table td {
            padding: 0.875rem 0.75rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-dark);
        }

        .product-table tr:hover {
            background: rgba(0, 51, 204, 0.02);
        }

        .price-cell {
            color: var(--aricolor-blue);
            font-weight: 700;
        }

        .doc-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .doc-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.4rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: white;
        }

        .doc-btn-ht {
            background: #2196F3;
        }

        .doc-btn-ht:hover {
            background: #1976D2;
        }

        .doc-btn-hds {
            background: #FF9800;
        }

        .doc-btn-hds:hover {
            background: #F57C00;
        }

        .doc-btn-email {
            background: #4CAF50;
        }

        .doc-btn-email:hover {
            background: #388E3C;
        }

        .doc-btn-whatsapp {
            background: #25D366;
        }

        .doc-btn-whatsapp:hover {
            background: #128C7E;
        }

        .doc-btn-unavailable {
            background: #BDBDBD;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .doc-btn-unavailable:hover {
            background: #BDBDBD;
        }

        /* Componente de visualización de color */
        .color-swatch {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.6rem;
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .color-box {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 1px solid var(--border);
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);
        }

        .color-info {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .color-label {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.7rem;
        }

        .color-code {
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.65rem;
        }

        .no-color {
            color: var(--text-muted);
            font-size: 0.75rem;
            font-style: italic;
        }

        /* Botón de llamar */
        .call-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--success);
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 2;
        }

        .call-btn:hover {
            background: #218838;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .call-btn:active {
            transform: scale(0.95);
        }

        .call-btn-disabled {
            background: #BDBDBD;
            cursor: not-allowed;
        }

        .call-btn-disabled:hover {
            background: #BDBDBD;
            transform: none;
        }

        .card {
            position: relative;
        }

        /* Modal de color */
        .color-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .color-modal {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .color-modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .color-modal-close:hover {
            background: var(--bg-light);
            color: var(--text-dark);
        }

        .color-modal-swatch {
            width: 100%;
            height: 200px;
            border-radius: 8px;
            border: 2px solid var(--border);
            margin-bottom: 1.5rem;
            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1);
        }

        .color-modal-info {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .color-modal-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: var(--bg-light);
            border-radius: 6px;
        }

        .color-modal-label {
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .color-modal-value {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.1rem;
            color: var(--aricolor-blue);
            font-weight: 600;
        }

        .color-swatch {
            cursor: pointer;
            transition: all 0.2s;
        }

        .color-swatch:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        /* Cuaderno de notas */
        .nota-form {
            background: var(--bg-white);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .nota-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            margin-bottom: 1rem;
            background: var(--bg-white);
            cursor: pointer;
        }

        .nota-textarea {
            width: 100%;
            min-height: 120px;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.95rem;
            resize: vertical;
            margin-bottom: 1rem;
        }

        .nota-item {
            background: var(--bg-white);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--aricolor-blue);
        }

        .nota-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .nota-cliente {
            font-weight: 600;
            color: var(--aricolor-blue);
            font-size: 1.1rem;
        }

        .nota-fecha {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .nota-texto {
            color: var(--text-dark);
            line-height: 1.6;
            white-space: pre-wrap;
        }

        /* Pantalla de login */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #1a2942 0%, #2d4a6e 50%, #1a2942 100%);
            background-image: url('masterazul.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .login-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to right, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.3) 50%, rgba(255, 255, 255, 0.85) 100%);
            z-index: 1;
        }
        
        
        .login-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to right, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.3) 50%, rgba(255, 255, 255, 0.85) 100%);
            z-index: 1;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 3rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .login-logo {
            width: 120px;
            margin-bottom: 1.5rem;
        }

        .login-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--aricolor-blue);
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: var(--text-muted);
            margin-bottom: 2rem;
            font-size: 0.95rem;
        }

        .login-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            margin-bottom: 1rem;
            font-family: 'Outfit', sans-serif;
            transition: border-color 0.2s;
        }

        .login-input:focus {
            outline: none;
            border-color: var(--aricolor-blue);
        }

        .login-btn {
            width: 100%;
            padding: 0.75rem;
            background: var(--aricolor-blue);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Outfit', sans-serif;
        }

        .login-btn:hover {
            background: var(--secondary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 51, 204, 0.3);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        /* Launcher Home Screen */
        .launcher-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('masterazul.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9998;
        }

        .launcher-overlay::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to right, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.3) 50%, rgba(255, 255, 255, 0.85) 100%);
            z-index: 1;
        }

        .launcher-container {
            position: relative;
            z-index: 2;
            text-align: center;
            max-width: 1200px;
            width: 90%;
            padding: 3rem;
        }

        .launcher-header {
            margin-bottom: 4rem;
        }

        .launcher-logo {
            width: 140px;
            margin-bottom: 1.5rem;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
        }

        .launcher-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--aricolor-blue);
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(255, 255, 255, 0.8);
        }

        .launcher-subtitle {
            color: var(--text-muted);
            font-size: 1.1rem;
            font-weight: 500;
        }

        .launcher-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 2rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .launcher-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .launcher-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(0, 51, 204, 0.2);
            border-color: var(--aricolor-blue);
            background: rgba(255, 255, 255, 0.98);
        }

        .launcher-card:active {
            transform: translateY(-4px);
        }

        .launcher-icon {
            width: 64px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--aricolor-blue) 0%, var(--secondary) 100%);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 51, 204, 0.25);
            transition: transform 0.3s;
        }

        .launcher-card:hover .launcher-icon {
            transform: scale(1.1);
        }

        .launcher-icon svg {
            width: 32px;
            height: 32px;
            fill: white;
        }

        .launcher-label {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .launcher-description {
            font-size: 0.85rem;
            color: var(--text-muted);
            line-height: 1.3;
        }

        /* ============================================
           RESPONSIVE - OPTIMIZACIÓN MÓVIL COMPLETA
           ============================================ */
        
        @media (max-width: 768px) {
            /* LAUNCHER */
            .launcher-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .launcher-card {
                padding: 1.5rem 1rem;
            }
            
            .launcher-icon {
                width: 56px;
                height: 56px;
            }
            
            .launcher-icon svg {
                width: 28px;
                height: 28px;
            }

            .launcher-title {
                font-size: 1.8rem;
            }
            
            .launcher-label {
                font-size: 0.9rem;
            }
            
            .launcher-description {
                font-size: 0.75rem;
            }

            /* HEADER */
            .header {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .header-subtitle {
                font-size: 0.75rem;
            }
            
            .header-content {
                flex-wrap: wrap;
                gap: 0.75rem;
            }
            
            .logo-container {
                height: 35px;
            }
            
            /* Ocultar elementos secundarios en móvil */
            .header-content > div:nth-child(3) {
                display: none !important; /* Oculta reloj */
            }

            /* NAVEGACIÓN */
            .nav-tabs {
                overflow-x: auto;
                overflow-y: hidden;
                flex-wrap: nowrap;
                gap: 0.5rem;
                padding-bottom: 0.5rem;
                -webkit-overflow-scrolling: touch;
            }
            
            .nav-tab {
                flex-shrink: 0;
                min-width: auto;
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                white-space: nowrap;
            }

            /* CONTENIDO */
            .app-container {
                padding: 0.5rem;
            }
            
            .content-panel {
                padding: 0.75rem;
            }
            
            .detail-panel {
                padding: 0.75rem;
            }

            /* GRIDS */
            .grid,
            [style*="gridTemplateColumns"] {
                grid-template-columns: 1fr !important;
            }

            /* KPIs - TARJETAS */
            .kpi-card,
            [style*="border: '1px solid var(--border)"] {
                margin-bottom: 1rem;
            }

            /* GRÁFICAS */
            [style*="height: '280px'"],
            [style*="height: '330px'"] {
                height: 220px !important;
            }
            
            /* Gráficas comparativas lado a lado → apiladas */
            div[style*="gridTemplateColumns: '1fr 1fr'"] {
                grid-template-columns: 1fr !important;
            }

            /* TABLAS */
            .client-table,
            .product-table,
            table {
                font-size: 0.85rem;
                overflow-x: auto;
                display: block;
            }
            
            .client-table th,
            .product-table th,
            table th {
                padding: 0.5rem;
                font-size: 0.75rem;
            }
            
            .client-table td,
            .product-table td,
            table td {
                padding: 0.5rem;
                font-size: 0.8rem;
            }

            /* BOTONES */
            .btn-update-colors,
            button {
                min-height: 44px; /* Touch target mínimo */
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }

            /* INPUTS */
            input,
            select,
            textarea {
                min-height: 44px;
                font-size: 16px; /* Evita zoom en iOS */
            }

            /* MODAL */
            .modal-content {
                width: 95%;
                max-height: 90vh;
                overflow-y: auto;
            }

            /* VENDEDORES - Lista más compacta */
            [style*="Desempeño por Vendedor"] + div > div {
                padding: 0.5rem !important;
                gap: 0.5rem !important;
            }

            /* DOCUMENTOS */
            [style*="gridTemplateColumns: 'repeat(auto-fill"] {
                grid-template-columns: 1fr !important;
            }

            /* BÚSQUEDA */
            .search-input {
                font-size: 16px;
                width: 100%;
            }

            /* MAPS */
            .maps-container {
                height: 400px !important;
            }

            /* NOTIFICACIONES */
            .notification-item {
                padding: 0.75rem;
            }

            /* LOGIN */
            .login-box {
                padding: 2rem 1.5rem;
                width: 95%;
            }
            
            .login-title {
                font-size: 1.5rem;
            }

            /* Esconder scroll horizontal */
            body {
                overflow-x: hidden;
            }
            
            /* Ajustar texto en gráficas */
            [style*="fontSize: '0.85rem'"] {
                font-size: 0.75rem !important;
            }
        }

        /* Para pantallas muy pequeñas (<480px) */
        @media (max-width: 480px) {
            .launcher-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .launcher-card {
                flex-direction: row;
                padding: 1rem;
            }
            
            .launcher-icon {
                width: 48px;
                height: 48px;
            }
            
            .header h1 {
                font-size: 1rem;
            }
            
            .nav-tab {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
            
            /* Botón inicio más pequeño */
            button[style*="Inicio"] {
                padding: 0.4rem 0.75rem !important;
                font-size: 0.8rem !important;
            }
        }

        .scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar::-webkit-scrollbar-track {
            background: rgba(26, 41, 66, 0.3);
            border-radius: 4px;
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        .scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--accent-warm);
        }

        /* Ventana flotante de notas */
        .notas-float-button {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--aricolor-blue), var(--aricolor-light-blue));
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 51, 204, 0.4);
            transition: all 0.3s;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notas-float-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 30px rgba(0, 51, 204, 0.6);
        }

        .notas-float-window {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 450px;
            max-height: 600px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .notas-float-header {
            background: linear-gradient(135deg, var(--aricolor-blue), var(--aricolor-light-blue));
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .notas-float-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .notas-float-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .notas-float-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }

        /* Notificaciones y Menciones */
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 700;
            padding: 0 6px;
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .notifications-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }

        .notification-item {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px var(--shadow);
            border-left: 4px solid var(--accent);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .notification-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .notification-item.unread {
            background: #f0f9ff;
            border-left-color: var(--primary);
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .notification-from {
            font-weight: 600;
            color: var(--primary);
        }

        .notification-date {
            font-size: 12px;
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
        }

        .notification-content {
            color: var(--text-dark);
            line-height: 1.6;
        }

        .mention-highlight {
            background: #fef3c7;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
            color: var(--primary);
        }

        .mark-read-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .mark-read-btn:hover {
            background: #22c55e;
        }

        .no-notifications {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .no-notifications-icon {
            font-size: 64px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .nav-tab-with-badge {
            position: relative;
        }

        .btn-update-colors {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-update-colors:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 51, 204, 0.3);
        }

        .btn-update-colors:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .update-status {
            margin-top: 1rem;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
        }

        .update-status.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }

        .update-status.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .update-status.loading {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        /* Autocomplete de Menciones */
        .mention-autocomplete {
            position: absolute;
            background: white;
            border: 2px solid var(--primary);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            min-width: 200px;
        }

        .mention-option {
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .mention-option:hover,
        .mention-option.selected {
            background: #f0f9ff;
            color: var(--primary);
        }

        .mention-option .user-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            font-weight: 600;
        }

        .mention-option .user-name {
            font-weight: 500;
        }

        .mention-in-text {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
            color: var(--primary);
            border: 1px solid #fbbf24;
        }

        .textarea-with-mentions {
            position: relative;
        }

        /* Dashboard de Ventas */
        .sales-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .sales-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px var(--shadow);
            border-left: 4px solid var(--primary);
        }

        .sales-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .sales-card-title {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
        }

        .sales-card-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
            font-family: 'IBM Plex Mono', monospace;
        }

        .sales-card-subtitle {
            font-size: 13px;
            color: var(--text-muted);
            margin-top: 0.5rem;
        }

        .vendor-assignment {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .vendor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
            margin-bottom: 1rem;
        }

        .vendor-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }

        .vendor-stats {
            display: flex;
            gap: 1.5rem;
            font-size: 13px;
        }

        .vendor-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .vendor-stat-value {
            font-weight: 700;
            font-size: 20px;
            color: var(--primary);
        }

        .vendor-stat-label {
            color: var(--text-muted);
            font-size: 11px;
            text-transform: uppercase;
        }

        .client-tag {
            display: inline-block;
            background: var(--bg-light);
            padding: 6px 12px;
            border-radius: 6px;
            margin: 4px;
            font-size: 13px;
            border: 1px solid var(--border);
        }

        .client-tag:hover {
            background: #e3f2fd;
            border-color: var(--accent);
        }

        /* Estilos compactos para asignación de vendedores */
        .vendor-assignment-compact {
            background: white;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px var(--shadow);
            overflow: hidden;
            transition: all 0.2s;
        }

        .vendor-assignment-compact:hover {
            box-shadow: 0 4px 12px var(--shadow);
        }

        .vendor-header-clickable {
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s;
        }

        .vendor-header-clickable:hover {
            background: var(--bg-light);
        }

        .vendor-clients-list {
            border-top: 1px solid var(--border-color);
            padding: 0;
            animation: slideDown 0.2s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 1000px;
            }
        }

        .btn-icon-small {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-icon-small:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-action-small {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-action-small:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-action-small-danger {
            background: white;
            color: var(--danger);
            border: 1px solid var(--danger);
            border-radius: 6px;
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-action-small-danger:hover {
            background: var(--danger);
            color: white;
        }

        /* Geolocalización */
        .geo-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px var(--shadow);
            margin-bottom: 1.5rem;
        }

        .checkin-button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkin-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        .checkout-button {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .checkout-button:hover {
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
        }

        .visit-button {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            padding: 12px 24px;
            font-size: 14px;
        }

        .geo-status {
            background: #f0fdf4;
            border: 2px solid #86efac;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .geo-status.inactive {
            background: #fef2f2;
            border-color: #fca5a5;
        }

        .geo-record {
            background: var(--bg-light);
            border-left: 4px solid var(--success);
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 6px;
        }

        .geo-record.checkout {
            border-left-color: #ef4444;
        }

        .geo-record.visit {
            border-left-color: #3b82f6;
        }

        .geo-time {
            font-family: 'IBM Plex Mono', monospace;
            font-weight: 600;
            color: var(--primary);
        }

        .geo-coords {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .btn-assign-client {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-assign-client:hover {
            background: var(--primary);
        }

        .ranking-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            box-shadow: 0 2px 4px var(--shadow);
        }

        .ranking-position {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .ranking-position.first {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }

        .ranking-position.second {
            background: linear-gradient(135deg, #9ca3af 0%, #6b7280 100%);
        }

        .ranking-position.third {
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
        }

        /* Mapa de Clientes */
        .map-container {
            width: 100%;
            height: 600px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px var(--shadow);
            margin-bottom: 1.5rem;
        }

        .map-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .map-filter-btn {
            padding: 10px 20px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .map-filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .map-filter-btn:hover {
            border-color: var(--primary);
        }

        .map-legend {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #333;
        }

        .vendor-initials {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 11px;
            font-weight: 700;
            margin-left: 8px;
        }
        
        /* Estilos para Leaflet */
        .leaflet-container {
            font-family: 'Outfit', sans-serif;
        }
    </style>
    
    <!-- Leaflet para mapa interactivo -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [activeTab, setActiveTab] = useState('clientes');
            const [isConfigured, setIsConfigured] = useState(false);
            const [csvUrl, setCsvUrl] = useState('');
            const [asanaToken, setAsanaToken] = useState('');
            const [clientes, setClientes] = useState([]);
            const [selectedCliente, setSelectedCliente] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [cpFilter, setCpFilter] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [asanaData, setAsanaData] = useState(null);
            const [productos, setProductos] = useState([]);
            const [coloresRef, setColoresRef] = useState({});
            const [colorModal, setColorModal] = useState(null);
            const [notas, setNotas] = useState([]);
            const [notasFloatOpen, setNotasFloatOpen] = useState(false);
            const [nuevaNota, setNuevaNota] = useState({ cliente: '', texto: '' });
            const [notificaciones, setNotificaciones] = useState([]);
            const [comprasMensuales, setComprasMensuales] = useState({});
            const [updateColorsStatus, setUpdateColorsStatus] = useState(null);
            const [mentionAutocomplete, setMentionAutocomplete] = useState({ show: false, users: [], selected: 0, position: { top: 0, left: 0 } });
            const textareaRef = React.useRef(null);
            
            // Estados para ventas
            const [asignacionesVendedor, setAsignacionesVendedor] = useState({});
            const [editingVendor, setEditingVendor] = useState(null);
            
            // Mapeo de vendedores a iniciales
            const vendedorIniciales = {
                'Germán': 'GTM',
                'Martín': 'MZC',
                'Angélica': 'APQ',
                'Luis Fernando': 'LFM'
            };

            // Colores distintivos por vendedor
            const vendedorColores = {
                'Germán': '#10b981',      // Verde
                'Martín': '#3b82f6',      // Azul
                'Angélica': '#ef4444',    // Rojo
                'Luis Fernando': '#f97316' // Naranja
            };

            // Mapeo inverso: iniciales -> nombre completo (para alimentar desde CSV)
            const inicialesVendedor = {
                'GTM': 'Germán',
                'MZC': 'Martín',
                'APQ': 'Angélica',
                'LFM': 'Luis Fernando'
            };

            // Datos de contacto de vendedores
            const vendedorContacto = {
                'Germán': {
                    email: 'gtorre@aricolor.com',
                    celular: '5528981399',
                    nombre: 'Germán Torre',
                    iniciales: 'GTM'
                },
                'Martín': {
                    email: 'mzamorano@aricolor.com',
                    celular: '5522540674',
                    nombre: 'Martín Zamorano',
                    iniciales: 'MZC'
                },
                'Angélica': {
                    email: 'apacheco@aricolor.com',
                    celular: '5591990282',
                    nombre: 'Angélica Pacheco',
                    iniciales: 'APQ'
                },
                'Luis Fernando': {
                    email: 'lmiranda@aricolor.com',
                    celular: '5548732024',
                    nombre: 'Luis Fernando Miranda',
                    iniciales: 'LFM'
                }
            };
            
            // Estados para geolocalización
            const [geoRecords, setGeoRecords] = useState([]);
            const [currentStatus, setCurrentStatus] = useState(null); // 'checkin', 'checkout', null
            const [visitingClient, setVisitingClient] = useState(null);
            const [clientesCoordenadas, setClientesCoordenadas] = useState({});
            const [vendedorModal, setVendedorModal] = useState(null);
            const [vendedoresExpandidos, setVendedoresExpandidos] = useState({});
            const [filtroClientesVentas, setFiltroClientesVentas] = useState('');
            const [filterVendedorMaps, setFilterVendedorMaps] = useState('todos');
            const [geocodificando, setGeocodificando] = useState(false);
            const [progresoGeo, setProgresoGeo] = useState({ actual: 0, total: 0 });
            const [clienteMencionModal, setClienteMencionModal] = useState(null);
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [showLauncher, setShowLauncher] = useState(true); // Pantalla de inicio
            const [passwordInput, setPasswordInput] = useState('');
            const [currentUser, setCurrentUser] = useState(null);
            const [currentTime, setCurrentTime] = useState(new Date());
            const [ipWhitelist, setIpWhitelist] = useState([]);
            
            // Estados para Búsqueda IA
            const [iaQuery, setIaQuery] = useState('');
            const [iaResults, setIaResults] = useState(null);
            const [iaSearching, setIaSearching] = useState(false);
            const [newIp, setNewIp] = useState('');
            const [usuarios, setUsuarios] = useState({});
            const [nuevoUsuario, setNuevoUsuario] = useState({ nombre: '', password: '' });
            const [currentIp, setCurrentIp] = useState(null);
            const [clientesModalColor, setClientesModalColor] = useState(null); // Modal para mostrar clientes por color

            // Cargar referencia de colores
            useEffect(() => {
                // Verificar si ya está autenticado
                const savedAuth = localStorage.getItem('aricolor_auth');
                const savedUser = localStorage.getItem('aricolor_user');
                if (savedAuth === 'authenticated' && savedUser) {
                    setIsAuthenticated(true);
                    setCurrentUser(savedUser);
                }

                // Cargar whitelist de IPs con valores compartidos predeterminados
                const savedWhitelist = localStorage.getItem('aricolor_ip_whitelist');
                const sharedWhitelistKey = 'aricolor_shared_whitelist'; // Key compartida
                
                // IP predeterminada de Martín
                const ipMartinDefault = '2806:2f0:ad41:e859:e9ae:b657:18f2:c83a';
                
                if (savedWhitelist) {
                    try {
                        const localList = JSON.parse(savedWhitelist);
                        // Asegurar que la IP de Martín esté incluida
                        if (!localList.includes(ipMartinDefault)) {
                            localList.push(ipMartinDefault);
                        }
                        setIpWhitelist(localList);
                        // Sincronizar con shared
                        localStorage.setItem(sharedWhitelistKey, JSON.stringify(localList));
                        localStorage.setItem('aricolor_ip_whitelist', JSON.stringify(localList));
                    } catch (e) {
                        setIpWhitelist([ipMartinDefault]);
                        localStorage.setItem('aricolor_ip_whitelist', JSON.stringify([ipMartinDefault]));
                    }
                } else {
                    // Intentar cargar desde shared key
                    const sharedList = localStorage.getItem(sharedWhitelistKey);
                    if (sharedList) {
                        try {
                            const parsedShared = JSON.parse(sharedList);
                            // Asegurar que la IP de Martín esté incluida
                            if (!parsedShared.includes(ipMartinDefault)) {
                                parsedShared.push(ipMartinDefault);
                            }
                            setIpWhitelist(parsedShared);
                            localStorage.setItem('aricolor_ip_whitelist', JSON.stringify(parsedShared));
                        } catch (e) {
                            setIpWhitelist([ipMartinDefault]);
                            localStorage.setItem('aricolor_ip_whitelist', JSON.stringify([ipMartinDefault]));
                        }
                    } else {
                        // Primera carga: agregar IP de Martín por defecto
                        setIpWhitelist([ipMartinDefault]);
                        localStorage.setItem('aricolor_ip_whitelist', JSON.stringify([ipMartinDefault]));
                        localStorage.setItem(sharedWhitelistKey, JSON.stringify([ipMartinDefault]));
                    }
                }

                // Cargar usuarios
                const savedUsuarios = localStorage.getItem('aricolor_usuarios');
                if (savedUsuarios) {
                    try {
                        setUsuarios(JSON.parse(savedUsuarios));
                    } catch (e) {
                        // Usuarios por defecto si hay error
                        const defaultUsers = {
                            'aricolor2026': 'Admin',
                            'German2026': 'Germán',
                            'Martin2026': 'Martín',
                            'Angelica2026': 'Angélica',
                            'Felipe2026': 'Felipe',
                            'LuisFernando2026': 'Luis Fernando'
                        };
                        setUsuarios(defaultUsers);
                        localStorage.setItem('aricolor_usuarios', JSON.stringify(defaultUsers));
                    }
                } else {
                    // Primera vez - guardar usuarios por defecto
                    const defaultUsers = {
                        'aricolor2026': 'Admin',
                        'German2026': 'Germán',
                        'Martin2026': 'Martín',
                        'Angelica2026': 'Angélica',
                        'Felipe2026': 'Felipe',
                        'LuisFernando2026': 'Luis Fernando'
                    };
                    setUsuarios(defaultUsers);
                    localStorage.setItem('aricolor_usuarios', JSON.stringify(defaultUsers));
                }

                const loadColores = async () => {
                    try {
                        console.log('🎨 Cargando referencia de colores...');
                        const response = await fetch('./colores_referencia.json');
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        const data = await response.json();
                        setColoresRef(data);
                        console.log(`✅ Cargados ${Object.keys(data).length} colores de referencia`);
                        
                        // Debug: mostrar primeros 3 Pantones con sus claves en columnas
                        const primerosTres = Object.entries(data).slice(0, 3);
                        console.log('📊 Primeros 3 Pantones en coloresRef:');
                        primerosTres.forEach(([pantoneCode, claves]) => {
                            console.log({
                                pantone: pantoneCode,
                                columnaC: claves.c || 'vacío',
                                columnaD: claves.d || 'vacío',
                                columnaE: claves.e || 'vacío',
                                columnaF: claves.f || 'vacío',
                                columnaG: claves.g || 'vacío'
                            });
                        });
                        
                        // Debug específico para el 0627
                        for (const [pantoneCode, claves] of Object.entries(data)) {
                            const todasLasClaves = [
                                claves.c || '',
                                claves.d || '',
                                claves.e || '',
                                claves.f || '',
                                claves.g || ''
                            ].join(' ');
                            
                            if (todasLasClaves.includes('0627')) {
                                console.log('🔍 Encontrado 0627 en Pantone:', {
                                    pantone: pantoneCode,
                                    claves: todasLasClaves
                                });
                            }
                        }
                    } catch (err) {
                        console.error('❌ Error cargando colores_referencia.json:', err);
                        setColoresRef({});
                    }
                };
                loadColores();

                // Obtener IP actual del usuario (IPv4 o IPv6)
                const getCurrentIp = async () => {
                    try {
                        const ipResponse = await fetch('https://ipapi.co/json/');
                        if (ipResponse.ok) {
                            const ipData = await ipResponse.json();
                            setCurrentIp(ipData.ip);
                        }
                    } catch (e) {
                        console.log('No se pudo obtener IP actual');
                    }
                };
                getCurrentIp();
            }, []);

            // Cargar catálogo de productos
            useEffect(() => {
                const loadProductos = async () => {
                    try {
                        console.log('🔄 Intentando cargar productos_catalogo.json...');
                        const response = await fetch('./productos_catalogo.json');
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        const data = await response.json();
                        console.log(`📦 Datos recibidos: ${data.length} productos`);
                        setProductos(data);
                        console.log(`✅ Cargados ${data.length} productos del catálogo`);
                        console.log('📊 Primeros 3 productos:', data.slice(0, 3));
                    } catch (err) {
                        console.error('❌ Error cargando productos_catalogo.json:', err);
                        setProductos([]);
                    }
                };
                loadProductos();
            }, []);

            // Cargar configuración del localStorage
            useEffect(() => {
                // Listener para mensajes de ventana flotante de notas
                const handleMessage = (event) => {
                    if (event.data.type === 'ABRIR_VENDEDOR') {
                        const vendedor = Object.values(usuarios).find(u => 
                            u.toLowerCase().includes(event.data.nombre.toLowerCase())
                        );
                        if (vendedor) {
                            setVendedorModal(vendedor);
                            setActiveTab('ventas'); // Cambiar a pestaña VENTAS
                        }
                    } else if (event.data.type === 'ABRIR_CLIENTE') {
                        const cliente = clientes.find(c => 
                            c.nombre.toLowerCase().includes(event.data.nombre.toLowerCase())
                        );
                        if (cliente) {
                            setSelectedCliente(cliente);
                            setActiveTab('clientes'); // Cambiar a pestaña CLIENTES
                        }
                    }
                };
                window.addEventListener('message', handleMessage);

                const savedCsvUrl = localStorage.getItem('aricolor_csv_url');
                const savedAsanaToken = localStorage.getItem('aricolor_asana_token');
                const savedNotas = localStorage.getItem('aricolor_notas');
                const savedNotificaciones = localStorage.getItem('aricolor_notificaciones');
                
                if (savedCsvUrl && savedAsanaToken) {
                    setCsvUrl(savedCsvUrl);
                    setAsanaToken(savedAsanaToken);
                    setIsConfigured(true);
                    
                    // Cargar datos automáticamente
                    loadClientesFromCSV(savedCsvUrl);
                }

                if (savedNotas) {
                    try {
                        setNotas(JSON.parse(savedNotas));
                    } catch (e) {
                        console.error('Error cargando notas:', e);
                    }
                }

                if (savedNotificaciones) {
                    try {
                        setNotificaciones(JSON.parse(savedNotificaciones));
                    } catch (e) {
                        console.error('Error cargando notificaciones:', e);
                    }
                }

                // Cargar compras mensuales
                const savedCompras = localStorage.getItem('aricolor_compras_mensuales');
                if (savedCompras) {
                    try {
                        setComprasMensuales(JSON.parse(savedCompras));
                    } catch (e) {
                        console.error('Error cargando compras mensuales:', e);
                    }
                }

                // Cargar asignaciones de vendedor
                const savedAsignaciones = localStorage.getItem('aricolor_asignaciones_vendedor');
                if (savedAsignaciones) {
                    try {
                        setAsignacionesVendedor(JSON.parse(savedAsignaciones));
                    } catch (e) {
                        console.error('Error cargando asignaciones:', e);
                    }
                }

                // Cargar registros de geolocalización
                const savedGeoRecords = localStorage.getItem('aricolor_geo_records');
                if (savedGeoRecords) {
                    try {
                        setGeoRecords(JSON.parse(savedGeoRecords));
                    } catch (e) {
                        console.error('Error cargando geo records:', e);
                    }
                }

                // Verificar status actual de checkin
                const savedStatus = localStorage.getItem('aricolor_current_status');
                if (savedStatus) {
                    setCurrentStatus(savedStatus);
                }

                // Cargar coordenadas geocodificadas
                const savedCoordenadas = localStorage.getItem('aricolor_coordenadas');
                console.log('🔍 Cargando coordenadas desde localStorage:', savedCoordenadas);
                if (savedCoordenadas) {
                    try {
                        const parsed = JSON.parse(savedCoordenadas);
                        console.log('✅ Coordenadas parseadas:', parsed);
                        console.log('📊 Total de clientes con coordenadas:', Object.keys(parsed).length);
                        setClientesCoordenadas(parsed);
                    } catch (e) {
                        console.error('❌ Error cargando coordenadas:', e);
                    }
                }
            }, []);

            // Funciones para documentos HT/HDS
            const extractProductCode = (productName) => {
                // Extraer el código numérico de la clave del producto
                // Ejemplo: "MB AM-1248-14" → "1248"
                const match = productName.match(/(\d{4})/);
                return match ? match[1] : null;
            };

            // Función para obtener color de un producto
            const getProductColor = (productName) => {
                if (!productName || !coloresRef) return null;
                
                // Intentar búsqueda exacta primero
                if (coloresRef[productName]) {
                    return coloresRef[productName];
                }
                
                // Extraer código numérico (ej: 1500, 0627)
                const codeMatch = productName.match(/(\d{4})/);
                if (!codeMatch) return null;
                
                const code = codeMatch[1];
                
                // Buscar en todas las claves del JSON que contengan ese código
                for (const [key, colorData] of Object.entries(coloresRef)) {
                    if (key.includes(code)) {
                        return colorData;
                    }
                }
                
                return null;
            };

            // Componente para mostrar color
            const ColorSwatch = ({ productName }) => {
                const colorData = getProductColor(productName);
                
                if (!colorData) {
                    return <span className="no-color">Sin color</span>;
                }

                return (
                    <div 
                        className="color-swatch"
                        onClick={(e) => {
                            e.stopPropagation();
                            setColorModal({ productName, colorData });
                        }}
                        title="Click para ver detalles del color"
                    >
                        <div 
                            className="color-box" 
                            style={{backgroundColor: colorData.hex?.startsWith('#') ? colorData.hex : `#${colorData.hex}`}}
                        ></div>
                        <div className="color-info">
                            <span className="color-label">Pantone {colorData.pantone}</span>
                            <span className="color-code">{colorData.hex?.startsWith('#') ? colorData.hex : `#${colorData.hex}`}</span>
                        </div>
                    </div>
                );
            };

            const getDocumentLinks = (productName) => {
                const code = extractProductCode(productName);
                if (!code) return { ht: null, hds: null };

                // IDs de las carpetas de Google Drive
                const htFolderId = '1h6aNyJIKV551r0oPoSm8KIqn54Ek4sJY';
                const hdsFolderId = '1mnIjaCd5SiGU596Hmnjq2Jg0RLNnlkKO';

                // Generar URLs de búsqueda en Drive
                // Nota: Abre carpeta de Drive filtrada por código del producto
                // Recomendación: Buscar archivo con R más alto (ej: R3 es más reciente que R2)
                return {
                    ht: `https://drive.google.com/drive/folders/${htFolderId}?q=${code}`,
                    hds: `https://drive.google.com/drive/folders/${hdsFolderId}?q=${code}`
                };
            };

            const sendDocByEmail = (productName, docType) => {
                const links = getDocumentLinks(productName);
                const link = docType === 'ht' ? links.ht : links.hds;
                const subject = `${docType === 'ht' ? 'Hoja Técnica' : 'Hoja de Seguridad'} - ${productName}`;
                const body = `Hola,\n\nTe comparto el enlace para acceder a la ${docType === 'ht' ? 'Hoja Técnica' : 'Hoja de Seguridad'} del producto ${productName}:\n\n${link}\n\nSaludos,\nARICOLOR`;
                
                window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            };

            const sendDocByWhatsApp = (productName, docType) => {
                const links = getDocumentLinks(productName);
                const link = docType === 'ht' ? links.ht : links.hds;
                const message = `Hola! Te comparto la ${docType === 'ht' ? 'Hoja Técnica' : 'Hoja de Seguridad'} del producto *${productName}*:\n\n${link}`;
                
                window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, '_blank');
            };

            // Función para actualizar colores desde Google Sheets
            const actualizarColoresDesdeSheet = async () => {
                setUpdateColorsStatus({ type: 'loading', message: 'Descargando datos de Google Sheets...' });
                
                try {
                    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQCyizKFKMCDFvW5YGsjdYaLWi0_usNDGrV611UcFat0udX_TSiRIWyIaASSkFa-i3Uc7SJN9-Huh8j/pub?output=csv';
                    
                    const response = await fetch(csvUrl);
                    if (!response.ok) throw new Error('Error al descargar CSV');
                    
                    const csvText = await response.text();
                    setUpdateColorsStatus({ type: 'loading', message: 'Procesando datos...' });
                    
                    // Parsear CSV
                    const lines = csvText.split('\n');
                    const newColoresRef = {};
                    
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line) continue;
                        
                        const values = line.split(',').map(v => v.trim().replace(/^"|"$/g, ''));
                        
                        const pantoneCode = values[0] || null;
                        const colorName = values[1] || null;
                        
                        // Claves en columnas 2-7 (índices 2 a 7)
                        const claves = [];
                        for (let j = 2; j <= 7 && j < values.length; j++) {
                            if (values[j]) claves.push(values[j]);
                        }
                        
                        // HEX en columna 16
                        const hexCode = values[16] || null;
                        
                        if (claves.length > 0 && hexCode) {
                            for (const clave of claves) {
                                if (clave.startsWith('MB ') || clave.startsWith('P ') || clave.startsWith('D') || clave.startsWith('AN ')) {
                                    newColoresRef[clave] = {
                                        hex: hexCode.startsWith('#') ? hexCode : `#${hexCode}`,
                                        pantone: pantoneCode || 'N/A',
                                        nombre: colorName || 'N/A'
                                    };
                                }
                            }
                        }
                    }
                    
                    const totalColores = Object.keys(newColoresRef).length;
                    
                    if (totalColores > 0) {
                        setColoresRef(newColoresRef);
                        setUpdateColorsStatus({ 
                            type: 'success', 
                            message: `✅ ${totalColores} colores actualizados correctamente` 
                        });
                    } else {
                        throw new Error('No se encontraron colores en el CSV');
                    }
                    
                } catch (error) {
                    console.error('Error actualizando colores:', error);
                    setUpdateColorsStatus({ 
                        type: 'error', 
                        message: `❌ Error: ${error.message}` 
                    });
                }
            };

            // Función para marcar notificación como leída
            const marcarNotificacionLeida = (notifId) => {
                const actualizadas = notificaciones.map(n => 
                    n.id === notifId ? { ...n, leida: true } : n
                );
                setNotificaciones(actualizadas);
                localStorage.setItem('aricolor_notificaciones', JSON.stringify(actualizadas));
            };

            // Función para obtener notificaciones no leídas
            const getNotificacionesNoLeidas = () => {
                return notificaciones.filter(n => 
                    n.to.toLowerCase() === currentUser.toLowerCase() && !n.leida
                );
            };

            // Función para manejar cambios en textarea con autocomplete de menciones
            const handleTextareaChange = (e) => {
                const texto = e.target.value;
                setNuevaNota({ ...nuevaNota, texto });

                const cursorPos = e.target.selectionStart;
                const textBeforeCursor = texto.substring(0, cursorPos);
                
                // Detectar @ para usuarios
                const atMatch = textBeforeCursor.match(/@(\w*)$/);
                // Detectar # para clientes
                const hashMatch = textBeforeCursor.match(/#([\w\s]*)$/);

                if (atMatch) {
                    const searchTerm = atMatch[1].toLowerCase();
                    const todosLosUsuarios = Object.values(usuarios);
                    
                    const usuariosFiltrados = todosLosUsuarios.filter(nombre => 
                        nombre.toLowerCase().includes(searchTerm)
                    );

                    if (usuariosFiltrados.length > 0) {
                        const coords = getCaretCoordinates(e.target, cursorPos);
                        setMentionAutocomplete({
                            show: true,
                            users: usuariosFiltrados,
                            type: 'user',
                            selected: 0,
                            position: { top: coords.top + 20, left: coords.left }
                        });
                    } else {
                        setMentionAutocomplete({ show: false, users: [], selected: 0, position: { top: 0, left: 0 } });
                    }
                } else if (hashMatch) {
                    const searchTerm = hashMatch[1].toLowerCase();
                    const nombresClientes = clientes.map(c => c.nombre);
                    
                    const clientesFiltrados = nombresClientes.filter(nombre => 
                        nombre.toLowerCase().includes(searchTerm)
                    ).slice(0, 10); // Limitar a 10

                    if (clientesFiltrados.length > 0) {
                        const coords = getCaretCoordinates(e.target, cursorPos);
                        setMentionAutocomplete({
                            show: true,
                            users: clientesFiltrados,
                            type: 'client',
                            selected: 0,
                            position: { top: coords.top + 20, left: coords.left }
                        });
                    } else {
                        setMentionAutocomplete({ show: false, users: [], selected: 0, position: { top: 0, left: 0 } });
                    }
                } else {
                    setMentionAutocomplete({ show: false, users: [], selected: 0, position: { top: 0, left: 0 } });
                }
            };

            // Función para obtener coordenadas del cursor en textarea
            const getCaretCoordinates = (element, position) => {
                const div = document.createElement('div');
                const style = getComputedStyle(element);
                div.style.position = 'absolute';
                div.style.visibility = 'hidden';
                div.style.whiteSpace = 'pre-wrap';
                div.style.wordWrap = 'break-word';
                div.style.font = style.font;
                div.style.padding = style.padding;
                div.style.width = style.width;
                div.textContent = element.value.substring(0, position);
                document.body.appendChild(div);
                const span = document.createElement('span');
                span.textContent = element.value.substring(position) || '.';
                div.appendChild(span);
                const coordinates = {
                    top: span.offsetTop,
                    left: span.offsetLeft
                };
                document.body.removeChild(div);
                return coordinates;
            };

            // Función para insertar mención seleccionada
            const insertMention = (name) => {
                const textarea = textareaRef.current;
                if (!textarea) return;

                const cursorPos = textarea.selectionStart;
                const texto = nuevaNota.texto;
                const textBeforeCursor = texto.substring(0, cursorPos);
                const textAfterCursor = texto.substring(cursorPos);
                
                // Determinar si es @ o #
                const symbol = mentionAutocomplete.type === 'user' ? '@' : '#';
                const symbolIndex = textBeforeCursor.lastIndexOf(symbol);
                const beforeSymbol = texto.substring(0, symbolIndex);
                const newText = beforeSymbol + symbol + name + ' ' + textAfterCursor;
                
                setNuevaNota({ ...nuevaNota, texto: newText });
                setMentionAutocomplete({ show: false, users: [], selected: 0, position: { top: 0, left: 0 } });
                
                // Devolver foco al textarea
                setTimeout(() => {
                    textarea.focus();
                    const newCursorPos = symbolIndex + name.length + 2;
                    textarea.setSelectionRange(newCursorPos, newCursorPos);
                }, 0);
            };

            // Función para manejar teclas en autocomplete
            const handleKeyDown = (e) => {
                if (!mentionAutocomplete.show) return;

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    setMentionAutocomplete(prev => ({
                        ...prev,
                        selected: Math.min(prev.selected + 1, prev.users.length - 1)
                    }));
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    setMentionAutocomplete(prev => ({
                        ...prev,
                        selected: Math.max(prev.selected - 1, 0)
                    }));
                } else if (e.key === 'Enter' || e.key === 'Tab') {
                    e.preventDefault();
                    insertMention(mentionAutocomplete.users[mentionAutocomplete.selected]);
                } else if (e.key === 'Escape') {
                    setMentionAutocomplete({ show: false, users: [], selected: 0, position: { top: 0, left: 0 } });
                }
            };

            // Funciones de Geolocalización
            const handleCheckin = () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const record = {
                                id: Date.now(),
                                type: 'checkin',
                                user: currentUser,
                                timestamp: new Date().toLocaleString('es-MX'),
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                accuracy: position.coords.accuracy
                            };
                            
                            const newRecords = [record, ...geoRecords];
                            setGeoRecords(newRecords);
                            setCurrentStatus('checkin');
                            localStorage.setItem('aricolor_geo_records', JSON.stringify(newRecords));
                            localStorage.setItem('aricolor_current_status', 'checkin');
                        },
                        (error) => {
                            alert('Error obteniendo ubicación: ' + error.message);
                        }
                    );
                } else {
                    alert('Tu navegador no soporta geolocalización');
                }
            };

            const handleCheckout = () => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const record = {
                                id: Date.now(),
                                type: 'checkout',
                                user: currentUser,
                                timestamp: new Date().toLocaleString('es-MX'),
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                accuracy: position.coords.accuracy
                            };
                            
                            const newRecords = [record, ...geoRecords];
                            setGeoRecords(newRecords);
                            setCurrentStatus(null);
                            localStorage.setItem('aricolor_geo_records', JSON.stringify(newRecords));
                            localStorage.removeItem('aricolor_current_status');
                        },
                        (error) => {
                            alert('Error obteniendo ubicación: ' + error.message);
                        }
                    );
                } else {
                    alert('Tu navegador no soporta geolocalización');
                }
            };

            const registrarVisita = (cliente) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const record = {
                                id: Date.now(),
                                type: 'visit',
                                user: currentUser,
                                cliente: cliente,
                                timestamp: new Date().toLocaleString('es-MX'),
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                accuracy: position.coords.accuracy
                            };
                            
                            const newRecords = [record, ...geoRecords];
                            setGeoRecords(newRecords);
                            localStorage.setItem('aricolor_geo_records', JSON.stringify(newRecords));
                            setVisitingClient(null);
                            alert(`✅ Visita registrada: ${cliente}`);
                        },
                        (error) => {
                            alert('Error obteniendo ubicación: ' + error.message);
                        }
                    );
                } else {
                    alert('Tu navegador no soporta geolocalización');
                }
            };

            // Funciones del Mapa
            const geocodeAddress = async (direccion, codigoPostal) => {
                if (!direccion) return null;
                
                try {
                    // Usar Nominatim de OpenStreetMap (gratuito, sin API key)
                    const address = `${direccion}, ${codigoPostal || ''}, México`.trim();
                    const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(address)}&format=json&limit=1`;
                    
                    const response = await fetch(url, {
                        headers: {
                            'User-Agent': 'ARICOLOR-CRM/1.0' // Requerido por Nominatim
                        }
                    });
                    const data = await response.json();
                    
                    if (data && data.length > 0) {
                        const location = data[0];
                        console.log(`✅ Geocodificado: ${direccion} → [${location.lat}, ${location.lon}]`);
                        return { lat: parseFloat(location.lat), lng: parseFloat(location.lon) };
                    } else {
                        console.log(`❌ No se encontró: ${direccion}`);
                    }
                    return null;
                } catch (error) {
                    console.error('Error geocoding:', error);
                    return null;
                }
            };

            const getClienteVendedor = (cliente) => {
                for (const [vendedor, clientes] of Object.entries(asignacionesVendedor)) {
                    if (clientes.includes(cliente.nombre)) {
                        return vendedor;
                    }
                }
                return null;
            };

            const getVendedorColor = (vendedor) => {
                const colores = {
                    'Germán': '#10b981',      // Verde
                    'Martín': '#3b82f6',      // Azul
                    'Angélica': '#ef4444',    // Rojo
                    'Luis Fernando': '#f97316' // Naranja
                };
                return colores[vendedor] || '#6b7280';
            };

            // Funciones de Ventas
            const asignarCliente = (vendedor, cliente) => {
                const nuevasAsignaciones = { ...asignacionesVendedor };
                if (!nuevasAsignaciones[vendedor]) {
                    nuevasAsignaciones[vendedor] = [];
                }
                if (!nuevasAsignaciones[vendedor].includes(cliente)) {
                    nuevasAsignaciones[vendedor].push(cliente);
                    setAsignacionesVendedor(nuevasAsignaciones);
                    localStorage.setItem('aricolor_asignaciones_vendedor', JSON.stringify(nuevasAsignaciones));
                }
            };

            const desasignarCliente = (vendedor, cliente) => {
                const nuevasAsignaciones = { ...asignacionesVendedor };
                if (nuevasAsignaciones[vendedor]) {
                    nuevasAsignaciones[vendedor] = nuevasAsignaciones[vendedor].filter(c => c !== cliente);
                    setAsignacionesVendedor(nuevasAsignaciones);
                    localStorage.setItem('aricolor_asignaciones_vendedor', JSON.stringify(nuevasAsignaciones));
                }
            };

            const getVendedorStats = (vendedor) => {
                const clientesAsignados = asignacionesVendedor[vendedor] || [];
                const clientesActivos = clientesAsignados.filter(nombreCliente => {
                    const cliente = clientes.find(c => c.nombre === nombreCliente);
                    return cliente && cliente.status === 'Activo';
                });
                
                return {
                    total: clientesAsignados.length,
                    activos: clientesActivos.length,
                    inactivos: clientesAsignados.length - clientesActivos.length
                };
            };

            // Función para resaltar menciones en texto
            const highlightMentions = (texto) => {
                return texto
                    .replace(/@(\w+)/g, '<span class="mention-in-text mention-clickable" data-type="user" data-name="$1" style="cursor: pointer;">@$1</span>')
                    .replace(/#([\w\s]+?)(?=\s|$|[,.!?])/g, '<span class="mention-in-text mention-clickable" data-type="client" data-name="$1" style="cursor: pointer;">#$1</span>');
            };

            // Función para manejar clicks en menciones
            const handleMentionClick = (e) => {
                if (e.target.classList.contains('mention-clickable')) {
                    const type = e.target.dataset.type;
                    const name = e.target.dataset.name;
                    
                    if (type === 'user') {
                        // Buscar vendedor (puede ser nombre corto como "Martín" o completo)
                        const vendedor = Object.values(usuarios).find(u => 
                            u.toLowerCase() === name.toLowerCase() || 
                            u.toLowerCase().includes(name.toLowerCase())
                        );
                        if (vendedor && vendedorContacto[vendedor]) {
                            setVendedorModal(vendedor);
                        }
                    } else if (type === 'client') {
                        const cliente = clientes.find(c => 
                            c.nombre.toLowerCase() === name.toLowerCase() ||
                            c.nombre.toLowerCase().includes(name.toLowerCase())
                        );
                        if (cliente) {
                            setSelectedCliente(cliente);
                        }
                    }
                }
            };

            // Función para toggle compra mensual
            const toggleCompraMensual = (clienteNombre, mes, anio = new Date().getFullYear()) => {
                const key = `${clienteNombre}_${anio}`;
                const comprasCliente = comprasMensuales[key] || {};
                const nuevoEstado = !comprasCliente[mes];
                
                const nuevasCompras = {
                    ...comprasMensuales,
                    [key]: {
                        ...comprasCliente,
                        [mes]: nuevoEstado
                    }
                };
                
                setComprasMensuales(nuevasCompras);
                localStorage.setItem('aricolor_compras_mensuales', JSON.stringify(nuevasCompras));
            };

            // Función para guardar nota
            const guardarNota = () => {
                if (!nuevaNota.cliente || !nuevaNota.texto.trim()) {
                    alert('Por favor selecciona un cliente y escribe una nota');
                    return;
                }

                const nota = {
                    id: Date.now(),
                    cliente: nuevaNota.cliente,
                    texto: nuevaNota.texto,
                    usuario: currentUser,
                    fecha: new Date().toLocaleString('es-MX', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    }),
                    timestamp: Date.now()
                };

                // Detectar menciones @ en el texto
                const mencionesRegex = /@(\w+)/g;
                const menciones = [...nuevaNota.texto.matchAll(mencionesRegex)].map(m => m[1]);
                
                if (menciones.length > 0) {
                    // Crear notificaciones para usuarios mencionados
                    const nuevasNotificaciones = menciones.map(usuarioMencionado => ({
                        id: Date.now() + Math.random(),
                        from: currentUser,
                        to: usuarioMencionado,
                        cliente: nuevaNota.cliente,
                        texto: nuevaNota.texto,
                        notaId: nota.id,
                        fecha: nota.fecha,
                        timestamp: nota.timestamp,
                        leida: false
                    }));
                    
                    const todasLasNotificaciones = [...notificaciones, ...nuevasNotificaciones];
                    setNotificaciones(todasLasNotificaciones);
                    localStorage.setItem('aricolor_notificaciones', JSON.stringify(todasLasNotificaciones));
                }

                const nuevasNotas = [nota, ...notas];
                setNotas(nuevasNotas);
                localStorage.setItem('aricolor_notas', JSON.stringify(nuevasNotas));
                setNuevaNota({ cliente: '', texto: '' });
            };

            // Función de login
            const handleLogin = async (e) => {
                e.preventDefault();
                
                const savedUsuarios = JSON.parse(localStorage.getItem('aricolor_usuarios') || '{}');
                const usuario = savedUsuarios[passwordInput];
                
                if (usuario) {
                    // Obtener información del acceso (IPv4 o IPv6)
                    let ipInfo = { ip: 'Desconocida', city: 'Desconocida', country: 'MX' };
                    try {
                        // Primero intentar obtener la IP que el navegador está usando
                        const ipResponse = await fetch('https://ipapi.co/json/');
                        if (ipResponse.ok) {
                            const ipData = await ipResponse.json();
                            ipInfo.ip = ipData.ip;
                            ipInfo.city = ipData.city || 'Desconocida';
                            ipInfo.country_name = ipData.country_name || 'México';
                        }
                    } catch (e) {
                        console.log('No se pudo obtener IP');
                    }

                    // Detectar dispositivo y navegador
                    const ua = navigator.userAgent;
                    let dispositivo = 'Desconocido';
                    if (/Windows/i.test(ua)) dispositivo = 'Windows';
                    else if (/Mac/i.test(ua)) dispositivo = 'Mac';
                    else if (/iPhone/i.test(ua)) dispositivo = 'iPhone';
                    else if (/iPad/i.test(ua)) dispositivo = 'iPad';
                    else if (/Android/i.test(ua)) dispositivo = 'Android';
                    else if (/Linux/i.test(ua)) dispositivo = 'Linux';

                    let navegador = 'Desconocido';
                    if (/Chrome/i.test(ua) && !/Edge/i.test(ua)) navegador = 'Chrome';
                    else if (/Safari/i.test(ua) && !/Chrome/i.test(ua)) navegador = 'Safari';
                    else if (/Firefox/i.test(ua)) navegador = 'Firefox';
                    else if (/Edge/i.test(ua)) navegador = 'Edge';

                    // Verificar whitelist de IPs (NO aplica para Admin y Germán)
                    if (usuario !== 'Admin' && usuario !== 'Germán') {
                        // Whitelist de IPs autorizadas
                        const ipsAutorizadas = [
                            '2806:2f0:ad41:e859:e9ae:b657:18f2:c83a',  // Martín
                            '2806:2f0:ad41:e859:38e0:885d:ee9f:f9d3',  // Angélica (IP actualizada)
                            '2806:2f0:ad41:e859:c548:e610:7981:4b1e',  // Felipe
                        ];
                        
                        // Agregar IPs del localStorage (configuradas por Admin)
                        const ipsGuardadas = ipWhitelist || [];
                        const todasLasIPs = [...new Set([...ipsAutorizadas, ...ipsGuardadas])];
                        
                        // DEBUG: Mostrar información de validación
                        console.log('🔍 DEBUG IP Validation:');
                        console.log('IP actual:', ipInfo.ip);
                        console.log('Usuario intentando acceder:', usuario);
                        console.log('IPs autorizadas:', todasLasIPs);
                        console.log('IP está en whitelist?', todasLasIPs.includes(ipInfo.ip));
                        
                        // Verificar si esta IP está autorizada
                        if (!todasLasIPs.includes(ipInfo.ip)) {
                            // Este dispositivo no está en la whitelist
                            const intentosBloqueados = JSON.parse(localStorage.getItem('aricolor_intentos_bloqueados') || '[]');
                            intentosBloqueados.push({
                                usuario: usuario,
                                password: passwordInput,
                                ip: ipInfo.ip,
                                city: ipInfo.city,
                                country: ipInfo.country_name || 'Desconocido',
                                dispositivo: dispositivo,
                                navegador: navegador,
                                razon: 'IP no autorizada',
                                fecha: new Date().toLocaleString('es-MX', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit',
                                    second: '2-digit'
                                }),
                                timestamp: Date.now()
                            });
                            localStorage.setItem('aricolor_intentos_bloqueados', JSON.stringify(intentosBloqueados));
                            
                            alert('🚫 IP NO AUTORIZADA\n\n' +
                                  'Tu IP no está en la lista de dispositivos autorizados.\n\n' +
                                  'Tu IP: ' + ipInfo.ip + '\n' +
                                  'Usuario: ' + usuario + '\n\n' +
                                  'Contacta al administrador para autorizar tu IP.');
                            setPasswordInput('');
                            return;
                        }
                    }

                    const acceso = {
                        usuario: usuario,
                        fecha: new Date().toLocaleString('es-MX', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        }),
                        timestamp: Date.now(),
                        ip: ipInfo.ip || 'Desconocida',
                        city: ipInfo.city || 'Desconocida',
                        country: ipInfo.country_name || 'Desconocido',
                        countryCode: ipInfo.country_code || 'MX',
                        dispositivo: dispositivo,
                        navegador: navegador
                    };

                    // Registrar acceso en log
                    const accessLog = JSON.parse(localStorage.getItem('aricolor_access_log') || '[]');
                    accessLog.push(acceso);
                    localStorage.setItem('aricolor_access_log', JSON.stringify(accessLog));

                    // Detectar accesos sospechosos (solo para no-Admin)
                    if (usuario !== 'Admin') {
                        const alertas = JSON.parse(localStorage.getItem('aricolor_alertas') || '[]');
                        const accesosPrevios = accessLog.filter(a => a.usuario === usuario && a.timestamp !== acceso.timestamp);
                        
                        // Alerta: IP nueva
                        if (accesosPrevios.length > 0) {
                            const ipsAnteriores = [...new Set(accesosPrevios.map(a => a.ip))];
                            if (!ipsAnteriores.includes(acceso.ip)) {
                                alertas.push({
                                    tipo: 'IP_NUEVA',
                                    usuario: usuario,
                                    mensaje: `${usuario} accedió desde IP nueva: ${acceso.ip} (${acceso.city})`,
                                    fecha: acceso.fecha,
                                    timestamp: acceso.timestamp,
                                    detalles: acceso
                                });
                            }
                        }

                        // Alerta: País diferente a México
                        if (acceso.countryCode !== 'MX') {
                            alertas.push({
                                tipo: 'PAIS_EXTRANJERO',
                                usuario: usuario,
                                mensaje: `${usuario} accedió desde ${acceso.country}`,
                                fecha: acceso.fecha,
                                timestamp: acceso.timestamp,
                                detalles: acceso
                            });
                        }

                        // Alerta: Múltiples usuarios misma IP
                        const usuariosMismaIP = [...new Set(accessLog.filter(a => a.ip === acceso.ip && a.timestamp > Date.now() - 86400000).map(a => a.usuario))];
                        if (usuariosMismaIP.length > 1) {
                            alertas.push({
                                tipo: 'MISMA_IP',
                                usuario: usuario,
                                mensaje: `Múltiples usuarios desde IP ${acceso.ip}: ${usuariosMismaIP.join(', ')}`,
                                fecha: acceso.fecha,
                                timestamp: acceso.timestamp,
                                detalles: acceso
                            });
                        }

                        localStorage.setItem('aricolor_alertas', JSON.stringify(alertas));
                    }
                    
                    // Autenticar
                    setIsAuthenticated(true);
                    setCurrentUser(usuario);
                    localStorage.setItem('aricolor_auth', 'authenticated');
                    localStorage.setItem('aricolor_user', usuario);
                    setPasswordInput('');
                } else {
                    alert('❌ Contraseña incorrecta');
                    setPasswordInput('');
                }
            };

            // Función de cerrar sesión
            const handleLogout = () => {
                if (confirm('¿Seguro que deseas cerrar sesión?')) {
                    localStorage.removeItem('aricolor_auth');
                    localStorage.removeItem('aricolor_user');
                    setIsAuthenticated(false);
                    setCurrentUser(null);
                    setPasswordInput('');
                }
            };

            // Sistema de cierre automático por inactividad (15 minutos)
            useEffect(() => {
                if (!isAuthenticated) return;

                let inactivityTimer;
                const INACTIVITY_TIMEOUT = 15 * 60 * 1000; // 15 minutos en milisegundos

                const resetTimer = () => {
                    clearTimeout(inactivityTimer);
                    inactivityTimer = setTimeout(() => {
                        alert('⏱️ Sesión cerrada por inactividad\n\nHas estado inactivo por 15 minutos.');
                        localStorage.removeItem('aricolor_auth');
                        localStorage.removeItem('aricolor_user');
                        setIsAuthenticated(false);
                        setCurrentUser(null);
                        setPasswordInput('');
                    }, INACTIVITY_TIMEOUT);
                };

                // Eventos que indican actividad del usuario
                const activityEvents = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'];
                
                activityEvents.forEach(event => {
                    document.addEventListener(event, resetTimer);
                });

                // Iniciar el temporizador
                resetTimer();

                // Cleanup
                return () => {
                    clearTimeout(inactivityTimer);
                    activityEvents.forEach(event => {
                        document.removeEventListener(event, resetTimer);
                    });
                };
            }, [isAuthenticated]);

            // Reloj en tiempo real
            useEffect(() => {
                const timer = setInterval(() => {
                    setCurrentTime(new Date());
                }, 1000);

                return () => clearInterval(timer);
            }, []);

            // Cerrar modales con tecla ESC
            useEffect(() => {
                const handleEscape = (e) => {
                    if (e.key === 'Escape') {
                        if (selectedCliente) {
                            setSelectedCliente(null);
                            setAsanaData(null);
                        }
                        if (colorModal) {
                            setColorModal(null);
                        }
                        if (clientesModalColor) {
                            setClientesModalColor(null);
                        }
                    }
                };

                document.addEventListener('keydown', handleEscape);
                return () => document.removeEventListener('keydown', handleEscape);
            }, [selectedCliente, colorModal, clientesModalColor]);

            // Recibir mensajes de ventana de notas para abrir fichas
            useEffect(() => {
                const handleMessage = (event) => {
                    if (event.data.type === 'ABRIR_FICHA_CLIENTE') {
                        const nombreCliente = event.data.cliente;
                        
                        // Buscar cliente por nombre
                        const clienteEncontrado = clientes.find(c => 
                            c.nombre.toLowerCase().includes(nombreCliente.toLowerCase()) ||
                            nombreCliente.toLowerCase().includes(c.nombre.toLowerCase())
                        );
                        
                        if (clienteEncontrado) {
                            setActiveTab('clientes');
                            setSelectedCliente(clienteEncontrado);
                        }
                    }
                };

                window.addEventListener('message', handleMessage);
                return () => window.removeEventListener('message', handleMessage);
            }, [clientes]);

            // Funciones para manejar whitelist de IPs
            const agregarIP = () => {
                const ip = newIp.trim();
                
                if (!ip) {
                    alert('Por favor ingresa una IP');
                    return;
                }
                
                // Validar formato IPv4
                const ipv4Regex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
                
                // Validar formato IPv6 (simplificado)
                const ipv6Regex = /^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/;
                
                const esIPv4 = ipv4Regex.test(ip);
                const esIPv6 = ipv6Regex.test(ip);
                
                if (!esIPv4 && !esIPv6) {
                    alert('❌ Formato de IP inválido\n\n' +
                          'Debe ser una dirección IPv4 o IPv6 válida.\n\n' +
                          'Ejemplos:\n' +
                          'IPv4: 192.168.1.1\n' +
                          'IPv6: 2806:2f0:ad41:e859:fd0e:66f5:4f36:44b4\n\n' +
                          'Tu entrada: ' + ip);
                    return;
                }
                
                // Verificar si ya existe
                if (ipWhitelist.includes(ip)) {
                    alert('⚠️ Esta IP ya está autorizada\n\n' + ip);
                    return;
                }
                
                const updatedWhitelist = [...ipWhitelist, ip];
                setIpWhitelist(updatedWhitelist);
                localStorage.setItem('aricolor_ip_whitelist', JSON.stringify(updatedWhitelist));
                setNewIp('');
                
                const tipoIP = esIPv6 ? 'IPv6' : 'IPv4';
                alert('✅ IP agregada correctamente\n\n' + 
                      ip + ' (' + tipoIP + ')\n\n' +
                      'Los usuarios ahora pueden acceder desde esta ubicación.');
            };

            const eliminarIP = (ip) => {
                if (confirm(`⚠️ ¿Eliminar IP de la whitelist?\n\n${ip}\n\nLos usuarios desde esta IP ya no podrán acceder.`)) {
                    const updatedWhitelist = ipWhitelist.filter(i => i !== ip);
                    setIpWhitelist(updatedWhitelist);
                    localStorage.setItem('aricolor_ip_whitelist', JSON.stringify(updatedWhitelist));
                    alert('✅ IP eliminada correctamente');
                }
            };

            // Funciones para gestionar usuarios
            const agregarUsuario = () => {
                if (!nuevoUsuario.nombre.trim() || !nuevoUsuario.password.trim()) {
                    alert('Por favor completa nombre y contraseña');
                    return;
                }

                if (usuarios[nuevoUsuario.password]) {
                    alert('Esa contraseña ya está en uso. Elige otra.');
                    return;
                }

                const updatedUsuarios = {
                    ...usuarios,
                    [nuevoUsuario.password]: nuevoUsuario.nombre
                };
                setUsuarios(updatedUsuarios);
                localStorage.setItem('aricolor_usuarios', JSON.stringify(updatedUsuarios));
                setNuevoUsuario({ nombre: '', password: '' });
                alert(`✅ Usuario "${nuevoUsuario.nombre}" creado con contraseña "${nuevoUsuario.password}"`);
            };

            const eliminarUsuario = (password, nombre) => {
                if (nombre === 'Admin') {
                    alert('❌ No puedes eliminar al usuario Admin');
                    return;
                }

                if (confirm(`¿Eliminar usuario "${nombre}"?\n\nContraseña: ${password}`)) {
                    const updatedUsuarios = { ...usuarios };
                    delete updatedUsuarios[password];
                    setUsuarios(updatedUsuarios);
                    localStorage.setItem('aricolor_usuarios', JSON.stringify(updatedUsuarios));
                }
            };

            const saveConfiguration = async () => {
                if (!csvUrl || !asanaToken) {
                    alert('Por favor completa ambos campos');
                    return;
                }

                // Validar formato del CSV URL
                if (!csvUrl.includes('docs.google.com') || !csvUrl.includes('output=csv')) {
                    alert('⚠️ El link CSV no parece válido.\n\nAsegúrate de que:\n1. Sea de Google Sheets\n2. Termine con "output=csv"\n3. Sea un link publicado');
                    return;
                }

                setIsLoading(true);
                try {
                    // Probar la conexión y cargar datos
                    await loadClientesFromCSV(csvUrl);
                    
                    // Si funcionó, guardar configuración
                    localStorage.setItem('aricolor_csv_url', csvUrl);
                    localStorage.setItem('aricolor_asana_token', asanaToken);
                    setIsConfigured(true);
                    
                    alert(`✅ Configuración guardada!\n\nLos datos se cargarán automáticamente cada vez que abras la plataforma.`);
                } catch (error) {
                    alert(`❌ Error al conectar:\n\n${error.message}\n\nVerifica el link CSV.`);
                    setIsLoading(false);
                }
            };

            const reloadCSVData = async () => {
                if (!csvUrl) {
                    alert('No hay URL CSV configurada');
                    return;
                }
                
                await loadClientesFromCSV(csvUrl);
            };

            const resetConfiguration = () => {
                if (confirm('¿Estás seguro de que quieres desconectar y borrar toda la configuración?')) {
                    localStorage.removeItem('aricolor_csv_url');
                    localStorage.removeItem('aricolor_asana_token');
                    setCsvUrl('');
                    setAsanaToken('');
                    setIsConfigured(false);
                    setClientes([]);
                    setSelectedCliente(null);
                }
            };

            const parseCSVLine = (line) => {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                result.push(current.trim());
                return result;
            };

            const loadClientesFromCSV = async (url) => {
                setIsLoading(true);
                try {
                    console.log('🔄 Cargando datos desde Google Sheets...');
                    
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const csvText = await response.text();
                    const rows = csvText.split('\n').filter(row => row.trim());
                    
                    if (rows.length < 2) {
                        throw new Error('El CSV está vacío o solo tiene encabezados');
                    }

                    const clientesData = [];

                    for (let i = 1; i < rows.length; i++) {
                        const values = parseCSVLine(rows[i]);
                        if (values.length < 7) continue;

                        const productos = [];
                        // Leer productos desde columna 12 hasta columna 72 (BN + 6 columnas nuevas)
                        // No leer más allá para evitar columnas auxiliares BO+
                        const maxColumna = Math.min(72, values.length); // Hasta columna 72 (BT) máximo
                        for (let j = 12; j < maxColumna; j += 2) {
                            const productoNombre = values[j]?.replace(/^["']|["']$/g, '').trim();
                            const productoPrecio = values[j+1]?.replace(/^["']|["']$/g, '').trim();
                            
                            // Mostrar producto si tiene nombre (con o sin precio)
                            if (productoNombre && productoNombre !== 'x' && productoNombre !== '') {
                                productos.push({
                                    nombre: productoNombre,
                                    precio: productoPrecio || 'Pendiente'
                                });
                            }
                        }

                        const nombreCliente = values[0]?.replace(/^["']|["']$/g, '').trim();
                        if (!nombreCliente) continue;

                        clientesData.push({
                            nombre: nombreCliente,
                            asana: values[1]?.replace(/^["']|["']$/g, '').trim() || '',
                            sector: values[2]?.replace(/^["']|["']$/g, '').trim() || 'N/A',
                            status: values[3]?.replace(/^["']|["']$/g, '').trim() || 'N/A',
                            responsable: values[4]?.replace(/^["']|["']$/g, '').trim() || 'N/A',
                            zona: values[5]?.replace(/^["']|["']$/g, '').trim() || 'N/A',
                            contacto: values[6]?.replace(/^["']|["']$/g, '').trim() || 'N/A',
                            telFijo: values[7]?.replace(/^["']|["']$/g, '').trim() || 'N/A',
                            celular: values[8]?.replace(/^["']|["']$/g, '').trim() || 'N/A',
                            mail: values[9]?.replace(/^["']|["']$/g, '').trim() || 'N/A',
                            direccion: values[10]?.replace(/^["']|["']$/g, '').trim() || 'N/A',
                            codigoPostal: values[11]?.replace(/^["']|["']$/g, '').trim() || 'N/A',
                            productos: productos
                        });
                    }

                    setClientes(clientesData);
                    console.log(`✅ Cargados ${clientesData.length} clientes desde Google Sheets`);

                    // Auto-asignar clientes a vendedores según campo Responsable (iniciales)
                    const nuevasAsignaciones = {};
                    clientesData.forEach(cliente => {
                        const iniciales = cliente.responsable;
                        const vendedor = inicialesVendedor[iniciales]; // GTM->Germán, MZC->Martín, etc.
                        
                        if (vendedor) {
                            if (!nuevasAsignaciones[vendedor]) {
                                nuevasAsignaciones[vendedor] = [];
                            }
                            if (!nuevasAsignaciones[vendedor].includes(cliente.nombre)) {
                                nuevasAsignaciones[vendedor].push(cliente.nombre);
                            }
                        }
                    });
                    
                    setAsignacionesVendedor(nuevasAsignaciones);
                    localStorage.setItem('aricolor_asignaciones_vendedor', JSON.stringify(nuevasAsignaciones));
                    console.log('✅ Asignaciones automáticas completadas:', nuevasAsignaciones);
                } catch (error) {
                    console.error('❌ Error cargando datos:', error);
                    alert(`Error cargando datos de Google Sheets:\n\n${error.message}\n\nVerifica que el link CSV sea correcto.`);
                }
                setIsLoading(false);
            };

            const loadAsanaData = async (projectUrl) => {
                if (!asanaToken || !projectUrl) return;

                // Extraer project ID del URL
                const projectMatch = projectUrl.match(/\/(\d+)\//);
                if (!projectMatch) return;

                const projectId = projectMatch[1];

                try {
                    setIsLoading(true);
                    
                    // Obtener tareas del proyecto
                    const response = await fetch(`https://app.asana.com/api/1.0/projects/${projectId}/tasks`, {
                        headers: {
                            'Authorization': `Bearer ${asanaToken}`
                        }
                    });

                    const data = await response.json();
                    
                    if (data.data) {
                        // Obtener detalles de cada tarea
                        const tasksDetails = await Promise.all(
                            data.data.slice(0, 15).map(async (task) => {
                                const taskResponse = await fetch(`https://app.asana.com/api/1.0/tasks/${task.gid}`, {
                                    headers: {
                                        'Authorization': `Bearer ${asanaToken}`
                                    }
                                });
                                const taskData = await taskResponse.json();
                                return taskData.data;
                            })
                        );

                        // Procesar estadísticas
                        const sections = {};
                        tasksDetails.forEach(task => {
                            const section = task.memberships?.[0]?.section?.name || 'Sin Sección';
                            sections[section] = (sections[section] || 0) + 1;
                        });

                        setAsanaData({
                            tasks: tasksDetails,
                            sections: sections
                        });
                    }
                } catch (error) {
                    console.error('Error cargando datos de Asana:', error);
                }
                setIsLoading(false);
            };

            useEffect(() => {
                if (selectedCliente && selectedCliente.asana) {
                    loadAsanaData(selectedCliente.asana);
                }
            }, [selectedCliente]);

            // useEffect para inicializar mapa con pines
            useEffect(() => {
                console.log('🗺️ useEffect del mapa ejecutado');
                console.log('   - activeTab:', activeTab);
                console.log('   - Leaflet disponible:', typeof L !== 'undefined');
                console.log('   - clientesCoordenadas:', clientesCoordenadas);
                console.log('   - Total clientes:', clientes.length);
                
                if (activeTab === 'maps' && typeof L !== 'undefined') {
                    // Esperar un poco para que el DOM esté listo
                    setTimeout(() => {
                        const mapContainer = document.getElementById('clientesMap');
                        console.log('   - Contenedor del mapa encontrado:', !!mapContainer);
                        if (!mapContainer) return;

                        // Limpiar mapa existente
                        if (mapContainer._leaflet_id) {
                            mapContainer._leaflet_id = undefined;
                        }
                        mapContainer.innerHTML = '';

                        // Crear mapa centrado en CDMX
                        const map = L.map('clientesMap').setView([19.4326, -99.1332], 11);

                        // Agregar tiles de OpenStreetMap
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '© OpenStreetMap contributors',
                            maxZoom: 19
                        }).addTo(map);

                        // Filtrar clientes según vendedor seleccionado
                        const clientesFiltrados = filterVendedorMaps === 'todos' 
                            ? clientes 
                            : clientes.filter(c => getClienteVendedor(c) === filterVendedorMaps);

                        console.log('   - Clientes filtrados:', clientesFiltrados.length);
                        console.log('   - Coordenadas disponibles:', Object.keys(clientesCoordenadas));

                        // Agregar marcadores para clientes con coordenadas
                        let markersAdded = 0;
                        clientesFiltrados.forEach(cliente => {
                            // Búsqueda flexible de coordenadas (ignora mayúsculas y espacios extra)
                            const normalizar = (str) => str.trim().toLowerCase().replace(/\s+/g, ' ');
                            const nombreNormalizado = normalizar(cliente.nombre);
                            
                            let coords = clientesCoordenadas[cliente.nombre]; // Búsqueda exacta primero
                            
                            // Si no encuentra exacto, buscar normalizado
                            if (!coords) {
                                const coordKey = Object.keys(clientesCoordenadas).find(key => 
                                    normalizar(key) === nombreNormalizado
                                );
                                coords = coordKey ? clientesCoordenadas[coordKey] : null;
                            }
                            
                            console.log(`   🔍 Buscando coordenadas para: "${cliente.nombre}"`, coords ? '✅ Encontradas' : '❌ No encontradas');
                            
                            if (coords && coords.lat && coords.lng) {
                                const vendedor = getClienteVendedor(cliente);
                                const color = vendedor ? getVendedorColor(vendedor) : '#6b7280';
                                
                                // Crear marcador circular
                                const marker = L.circleMarker([coords.lat, coords.lng], {
                                    radius: 10,
                                    fillColor: color,
                                    color: '#fff',
                                    weight: 3,
                                    opacity: 1,
                                    fillOpacity: 0.8
                                }).addTo(map);

                                // Popup con información
                                marker.bindPopup(`
                                    <div style="font-family: 'Outfit', sans-serif; min-width: 200px;">
                                        <div style="font-weight: 700; font-size: 15px; color: ${color}; margin-bottom: 8px;">
                                            ${cliente.nombre}
                                        </div>
                                        <div style="font-size: 13px; color: #666; margin-bottom: 4px;">
                                            📍 ${cliente.direccion || 'N/A'}
                                        </div>
                                        ${cliente.zona ? `<div style="font-size: 12px; color: #999;">🏙️ ${cliente.zona}</div>` : ''}
                                        ${vendedor ? `<div style="font-size: 12px; color: ${color}; margin-top: 4px; font-weight: 600;">👤 ${vendedor}</div>` : ''}
                                    </div>
                                `);

                                markersAdded++;
                            }
                        });

                        console.log(`🗺️ Mapa inicializado con ${markersAdded} marcadores`);
                    }, 100);
                }
            }, [activeTab, filterVendedorMaps, clientes, clientesCoordenadas]);

            const filteredClientes = clientes.filter(c => {
                const matchesSearch = !searchTerm || 
                    (c.nombre && String(c.nombre).toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (c.sector && String(c.sector).toLowerCase().includes(searchTerm.toLowerCase())) ||
                    (c.zona && String(c.zona).toLowerCase().includes(searchTerm.toLowerCase()));
                
                const matchesCp = !cpFilter || 
                    (c.codigoPostal && String(c.codigoPostal).includes(cpFilter));
                
                return matchesSearch && matchesCp;
            });

            const filteredProductos = searchTerm.trim() === '' 
                ? productos 
                : productos.filter(p => {
                    const search = searchTerm.toLowerCase();
                    const clave = String(p.Clave || '').toLowerCase();
                    const color = String(p.Color || '').toLowerCase();
                    const resina = String(p.Resina || '').toLowerCase();
                    
                    // NUEVA LÓGICA MEJORADA: Buscar por código numérico y Pantone
                    let codigoInterno = '';
                    let pantoneMatch = '';
                    
                    // 1. Extraer código numérico de 4 dígitos de la clave del producto
                    // Ejemplos: "MB RJ 0627-10" -> "0627", "P AM 1223-10" -> "1223"
                    const matchCodigo = p.Clave.match(/\b(\d{4})\b/);
                    if (matchCodigo && matchCodigo[1]) {
                        codigoInterno = matchCodigo[1];
                    }
                    
                    // 2. Obtener el código Pantone asociado a este producto usando coloresRef
                    // Buscar en el JSON: coloresRef tiene estructura {clave: {hex, pantone, nombre}}
                    const colorData = getProductColor(p.Clave);
                    if (colorData && colorData.pantone) {
                        pantoneMatch = String(colorData.pantone).toLowerCase();
                    }
                    
                    // 3. También buscar si el término de búsqueda coincide con algún código interno
                    // que tenga el mismo Pantone (búsqueda inversa)
                    let matchByPantoneSearch = false;
                    if (search.match(/^\d+$/)) { // Si buscan solo números
                        // Buscar en coloresRef si hay alguna clave que contenga este número
                        for (const [claveRef, dataRef] of Object.entries(coloresRef)) {
                            // Si la clave contiene el número buscado
                            if (claveRef.toLowerCase().includes(search)) {
                                // Y si el Pantone de esa clave coincide con el de nuestro producto
                                if (colorData && dataRef.pantone === colorData.pantone) {
                                    matchByPantoneSearch = true;
                                    break;
                                }
                            }
                        }
                    }
                    
                    // BUSCAR POR:
                    // 1. Clave completa (MB RJ 0627-10)
                    // 2. Color descripción (Rojo Sangre)
                    // 3. Resina (PP, PE, etc.)
                    // 4. Código interno de 4 dígitos (0627, 1223)
                    // 5. Código Pantone (3517, 3546, 101)
                    // 6. Búsqueda por código que comparta el mismo Pantone
                    return clave.includes(search) || 
                           color.includes(search) || 
                           resina.includes(search) ||
                           codigoInterno.includes(search) ||
                           pantoneMatch.includes(search) ||
                           matchByPantoneSearch;
                });

            // Pantalla de login
            if (!isAuthenticated) {
                return (
                    <div className="login-overlay">
                        <div className="login-box">
                            <img src="logoari2013.jpg" alt="ARICOLOR" className="login-logo" />
                            <h1 className="login-title">INTEL·ARICOLOR·MX</h1>
                            <p className="login-subtitle">Centro de Inteligencia Comercial</p>
                            
                            <form onSubmit={handleLogin}>
                                <input
                                    type="password"
                                    className="login-input"
                                    placeholder="Contraseña"
                                    value={passwordInput}
                                    onChange={(e) => setPasswordInput(e.target.value)}
                                    autoFocus
                                />
                                <button type="submit" className="login-btn">
                                    🔐 Acceder
                                </button>
                            </form>
                        </div>
                    </div>
                );
            }

            // Pantalla Launcher (Home)
            if (showLauncher) {
                const modules = [
                    {
                        id: 'clientes',
                        label: 'CLIENTES',
                        description: 'Base de datos',
                        icon: '<svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>'
                    },
                    {
                        id: 'productos',
                        label: 'PRODUCTOS',
                        description: 'Catálogo',
                        icon: '<svg viewBox="0 0 24 24"><path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/></svg>'
                    },
                    {
                        id: 'ventas',
                        label: 'VENTAS',
                        description: 'Registro',
                        icon: '<svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>'
                    },
                    {
                        id: 'kpis',
                        label: 'KPIs',
                        description: 'Dashboard',
                        icon: '<svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>'
                    },
                    {
                        id: 'maps',
                        label: 'MAPS',
                        description: 'Ubicaciones',
                        icon: '<svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>'
                    },
                    {
                        id: 'documentos',
                        label: 'DOCUMENTOS',
                        description: 'Archivos',
                        icon: '<svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>'
                    },
                    {
                        id: 'mercado',
                        label: 'MERCADO',
                        description: 'Análisis',
                        icon: '<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>'
                    },
                    {
                        id: 'busqueda',
                        label: 'BÚSQUEDA IA',
                        description: 'Inteligencia',
                        icon: '<svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>'
                    },
                    {
                        id: 'config',
                        label: 'CONFIGURACIÓN',
                        description: 'Ajustes',
                        icon: '<svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94L14.4 2.81c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>'
                    }
                ];

                return (
                    <div className="launcher-overlay">
                        <div className="launcher-container">
                            <div className="launcher-header">
                                <img src="logoari2013.jpg" alt="ARICOLOR" className="launcher-logo" />
                                <h1 className="launcher-title">INTEL·ARICOLOR·MX</h1>
                                <p className="launcher-subtitle">Centro de Inteligencia Comercial</p>
                            </div>
                            
                            <div className="launcher-grid">
                                {modules.map(module => (
                                    <div 
                                        key={module.id} 
                                        className="launcher-card"
                                        onClick={() => {
                                            setShowLauncher(false);
                                            setActiveTab(module.id);
                                        }}
                                    >
                                        <div className="launcher-icon" dangerouslySetInnerHTML={{__html: module.icon}} />
                                        <div className="launcher-label">{module.label}</div>
                                        <div className="launcher-description">{module.description}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            }

            if (!isConfigured) {
                return (
                    <div className="app-container">
                        <div className="header">
                            <h1>INTEL·ARICOLOR·MX</h1>
                            <p className="header-subtitle">Centro de Inteligencia Comercial</p>
                        </div>

                        <div className="content-panel">
                            <div className="setup-panel">
                                <div className="setup-title">🚀 Configuración Inicial</div>
                                <p className="setup-description">
                                    Conecta tu Google Sheet y Asana para activar la plataforma.<br/>
                                    Solo necesitas hacer esto una vez.
                                </p>

                                <div className="input-group">
                                    <label className="input-label">📊 Link CSV de Google Sheet</label>
                                    <input
                                        type="text"
                                        className="input-field"
                                        placeholder="https://docs.google.com/spreadsheets/.../pub?gid=0&single=true&output=csv"
                                        value={csvUrl}
                                        onChange={(e) => setCsvUrl(e.target.value)}
                                    />
                                    <p style={{fontSize: '0.85rem', color: 'var(--text-muted)', marginTop: '0.5rem', lineHeight: '1.5'}}>
                                        💡 <strong>Usa tu link actual:</strong><br/>
                                        <code style={{background: 'rgba(0,217,255,0.1)', padding: '0.25rem 0.5rem', borderRadius: '4px', fontSize: '0.8rem'}}>
                                            https://docs.google.com/spreadsheets/d/e/2PACX-1vRl9fmzoNnqUSqg29otLpAKhbLkgzN72pW1zjet045NQWX9Iyux7BKrIpa1L-wA2VLlqAoGWq2mnIBQ/pub?gid=0&single=true&output=csv
                                        </code>
                                    </p>
                                </div>

                                <div className="input-group">
                                    <label className="input-label">🔐 Token de Asana</label>
                                    <input
                                        type="password"
                                        className="input-field"
                                        placeholder="1/1234567890:abcdef..."
                                        value={asanaToken}
                                        onChange={(e) => setAsanaToken(e.target.value)}
                                    />
                                    <p style={{fontSize: '0.85rem', color: 'var(--text-muted)', marginTop: '0.5rem', lineHeight: '1.5'}}>
                                        💡 <strong>Cómo obtener el token:</strong><br/>
                                        1. En Asana, click en tu foto de perfil<br/>
                                        2. My Settings → Apps → Personal Access Tokens<br/>
                                        3. Click "New access token" → Dale un nombre → Copia el token
                                    </p>
                                </div>

                                <button 
                                    className="btn" 
                                    onClick={saveConfiguration}
                                    disabled={isLoading}
                                >
                                    {isLoading ? 'Conectando...' : 'Conectar Plataforma'}
                                </button>

                                <div style={{marginTop: '2rem', padding: '1.5rem', background: 'rgba(0, 217, 255, 0.05)', borderRadius: '10px', border: '1px solid var(--border)'}}>
                                    <p style={{fontSize: '0.7rem', color: 'var(--text-muted)', lineHeight: '1.6'}}>
                                        ℹ️ <strong>Nota:</strong> Tus credenciales se guardan solo en tu navegador (localStorage). 
                                        Nadie más tiene acceso a ellas. Los datos siempre se cargan en tiempo real desde tus fuentes.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // Función para obtener la URL del logo del cliente
            const renderClientes = () => (
                <>
                    <div className="filters-row">
                        <div className="filter-group">
                            <span className="search-icon">🔍</span>
                            <input
                                type="text"
                                className="search-input"
                                placeholder="Buscar por cliente, sector, o zona..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                        </div>
                        <div className="filter-group filter-group-narrow">
                            <span className="search-icon">📮</span>
                            <input
                                type="text"
                                className="search-input"
                                placeholder="C.P."
                                value={cpFilter}
                                onChange={(e) => setCpFilter(e.target.value)}
                            />
                        </div>
                    </div>

                    {selectedCliente ? (
                        <div className="detail-panel">
                            <div className="detail-header">
                                <div>
                                    <h2 className="detail-title">{selectedCliente.nombre}</h2>
                                    <p className="detail-subtitle">{selectedCliente.sector}</p>
                                </div>
                                <button className="btn btn-secondary" onClick={() => { setSelectedCliente(null); setAsanaData(null); }}>
                                    Cerrar
                                </button>
                            </div>

                            <div style={{marginBottom: '2rem'}}>
                                <div className="info-row">
                                    <span className="info-label">📍 Zona:</span>
                                    <span>{selectedCliente.zona}</span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">👤 Responsable:</span>
                                    <span>{selectedCliente.responsable}</span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">📊 Status:</span>
                                    <span className={`status-badge ${
                                        selectedCliente.status && selectedCliente.status.toLowerCase() === 'activo' 
                                            ? 'status-activo' 
                                            : (selectedCliente.status && (selectedCliente.status.toLowerCase().includes('cerrado') || selectedCliente.status.toLowerCase().includes('quiebra') || selectedCliente.status.toLowerCase() === 'n/a'))
                                                ? 'status-cerrado'
                                                : 'status-inactivo'
                                    }`}>
                                        {selectedCliente.status}
                                    </span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">👤 Contacto:</span>
                                    <span>{selectedCliente.contacto}</span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">📞 Tel. Fijo:</span>
                                    <span>{selectedCliente.telFijo}</span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">📱 Celular:</span>
                                    <span>{selectedCliente.celular}</span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">📧 Email:</span>
                                    <span>{selectedCliente.mail}</span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">📍 Dirección:</span>
                                    <div style={{display: 'flex', gap: '0.5rem', alignItems: 'center'}}>
                                        <span>{selectedCliente.direccion}</span>
                                        {selectedCliente.direccion !== 'N/A' && (
                                            <a 
                                                href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(selectedCliente.direccion)}`}
                                                target="_blank"
                                                className="doc-btn doc-btn-ht"
                                                style={{marginLeft: '0.5rem', fontSize: '0.7rem', padding: '0.3rem 0.6rem'}}
                                                title="Ver en Google Maps"
                                            >
                                                📍 Ver Mapa
                                            </a>
                                        )}
                                    </div>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">📮 C.P.:</span>
                                    <span>{selectedCliente.codigoPostal}</span>
                                </div>
                                {selectedCliente.asana && (
                                    <div className="info-row">
                                        <span className="info-label">🎯 Asana:</span>
                                        <a href={selectedCliente.asana} target="_blank" style={{color: 'var(--accent)', textDecoration: 'underline'}}>
                                            Ver Proyecto
                                        </a>
                                    </div>
                                )}
                            </div>

                            <h3 className="section-title">💰 Productos y Precios</h3>
                            {selectedCliente.productos.length > 0 ? (
                                <table className="product-table">
                                    <thead>
                                        <tr>
                                            <th>Producto</th>
                                            <th>Color</th>
                                            <th>Precio</th>
                                            <th>Documentos</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {selectedCliente.productos.map((prod, idx) => {
                                            const docLinks = getDocumentLinks(prod.nombre);
                                            return (
                                                <tr key={idx}>
                                                    <td>{prod.nombre}</td>
                                                    <td>
                                                        <ColorSwatch productName={prod.nombre} />
                                                    </td>
                                                    <td className="price-cell">{prod.precio}</td>
                                                    <td>
                                                        <div className="doc-buttons">
                                                            {docLinks.ht ? (
                                                                <a href={docLinks.ht} target="_blank" className="doc-btn doc-btn-ht" title="Ver en Drive (busca archivo con R más alto, ej: R3)">
                                                                    📄 HT
                                                                </a>
                                                            ) : (
                                                                <span className="doc-btn doc-btn-unavailable" title="HT no disponible">
                                                                    📄 HT
                                                                </span>
                                                            )}
                                                            {docLinks.hds ? (
                                                                <a href={docLinks.hds} target="_blank" className="doc-btn doc-btn-hds" title="Ver en Drive (busca archivo con R más alto, ej: R3)">
                                                                    📄 HDS
                                                                </a>
                                                            ) : (
                                                                <span className="doc-btn doc-btn-unavailable" title="HDS no disponible">
                                                                    📄 HDS
                                                                </span>
                                                            )}
                                                            <button onClick={() => sendDocByEmail(prod.nombre, 'ht')} className="doc-btn doc-btn-email" title="Enviar por Email">
                                                                📧
                                                            </button>
                                                            <button onClick={() => sendDocByWhatsApp(prod.nombre, 'ht')} className="doc-btn doc-btn-whatsapp" title="Enviar por WhatsApp">
                                                                💬
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            ) : (
                                <p style={{color: 'var(--text-muted)', textAlign: 'center', padding: '2rem'}}>
                                    No hay productos registrados para este cliente
                                </p>
                            )}

                            {/* Sección de Historial de Compras Mensuales */}
                            <div style={{marginTop: '2rem'}}>
                                <h3 className="section-title">📅 Historial de Compras {new Date().getFullYear()}</h3>
                                <div style={{
                                    background: 'white',
                                    borderRadius: '12px',
                                    padding: '1.5rem',
                                    border: '1px solid var(--border-color)',
                                    marginBottom: '1rem'
                                }}>
                                    <p style={{color: 'var(--text-muted)', fontSize: '0.7rem', marginBottom: '1rem'}}>
                                        Marca los meses en los que el cliente realizó compras
                                    </p>
                                    <div style={{
                                        display: 'grid',
                                        gridTemplateColumns: 'repeat(auto-fit, minmax(140px, 1fr))',
                                        gap: '0.75rem'
                                    }}>
                                        {['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'].map((mes, idx) => {
                                            const anio = new Date().getFullYear();
                                            const mesActual = new Date().getMonth(); // 0 = Enero, 11 = Diciembre
                                            const mesPasado = idx < mesActual; // Mes ya pasó
                                            const key = `${selectedCliente.nombre}_${anio}`;
                                            const comprado = comprasMensuales[key]?.[mes] || false;
                                            const sinCompra = mesPasado && !comprado; // Mes pasado sin compra = rojo
                                            
                                            return (
                                                <label 
                                                    key={mes}
                                                    style={{
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        gap: '0.5rem',
                                                        padding: '0.75rem',
                                                        background: comprado 
                                                            ? 'rgba(16, 185, 129, 0.1)' 
                                                            : sinCompra 
                                                                ? 'rgba(239, 68, 68, 0.1)' 
                                                                : 'var(--bg-light)',
                                                        border: comprado 
                                                            ? '2px solid var(--success)' 
                                                            : sinCompra 
                                                                ? '2px solid var(--danger)' 
                                                                : '2px solid var(--border-color)',
                                                        borderRadius: '8px',
                                                        cursor: 'pointer',
                                                        transition: 'all 0.2s',
                                                        userSelect: 'none'
                                                    }}
                                                    onMouseEnter={(e) => {
                                                        if (!comprado && !sinCompra) {
                                                            e.currentTarget.style.background = 'rgba(16, 185, 129, 0.05)';
                                                            e.currentTarget.style.borderColor = 'rgba(16, 185, 129, 0.3)';
                                                        }
                                                    }}
                                                    onMouseLeave={(e) => {
                                                        if (!comprado) {
                                                            e.currentTarget.style.background = sinCompra ? 'rgba(239, 68, 68, 0.1)' : 'var(--bg-light)';
                                                            e.currentTarget.style.borderColor = sinCompra ? 'var(--danger)' : 'var(--border-color)';
                                                        }
                                                    }}
                                                >
                                                    <input
                                                        type="checkbox"
                                                        checked={comprado}
                                                        onChange={() => toggleCompraMensual(selectedCliente.nombre, mes, anio)}
                                                        style={{
                                                            width: '18px',
                                                            height: '18px',
                                                            cursor: 'pointer',
                                                            accentColor: comprado ? 'var(--success)' : sinCompra ? 'var(--danger)' : 'var(--primary)'
                                                        }}
                                                    />
                                                    <span style={{
                                                        fontWeight: comprado ? '600' : sinCompra ? '500' : '400',
                                                        color: comprado ? 'var(--success)' : sinCompra ? 'var(--danger)' : 'var(--text-dark)',
                                                        fontSize: '0.7rem'
                                                    }}>
                                                        {mes}
                                                    </span>
                                                    {comprado && <span style={{marginLeft: 'auto', fontSize: '1rem'}}>✓</span>}
                                                    {sinCompra && <span style={{marginLeft: 'auto', fontSize: '1rem', color: 'var(--danger)'}}>⚠</span>}
                                                </label>
                                            );
                                        })}
                                    </div>
                                    <div style={{
                                        marginTop: '1rem',
                                        padding: '0.75rem',
                                        background: 'rgba(59, 130, 246, 0.05)',
                                        borderRadius: '6px',
                                        borderLeft: '3px solid var(--primary)'
                                    }}>
                                        <div style={{fontSize: '0.85rem', color: 'var(--text-muted)'}}>
                                            <strong style={{color: 'var(--primary)'}}>
                                                {Object.values(comprasMensuales[`${selectedCliente.nombre}_${new Date().getFullYear()}`] || {}).filter(Boolean).length}/12 meses
                                            </strong> con compras este año
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Sección de Notas del Cliente */}
                            {(() => {
                                const notasCliente = notas.filter(n => n.cliente === selectedCliente.nombre);
                                return (
                                    <div style={{marginTop: '2rem'}}>
                                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '1rem'}}>
                                            <h3 className="section-title">📝 Notas del Cliente ({notasCliente.length})</h3>
                                            <div style={{display: 'flex', gap: '0.5rem'}}>
                                                {notasCliente.length > 5 && (
                                                    <button 
                                                        className="btn btn-secondary"
                                                        style={{fontSize: '0.85rem', padding: '0.5rem 1rem'}}
                                                        onClick={() => setActiveTab('notas')}
                                                    >
                                                        Ver todas
                                                    </button>
                                                )}
                                                <button 
                                                    className="btn"
                                                    style={{fontSize: '0.85rem', padding: '0.5rem 1rem'}}
                                                    onClick={() => {
                                                        setNuevaNota({ cliente: selectedCliente.nombre, texto: '' });
                                                        setActiveTab('notas');
                                                    }}
                                                >
                                                    ✍️ Agregar Nota
                                                </button>
                                            </div>
                                        </div>
                                        
                                        {notasCliente.length === 0 ? (
                                            <p style={{color: 'var(--text-muted)', textAlign: 'center', padding: '2rem', background: 'var(--bg-light)', borderRadius: '8px'}}>
                                                No hay notas para este cliente
                                            </p>
                                        ) : (
                                            <div style={{display: 'flex', flexDirection: 'column', gap: '0.75rem'}}>
                                                {notasCliente.slice(0, 5).map((nota) => (
                                                    <div key={nota.id} className="nota-item" style={{marginBottom: 0}}>
                                                        <div className="nota-header">
                                                            <span className="nota-fecha">{nota.fecha}</span>
                                                        </div>
                                                        <div 
                                                            className="nota-texto" 
                                                            style={{fontSize: '0.7rem'}}
                                                            dangerouslySetInnerHTML={{ 
                                                                __html: highlightMentions(nota.texto.length > 150 ? `${nota.texto.substring(0, 150)}...` : nota.texto) 
                                                            }}
                                                            onClick={handleMentionClick}
                                                        />
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                );
                            })()}

                            {asanaData && (
                                <div className="asana-panel">
                                    <h3 className="section-title">📊 Dashboard Asana</h3>
                                    
                                    <div className="asana-stats">
                                        {Object.entries(asanaData.sections).map(([section, count]) => (
                                            <div key={section} className="asana-stat">
                                                <div className="asana-stat-number">{count}</div>
                                                <div className="asana-stat-label">{section}</div>
                                            </div>
                                        ))}
                                    </div>

                                    <h3 className="section-title" style={{marginTop: '1.5rem'}}>📋 Actividad Reciente (Últimos 4 meses)</h3>
                                    <div className="task-list scrollbar">
                                        {asanaData.tasks
                                            .filter(task => {
                                                const taskDate = new Date(task.created_at);
                                                const fourMonthsAgo = new Date();
                                                fourMonthsAgo.setMonth(fourMonthsAgo.getMonth() - 4);
                                                return taskDate >= fourMonthsAgo;
                                            })
                                            .map(task => (
                                                <div key={task.gid} className="task-item">
                                                    <div className="task-name">{task.name}</div>
                                                    <div className="task-meta">
                                                        <span>📅 {new Date(task.created_at).toLocaleDateString('es-MX')}</span>
                                                        <span>📌 {task.memberships?.[0]?.section?.name || 'Sin Sección'}</span>
                                                        {task.completed && <span style={{color: 'var(--success)'}}>✅ Completado</span>}
                                                    </div>
                                                </div>
                                            ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    ) : (
                        <>
                            {isLoading ? (
                                <div className="loading">Cargando clientes...</div>
                            ) : (
                                <div className="grid">
                                    {filteredClientes.map((cliente, idx) => {
                                        const phoneNumber = cliente.celular !== 'N/A' ? cliente.celular : (cliente.telFijo !== 'N/A' ? cliente.telFijo : null);
                                        return (
                                            <div key={idx} className="card" onClick={() => setSelectedCliente(cliente)}>
                                                {phoneNumber && (
                                                    <a 
                                                        href={`tel:${phoneNumber.replace(/[^0-9+]/g, '')}`}
                                                        className="call-btn"
                                                        onClick={(e) => e.stopPropagation()}
                                                        title={`Llamar a ${phoneNumber}`}
                                                    >
                                                        📞
                                                    </a>
                                                )}
                                                {!phoneNumber && (
                                                    <div 
                                                        className="call-btn call-btn-disabled"
                                                        title="Sin teléfono"
                                                    >
                                                        📞
                                                    </div>
                                                )}
                                                <h3 className="card-title">{cliente.nombre}</h3>
                                                <div className="card-title-bar"></div>
                                                <p className="card-subtitle">{cliente.sector}</p>
                                            <div className="info-row">
                                                <span className="info-label">📍 Zona:</span>
                                                <span>{cliente.zona}</span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">👤 Responsable:</span>
                                                <span>{cliente.responsable}</span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">📦 Productos:</span>
                                                <span>{cliente.productos.length}</span>
                                            </div>
                                            <div style={{marginTop: '0.75rem'}}>
                                                <span className={`status-badge ${
                                                    cliente.status && cliente.status.toLowerCase() === 'activo' 
                                                        ? 'status-activo' 
                                                        : (cliente.status && (cliente.status.toLowerCase().includes('cerrado') || cliente.status.toLowerCase().includes('quiebra') || cliente.status.toLowerCase() === 'n/a'))
                                                            ? 'status-cerrado'
                                                            : 'status-inactivo'
                                                }`}>
                                                    {cliente.status}
                                                </span>
                                            </div>
                                        </div>
                                        );
                                    })}
                                </div>
                            )}

                            {filteredClientes.length === 0 && !isLoading && (
                                <div className="empty-state">
                                    <div className="empty-state-icon">🔍</div>
                                    <p>No se encontraron clientes</p>
                                </div>
                            )}
                        </>
                    )}
                </>
            );

            // Función para obtener clientes que compran un color específico
            const getClientesPorColor = (clave) => {
                if (!clave) return [];
                
                return clientes.filter(cliente => {
                    if (!cliente.productos || cliente.productos.length === 0) return false;
                    
                    return cliente.productos.some(prod => {
                        const nombreProd = (prod.nombre || '').trim().toLowerCase();
                        const claveSearch = clave.trim().toLowerCase();
                        
                        // Buscar coincidencia exacta o parcial
                        return nombreProd.includes(claveSearch) || claveSearch.includes(nombreProd);
                    });
                }).map(cliente => ({
                    nombre: cliente.nombre,
                    cp: cliente.cp,
                    zona: cliente.zona,
                    sector: cliente.sector,
                    volumen: cliente.productos.find(p => 
                        (p.nombre || '').toLowerCase().includes(clave.toLowerCase())
                    )?.volumen || 'N/A'
                }));
            };

            const renderProductos = () => (
                <>
                    <div className="search-container">
                        <span className="search-icon">🔍</span>
                        <input
                            type="text"
                            className="search-input"
                            placeholder="Buscar por clave, color, resina..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                    </div>

                    <h3 className="section-title">📦 Catálogo Técnico ({filteredProductos.length} productos)</h3>
                    
                    <div style={{maxHeight: '600px', overflowY: 'auto'}} className="scrollbar">
                        <table className="product-table">
                            <thead>
                                <tr>
                                    <th>Clave</th>
                                    <th>Color Descripción</th>
                                    <th>Pantone/HEX</th>
                                    <th>Resina</th>
                                    <th>Acabado</th>
                                    <th>Certificación</th>
                                    <th>Aplicación</th>
                                    <th>Documentos</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredProductos.slice(0, 100).map((prod, idx) => {
                                    const docLinks = getDocumentLinks(prod.Clave || '');
                                    return (
                                        <tr key={idx}>
                                            <td 
                                                style={{
                                                    fontFamily: 'IBM Plex Mono, monospace', 
                                                    color: 'var(--aricolor-blue)', 
                                                    fontWeight: '600',
                                                    cursor: 'pointer',
                                                    textDecoration: 'underline',
                                                    transition: 'all 0.2s'
                                                }}
                                                onClick={() => {
                                                    const clientesCompran = getClientesPorColor(prod.Clave);
                                                    setClientesModalColor({
                                                        clave: prod.Clave,
                                                        color: prod.Color,
                                                        clientes: clientesCompran
                                                    });
                                                }}
                                                onMouseEnter={(e) => e.target.style.opacity = '0.7'}
                                                onMouseLeave={(e) => e.target.style.opacity = '1'}
                                                title="Click para ver clientes que compran este color"
                                            >
                                                {prod.Clave} 👥
                                            </td>
                                            <td>{prod.Color}</td>
                                            <td>
                                                <ColorSwatch productName={prod.Clave} />
                                            </td>
                                            <td style={{fontSize: '0.85rem'}}>{prod.Resina}</td>
                                            <td>{prod.Acabado}</td>
                                            <td style={{fontSize: '0.85rem'}}>{prod.Certificacion}</td>
                                            <td>{prod.Aplicacion}</td>
                                            <td>
                                                <div className="doc-buttons">
                                                    {docLinks.ht ? (
                                                        <a href={docLinks.ht} target="_blank" className="doc-btn doc-btn-ht" title="Ver en Drive (busca archivo con R más alto, ej: R3)">
                                                            📄 HT
                                                        </a>
                                                    ) : (
                                                        <span className="doc-btn doc-btn-unavailable" title="HT no disponible">
                                                            📄 HT
                                                        </span>
                                                    )}
                                                    {docLinks.hds ? (
                                                        <a href={docLinks.hds} target="_blank" className="doc-btn doc-btn-hds" title="Ver en Drive (busca archivo con R más alto, ej: R3)">
                                                            📄 HDS
                                                        </a>
                                                    ) : (
                                                        <span className="doc-btn doc-btn-unavailable" title="HDS no disponible">
                                                            📄 HDS
                                                        </span>
                                                    )}
                                                    <button onClick={() => sendDocByEmail(prod.Clave, 'ht')} className="doc-btn doc-btn-email" title="Enviar por Email">
                                                        📧
                                                    </button>
                                                    <button onClick={() => sendDocByWhatsApp(prod.Clave, 'ht')} className="doc-btn doc-btn-whatsapp" title="Enviar por WhatsApp">
                                                        💬
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    );
                                })}
                            </tbody>
                        </table>
                        {filteredProductos.length > 100 && (
                            <p style={{textAlign: 'center', color: 'var(--text-muted)', padding: '1rem'}}>
                                Mostrando 100 de {filteredProductos.length} resultados. Refina tu búsqueda para ver más.
                            </p>
                        )}
                    </div>
                </>
            );

            const renderDocumentos = () => {
                const documentos = [
                    {
                        categoria: '📊 Reportes',
                        archivos: [
                            {
                                nombre: 'Reporte Flash Diario',
                                descripcion: 'Formato de reporte diario (2-3 min al final del día)',
                                archivo: 'reporte_flash_diario_aricolor.pdf',
                                icono: '⚡'
                            },
                            {
                                nombre: 'Reporte Semanal Ejecutivo',
                                descripcion: 'Template para junta de lunes - KPIs, Pipeline, Compromisos',
                                archivo: 'reporte_semanal_ejecutivo_aricolor.pdf',
                                icono: '📈'
                            },
                            {
                                nombre: 'Reporte Flash Móvil',
                                descripcion: 'Versión HTML optimizada para móvil',
                                archivo: 'reporte_flash_movil.html',
                                icono: '📱'
                            }
                        ]
                    },
                    {
                        categoria: '📅 Juntas y Protocolos',
                        archivos: [
                            {
                                nombre: 'Junta Pipeline Lunes',
                                descripcion: 'Agenda estructurada (45 min) - 7 puntos clave',
                                archivo: 'junta_pipeline_lunes_aricolor__1_.pdf',
                                icono: '🗓️'
                            },
                            {
                                nombre: 'Reglas de Seguimiento Comercial',
                                descripcion: 'Protocolo obligatorio - Tiempos máximos de respuesta',
                                archivo: 'reglas_seguimiento_aricolor__1_.pdf',
                                icono: '⏰'
                            }
                        ]
                    }
                ];

                return (
                    <div className="detail-panel">
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem'}}>
                            <div>
                                <h2 className="section-title">📁 Centro de Documentos</h2>
                                <p style={{color: 'var(--text-muted)', marginTop: '0.5rem'}}>
                                    Reportes, formatos y protocolos comerciales
                                </p>
                            </div>
                        </div>

                        {documentos.map((categoria, idx) => (
                            <div key={idx} style={{marginBottom: '3rem'}}>
                                <h3 style={{
                                    fontSize: '1.3rem',
                                    fontWeight: '600',
                                    color: 'var(--aricolor-blue)',
                                    marginBottom: '1.5rem',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '0.75rem'
                                }}>
                                    {categoria.categoria}
                                </h3>

                                <div style={{
                                    display: 'grid',
                                    gridTemplateColumns: 'repeat(auto-fill, minmax(320px, 1fr))',
                                    gap: '1.5rem'
                                }}>
                                    {categoria.archivos.map((doc, docIdx) => (
                                        <div 
                                            key={docIdx}
                                            style={{
                                                background: 'white',
                                                border: '2px solid var(--border)',
                                                borderRadius: '12px',
                                                padding: '1.5rem',
                                                transition: 'all 0.3s',
                                                cursor: 'pointer',
                                                display: 'flex',
                                                flexDirection: 'column',
                                                gap: '1rem'
                                            }}
                                            onMouseEnter={(e) => {
                                                e.currentTarget.style.borderColor = 'var(--aricolor-blue)';
                                                e.currentTarget.style.transform = 'translateY(-4px)';
                                                e.currentTarget.style.boxShadow = '0 8px 24px rgba(0, 51, 204, 0.15)';
                                            }}
                                            onMouseLeave={(e) => {
                                                e.currentTarget.style.borderColor = 'var(--border)';
                                                e.currentTarget.style.transform = 'translateY(0)';
                                                e.currentTarget.style.boxShadow = 'none';
                                            }}
                                        >
                                            <div style={{display: 'flex', alignItems: 'flex-start', gap: '1rem'}}>
                                                <div style={{
                                                    fontSize: '2.5rem',
                                                    flexShrink: 0
                                                }}>
                                                    {doc.icono}
                                                </div>
                                                <div style={{flex: 1}}>
                                                    <h4 style={{
                                                        fontSize: '1.1rem',
                                                        fontWeight: '600',
                                                        color: 'var(--text-dark)',
                                                        marginBottom: '0.5rem'
                                                    }}>
                                                        {doc.nombre}
                                                    </h4>
                                                    <p style={{
                                                        fontSize: '0.7rem',
                                                        color: 'var(--text-muted)',
                                                        lineHeight: '1.5'
                                                    }}>
                                                        {doc.descripcion}
                                                    </p>
                                                </div>
                                            </div>

                                            <a
                                                href={doc.archivo}
                                                download
                                                style={{
                                                    display: 'inline-flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    gap: '0.5rem',
                                                    padding: '0.75rem 1.5rem',
                                                    background: 'var(--aricolor-blue)',
                                                    color: 'white',
                                                    borderRadius: '8px',
                                                    textDecoration: 'none',
                                                    fontSize: '0.95rem',
                                                    fontWeight: '600',
                                                    transition: 'all 0.2s',
                                                    width: '100%'
                                                }}
                                                onMouseEnter={(e) => {
                                                    e.currentTarget.style.background = 'var(--secondary)';
                                                    e.currentTarget.style.transform = 'scale(1.02)';
                                                }}
                                                onMouseLeave={(e) => {
                                                    e.currentTarget.style.background = 'var(--aricolor-blue)';
                                                    e.currentTarget.style.transform = 'scale(1)';
                                                }}
                                            >
                                                <span>📥</span>
                                                <span>Descargar {doc.archivo.endsWith('.pdf') ? 'PDF' : 'HTML'}</span>
                                            </a>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        ))}

                        {/* Información adicional */}
                        <div style={{
                            background: 'linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)',
                            border: '2px solid #3b82f6',
                            borderRadius: '12px',
                            padding: '1.5rem',
                            marginTop: '2rem'
                        }}>
                            <h4 style={{
                                fontSize: '1.1rem',
                                fontWeight: '600',
                                color: '#1e40af',
                                marginBottom: '0.75rem'
                            }}>
                                💡 Cómo usar estos documentos
                            </h4>
                            <ul style={{
                                color: '#1e40af',
                                lineHeight: '1.8',
                                fontSize: '0.95rem',
                                paddingLeft: '1.5rem'
                            }}>
                                <li><strong>Reporte Flash Diario:</strong> Llenar al final de cada día (2-3 minutos)</li>
                                <li><strong>Reporte Semanal:</strong> Preparar antes de la junta del lunes</li>
                                <li><strong>Junta Pipeline:</strong> Agenda estructurada de 45 minutos</li>
                                <li><strong>Reglas de Seguimiento:</strong> Protocolo obligatorio de tiempos de respuesta</li>
                            </ul>
                        </div>
                    </div>
                );
            };

            const renderMercado = () => (
                <div className="detail-panel">
                    <h2 className="section-title">📊 Análisis de Mercado</h2>
                    <p style={{color: 'var(--text-muted)', marginBottom: '2rem'}}>
                        Perspectivas y datos del mercado mexicano de polímeros y pigmentos
                    </p>

                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '1.5rem'}}>
                        <div className="config-panel">
                            <h3 className="section-title">Polímeros en México</h3>
                            <p style={{color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Polietileno:</strong> Braskem Idesa único productor integrado (1.05M ton/año). Dow líder en tecnología y distribución.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Polipropileno:</strong> Indelpro (Alpek) único productor nacional. Mercado complementado con importaciones.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>PVC:</strong> Orbia (Vestolit) líder con múltiples plantas. Capacidad total >700K ton/año en México.
                            </p>
                        </div>

                        <div className="config-panel">
                            <h3 className="section-title">Recubrimientos</h3>
                            <p style={{color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Arquitectónicos:</strong> PPG Comex domina con ~50% mercado. Sherwin-Williams segundo jugador importante.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Industriales:</strong> BASF líder en automotriz OEM. PPG y Sherwin-Williams fuertes en general industrial.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Capacidad:</strong> PPG Comex produce 1.3-1.5M litros/día en temporada alta.
                            </p>
                        </div>

                        <div className="config-panel">
                            <h3 className="section-title">Pigmentos</h3>
                            <p style={{color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Líderes:</strong> Clariant especializada en preparaciones pigmentarias. BASF y PPG integrados en recubrimientos.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Tecnología:</strong> México produce preparaciones acuosas y solvente de última generación.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Aplicaciones:</strong> Automotriz, construcción, impresión, plásticos, textiles.
                            </p>
                        </div>

                        <div className="config-panel">
                            <h3 className="section-title">Tendencias Clave</h3>
                            <div style={{color: 'var(--text)', lineHeight: '1.9', fontSize: '0.95rem'}}>
                                <div>▸ Economía circular: Inversión en reciclado (PET, PE, PP)</div>
                                <div>▸ Sustentabilidad: Productos bajos en VOC, bio-basados</div>
                                <div>▸ Nearshoring: Expansión de capacidad productiva</div>
                                <div>▸ Tecnología: Metalocenos, polímeros especiales</div>
                                <div>▸ Certificaciones: ISO 9001, 14001, IATF 16949</div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const renderBusquedaIA = () => {
                const handleSearch = async () => {
                    if (!iaQuery.trim()) return;
                    
                    setIaSearching(true);
                    const searchLower = iaQuery.toLowerCase();
                    
                    // Buscar en clientes
                    const clientesEncontrados = clientes.filter(c => 
                        (c.nombre && c.nombre.toLowerCase().includes(searchLower)) ||
                        (c.sector && c.sector.toLowerCase().includes(searchLower)) ||
                        (c.zona && c.zona.toLowerCase().includes(searchLower)) ||
                        (c.productos && c.productos.some(p => p.nombre && p.nombre.toLowerCase().includes(searchLower)))
                    ).slice(0, 5);

                    // Buscar en productos
                    const productosEncontrados = productos.filter(p =>
                        (p.Clave && p.Clave.toLowerCase().includes(searchLower)) ||
                        (p.Color && p.Color.toLowerCase().includes(searchLower)) ||
                        (p.Resina && p.Resina.toLowerCase().includes(searchLower)) ||
                        (p.Aplicacion && p.Aplicacion.toLowerCase().includes(searchLower))
                    ).slice(0, 10);

                    setIaResults({
                        clientes: clientesEncontrados,
                        productos: productosEncontrados,
                        query: iaQuery
                    });
                    setIaSearching(false);
                };

                return (
                    <div className="detail-panel">
                        <h2 className="section-title">🔍 Búsqueda Avanzada</h2>
                        <p style={{color: 'var(--text-muted)', marginBottom: '2rem'}}>
                            Busca en toda la base de datos: clientes, productos, sectores, y más
                        </p>

                        <div className="search-container">
                            <span className="search-icon">🤖</span>
                            <input
                                type="text"
                                className="search-input"
                                placeholder="Ej: Buscar cliente por producto, sector, zona..."
                                value={iaQuery}
                                onChange={(e) => setIaQuery(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                            />
                        </div>

                        <button 
                            className="btn" 
                            onClick={handleSearch}
                            disabled={iaSearching || !iaQuery.trim()}
                        >
                            {iaSearching ? 'Buscando...' : '🔍 Buscar'}
                        </button>

                        {iaResults && (
                            <div style={{marginTop: '2rem'}}>
                                <h3 className="section-title">Resultados para: "{iaResults.query}"</h3>
                                
                                {iaResults.clientes.length > 0 && (
                                    <div style={{marginBottom: '2rem'}}>
                                        <h4 style={{color: 'var(--aricolor-blue)', marginBottom: '1rem'}}>
                                            👥 Clientes ({iaResults.clientes.length})
                                        </h4>
                                        <div className="grid" style={{gridTemplateColumns: 'repeat(auto-fill, minmax(250px, 1fr))'}}>
                                            {iaResults.clientes.map((cliente, idx) => (
                                                <div key={idx} className="card" onClick={() => {setSelectedCliente(cliente); setActiveTab('clientes');}}>
                                                    <h3 className="card-title">{cliente.nombre}</h3>
                                                    <div className="card-title-bar"></div>
                                                    <p className="card-subtitle">{cliente.sector}</p>
                                                    <div className="info-row">
                                                        <span className="info-label">📦 Productos:</span>
                                                        <span>{cliente.productos.length}</span>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {iaResults.productos.length > 0 && (
                                    <div>
                                        <h4 style={{color: 'var(--aricolor-blue)', marginBottom: '1rem'}}>
                                            📦 Productos ({iaResults.productos.length})
                                        </h4>
                                        <table className="product-table">
                                            <thead>
                                                <tr>
                                                    <th>Clave</th>
                                                    <th>Color</th>
                                                    <th>Resina</th>
                                                    <th>Aplicación</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {iaResults.productos.map((prod, idx) => (
                                                    <tr key={idx}>
                                                        <td style={{fontFamily: 'IBM Plex Mono, monospace', color: 'var(--aricolor-blue)', fontWeight: '600'}}>{prod.Clave}</td>
                                                        <td>{prod.Color}</td>
                                                        <td style={{fontSize: '0.85rem'}}>{prod.Resina}</td>
                                                        <td>{prod.Aplicacion}</td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                )}

                                {iaResults.clientes.length === 0 && iaResults.productos.length === 0 && (
                                    <div className="empty-state">
                                        <div className="empty-state-icon">🔍</div>
                                        <p>No se encontraron resultados</p>
                                    </div>
                                )}
                            </div>
                        )}

                        {!iaResults && (
                            <div style={{marginTop: '2rem'}}>
                                <h3 className="section-title">💡 Ejemplos de Búsqueda</h3>
                                <div style={{color: 'var(--text-muted)', lineHeight: '1.9', fontSize: '0.95rem'}}>
                                    <div>▸ Buscar clientes del sector "Bolsas"</div>
                                    <div>▸ Productos con resina "PP"</div>
                                    <div>▸ Clientes en zona "CDMX"</div>
                                    <div>▸ Productos color "Azul"</div>
                                    <div>▸ Cualquier código de producto (MB AM-1234)</div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            const renderNotificaciones = () => {
                const misNotificaciones = notificaciones.filter(n => 
                    n.to.toLowerCase() === currentUser.toLowerCase()
                );
                const noLeidas = misNotificaciones.filter(n => !n.leida);

                return (
                    <div className="notifications-container">
                        <h2 className="section-title">
                            🔔 Notificaciones {noLeidas.length > 0 && `(${noLeidas.length} nuevas)`}
                        </h2>

                        {misNotificaciones.length === 0 ? (
                            <div className="no-notifications">
                                <div className="no-notifications-icon">🔕</div>
                                <h3>No tienes notificaciones</h3>
                                <p>Cuando alguien te mencione con @ recibirás notificaciones aquí</p>
                            </div>
                        ) : (
                            <div>
                                {misNotificaciones.map(notif => (
                                    <div 
                                        key={notif.id} 
                                        className={`notification-item ${!notif.leida ? 'unread' : ''}`}
                                        onClick={() => !notif.leida && marcarNotificacionLeida(notif.id)}
                                    >
                                        <div className="notification-header">
                                            <span className="notification-from">
                                                {notif.from} te mencionó en {notif.cliente}
                                            </span>
                                            <span className="notification-date">{notif.fecha}</span>
                                        </div>
                                        <div 
                                            className="notification-content"
                                            dangerouslySetInnerHTML={{ __html: highlightMentions(notif.texto) }}
                                            onClick={handleMentionClick}
                                        />
                                        {!notif.leida && (
                                            <button 
                                                className="mark-read-btn"
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    marcarNotificacionLeida(notif.id);
                                                }}
                                            >
                                                Marcar como leída
                                            </button>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                );
            };

            const renderNotas = () => (
                <div className="detail-panel">
                    <h2 className="section-title">📝 Cuaderno de Notas</h2>
                    <p style={{color: 'var(--text-muted)', marginBottom: '2rem'}}>
                        Registra notas y comentarios importantes sobre clientes
                    </p>

                    {/* Formulario para nueva nota */}
                    <div className="nota-form">
                        <h3 className="section-title" style={{fontSize: '1.1rem', marginBottom: '1rem'}}>
                            ✍️ Nueva Nota
                        </h3>
                        
                        <select
                            className="nota-select"
                            value={nuevaNota.cliente}
                            onChange={(e) => setNuevaNota({...nuevaNota, cliente: e.target.value})}
                        >
                            <option value="">Seleccionar cliente...</option>
                            {clientes.map((c, idx) => (
                                <option key={idx} value={c.nombre}>{c.nombre}</option>
                            ))}
                        </select>

                        <div className="textarea-with-mentions" style={{position: 'relative'}}>
                            <textarea
                                ref={textareaRef}
                                className="nota-textarea"
                                placeholder="Escribe tu nota aquí... (@ para usuarios, # para clientes)"
                                value={nuevaNota.texto}
                                onChange={handleTextareaChange}
                                onKeyDown={(e) => {
                                    handleKeyDown(e);
                                    if (e.key === 'Enter' && e.ctrlKey && !mentionAutocomplete.show) {
                                        e.preventDefault();
                                        guardarNota();
                                    }
                                }}
                            />

                            {/* Dropdown de autocomplete */}
                            {mentionAutocomplete.show && (
                                <div 
                                    className="mention-autocomplete"
                                    style={{
                                        top: `${mentionAutocomplete.position.top}px`,
                                        left: `${mentionAutocomplete.position.left}px`
                                    }}
                                >
                                    {mentionAutocomplete.users.map((item, idx) => (
                                        <div
                                            key={idx}
                                            className={`mention-option ${idx === mentionAutocomplete.selected ? 'selected' : ''}`}
                                            onClick={() => insertMention(item)}
                                            onMouseEnter={() => setMentionAutocomplete(prev => ({ ...prev, selected: idx }))}
                                        >
                                            <div className="user-icon">
                                                {mentionAutocomplete.type === 'user' ? '👤' : '🏢'}
                                            </div>
                                            <div className="user-name">
                                                {mentionAutocomplete.type === 'user' ? `@${item}` : `#${item}`}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>

                        <button 
                            className="btn"
                            onClick={guardarNota}
                            disabled={!nuevaNota.cliente || !nuevaNota.texto.trim()}
                        >
                            ✅ Guardar Nota
                        </button>
                        <p style={{color: 'var(--text-muted)', fontSize: '0.85rem', marginTop: '0.5rem'}}>
                            Tip: Ctrl + Enter para guardar rápido
                        </p>
                    </div>

                    {/* Lista de notas */}
                    <h3 className="section-title">📚 Historial de Notas ({notas.length})</h3>
                    
                    {notas.length === 0 ? (
                        <div className="empty-state">
                            <div className="empty-state-icon">📝</div>
                            <p>No hay notas registradas</p>
                        </div>
                    ) : (
                        <div style={{maxHeight: '600px', overflowY: 'auto'}} className="scrollbar">
                            {notas.map((nota) => (
                                <div key={nota.id} className="nota-item">
                                    <div className="nota-header">
                                        <span 
                                            className="nota-cliente" 
                                            style={{cursor: 'pointer', textDecoration: 'underline'}}
                                            onClick={() => {
                                                const cliente = clientes.find(c => c.nombre === nota.cliente);
                                                if (cliente) {
                                                    setSelectedCliente(cliente);
                                                    setActiveTab('clientes');
                                                } else {
                                                    alert('Cliente no encontrado: ' + nota.cliente);
                                                }
                                            }}
                                            title="Click para ver ficha del cliente"
                                        >
                                            {nota.cliente}
                                        </span>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '1rem'}}>
                                            <div style={{display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: '0.25rem'}}>
                                                <span style={{fontSize: '0.85rem', color: 'var(--text-muted)', fontWeight: '500'}}>
                                                    👤 {nota.usuario || 'Usuario'}
                                                </span>
                                                <span className="nota-fecha">{nota.fecha}</span>
                                            </div>
                                            {currentUser === 'Admin' && (
                                                <button
                                                    onClick={() => {
                                                        if (confirm('¿Eliminar esta nota? Esta acción no se puede deshacer.')) {
                                                            const nuevasNotas = notas.filter(n => n.id !== nota.id);
                                                            setNotas(nuevasNotas);
                                                            localStorage.setItem('aricolor_notas', JSON.stringify(nuevasNotas));
                                                        }
                                                    }}
                                                    style={{
                                                        background: 'transparent',
                                                        border: 'none',
                                                        color: '#dc3545',
                                                        cursor: 'pointer',
                                                        fontSize: '1.2rem',
                                                        padding: '0.25rem',
                                                        transition: 'transform 0.2s'
                                                    }}
                                                    onMouseEnter={(e) => e.target.style.transform = 'scale(1.2)'}
                                                    onMouseLeave={(e) => e.target.style.transform = 'scale(1)'}
                                                    title="Eliminar nota (Solo Admin)"
                                                >
                                                    🗑️
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    <div 
                                        className="nota-texto"
                                        dangerouslySetInnerHTML={{ __html: highlightMentions(nota.texto) }}
                                        onClick={handleMentionClick}
                                    />
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );

            // Función para renderizar KPIs Dashboard
            const renderKPIs = () => {
                // DATOS REALES - ARICOLOR 2026
                // URL del CSV publicado desde Google Sheets
                const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTIcDTg3D09wXFBS6X0ojraTnR2269tGUu-tQ8NKUT0rv4DZh5f1KAtYoT5yxeh5udvk5XKOIlifOVk/pub?gid=2130912542&single=true&output=csv';
                
                // Datos por defecto (si falla el CSV)
                const datosDefault = {
                    YTD_2026_USD: 4409225,
                    YTD_2026_KG: 35471,
                    TOTAL_2025_USD: 55783862,
                    TOTAL_2025_KG: 388526,
                    META_EXCELENCIA: 6647246,
                    META_CRECIMIENTO: 61362248
                };

                // Datos 2025 completos - mes por mes
                const datos2025Mensual = {
                    enero: { usd: 4775549, kg: 30229 },
                    febrero: { usd: 4186150, kg: 28269 },
                    marzo: { usd: 5475524, kg: 35777 },
                    abril: { usd: 5141457, kg: 33721 },
                    mayo: { usd: 4496038, kg: 30175 },
                    junio: { usd: 4216500, kg: 30986 },
                    julio: { usd: 5485065, kg: 40557 },
                    agosto: { usd: 3994168, kg: 26020 },
                    septiembre: { usd: 3979246, kg: 27725 },
                    octubre: { usd: 5142550, kg: 38439 },
                    noviembre: { usd: 4335962, kg: 33729 },
                    diciembre: { usd: 4555652, kg: 33065 }
                };

                // Datos 2026 - solo lo que hay disponible
                const datos2026Mensual = {
                    enero: { usd: 4409225, kg: 35471 }
                    // Febrero, Marzo, etc. se agregarán conforme haya datos
                };

                const datos2026 = {
                    enero: datos2026Mensual.enero
                };

                const datos2025 = {
                    enero: datos2025Mensual.enero,
                    total_anual: { 
                        usd: datosDefault.TOTAL_2025_USD, 
                        kg: datosDefault.TOTAL_2025_KG 
                    }
                };

                const metas = {
                    excelencia_usd: datosDefault.META_EXCELENCIA,
                    crecimiento_usd: datosDefault.META_CRECIMIENTO
                };

                // Cálculos YTD
                const ytd_2026_usd = datos2026.enero.usd;
                const ytd_2026_kg = datos2026.enero.kg;
                const ytd_2025_enero_usd = datos2025.enero.usd;
                const ytd_2025_enero_kg = datos2025.enero.kg;

                const porcentaje_vs_2025_usd = ((ytd_2026_usd - ytd_2025_enero_usd) / ytd_2025_enero_usd * 100).toFixed(1);
                const porcentaje_vs_2025_kg = ((ytd_2026_kg - ytd_2025_enero_kg) / ytd_2025_enero_kg * 100).toFixed(1);
                const cumplimiento_excelencia = (ytd_2026_usd / metas.excelencia_usd * 100).toFixed(1);
                const cumplimiento_crecimiento = (ytd_2026_usd / metas.crecimiento_usd * 100).toFixed(1);

                // Top clientes YTD - Estimados proporcionales
                const topClientes = [
                    { nombre: "INDUSTRIAS JLC", usd: 450000, kg: 32000 },
                    { nombre: "PLASTICOS ITALIANOS", usd: 380000, kg: 28000 },
                    { nombre: "GOPLAS", usd: 320000, kg: 21000 },
                    { nombre: "INDUSTRIAS MAN", usd: 280000, kg: 19000 },
                    { nombre: "KLUMEXSA", usd: 250000, kg: 17000 }
                ];

                // Desempeño por vendedor - Estimado YTD
                const porVendedor = [
                    { nombre: "Germán", usd: 1500000, kg: 12000, meta: 2200000, color: '#10b981' },
                    { nombre: "Martín", usd: 1200000, kg: 9000, meta: 1800000, color: '#3b82f6' },
                    { nombre: "Angélica", usd: 900000, kg: 7000, meta: 1500000, color: '#ef4444' },
                    { nombre: "Luis Fernando", usd: 600000, kg: 4500, meta: 1000000, color: '#f97316' },
                    { nombre: "Luis Guillermo", usd: 400000, kg: 3000, meta: 800000, color: '#8b5cf6' },
                    { nombre: "Puebla", usd: 300000, kg: 2000, meta: 700000, color: '#6b7280' }
                ];

                return (
                    <div className="detail-panel">
                        <div style={{display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '2rem', flexWrap: 'wrap', gap: '1rem'}}>
                            <div>
                                <h2 className="section-title">📊 Dashboard de Ventas ARICOLOR - 2026</h2>
                                <div style={{fontSize: '0.85rem', color: 'var(--text-muted)', marginTop: '0.25rem'}}>
                                    Datos sincronizados con Google Sheets
                                </div>
                            </div>
                            <div style={{display: 'flex', gap: '1rem'}}>
                                <button 
                                    className="btn-update-colors" 
                                    style={{padding: '0.5rem 1.5rem'}}
                                    onClick={() => {
                                        window.location.reload();
                                    }}
                                >
                                    🔄 Actualizar Datos
                                </button>
                                <select style={{padding: '0.5rem 1rem', border: '1px solid var(--border)', borderRadius: '8px', fontSize: '0.7rem'}}>
                                    <option>2026</option>
                                    <option>2025</option>
                                    <option>2024</option>
                                    <option>2023</option>
                                </select>
                                <button 
                                    className="btn-update-colors" 
                                    style={{padding: '0.5rem 1.5rem'}}
                                    onClick={() => {
                                        window.print();
                                    }}
                                >
                                    📥 Exportar a PDF
                                </button>
                            </div>
                        </div>

                        {/* TARJETAS DE RESUMEN */}
                        <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1.5rem', marginBottom: '2rem'}}>
                            {/* YTD 2026 */}
                            <div style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', borderRadius: '12px', padding: '1.5rem', color: 'white', boxShadow: '0 4px 15px rgba(102,126,234,0.3)'}}>
                                <div style={{fontSize: '0.85rem', opacity: 0.9, marginBottom: '0.5rem'}}>YTD 2026</div>
                                <div style={{fontSize: '2rem', fontWeight: 'bold', marginBottom: '0.5rem'}}>
                                    ${(ytd_2026_usd / 1000000).toFixed(2)}M
                                </div>
                                <div style={{fontSize: '0.7rem', opacity: 0.9}}>
                                    {ytd_2026_kg.toLocaleString()} kg
                                </div>
                                <div style={{marginTop: '1rem', fontSize: '0.85rem', opacity: 0.9}}>
                                    Enero 2026 (1 mes)
                                </div>
                            </div>

                            {/* VS Enero 2025 */}
                            <div style={{background: porcentaje_vs_2025_usd >= 0 ? 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)' : 'linear-gradient(135deg, #eb3349 0%, #f45c43 100%)', borderRadius: '12px', padding: '1.5rem', color: 'white', boxShadow: `0 4px 15px ${porcentaje_vs_2025_usd >= 0 ? 'rgba(17,153,142,0.3)' : 'rgba(235,51,73,0.3)'}`}}>
                                <div style={{fontSize: '0.85rem', opacity: 0.9, marginBottom: '0.5rem'}}>vs Enero 2025</div>
                                <div style={{fontSize: '2rem', fontWeight: 'bold', marginBottom: '0.5rem'}}>
                                    {porcentaje_vs_2025_usd >= 0 ? '+' : ''}{porcentaje_vs_2025_usd}%
                                </div>
                                <div style={{fontSize: '0.7rem', opacity: 0.9}}>
                                    ${(ytd_2025_enero_usd / 1000000).toFixed(2)}M
                                </div>
                                <div style={{marginTop: '1rem', fontSize: '0.85rem', opacity: 0.9}}>
                                    {porcentaje_vs_2025_usd >= 0 ? '✅ Crecimiento' : '⚠️ Baja'} USD | {porcentaje_vs_2025_kg >= 0 ? '✅' : '⚠️'} {porcentaje_vs_2025_kg}% KG
                                </div>
                            </div>

                            {/* Meta Excelencia */}
                            <div style={{background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', borderRadius: '12px', padding: '1.5rem', color: 'white', boxShadow: '0 4px 15px rgba(16,185,129,0.3)'}}>
                                <div style={{fontSize: '0.85rem', opacity: 0.9, marginBottom: '0.5rem'}}>Meta Excelencia 2026</div>
                                <div style={{fontSize: '2rem', fontWeight: 'bold', marginBottom: '0.5rem'}}>
                                    {cumplimiento_excelencia}%
                                </div>
                                <div style={{fontSize: '0.7rem', opacity: 0.9}}>
                                    Meta: ${(metas.excelencia_usd / 1000000).toFixed(1)}M
                                </div>
                                <div style={{marginTop: '1rem', fontSize: '0.85rem', opacity: 0.9}}>
                                    📈 Prom. mejores años
                                </div>
                            </div>

                            {/* Meta Crecimiento */}
                            <div style={{background: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)', borderRadius: '12px', padding: '1.5rem', color: 'white', boxShadow: '0 4px 15px rgba(250,112,154,0.3)'}}>
                                <div style={{fontSize: '0.85rem', opacity: 0.9, marginBottom: '0.5rem'}}>Meta Crecimiento 2026</div>
                                <div style={{fontSize: '2rem', fontWeight: 'bold', marginBottom: '0.5rem'}}>
                                    {cumplimiento_crecimiento}%
                                </div>
                                <div style={{fontSize: '0.7rem', opacity: 0.9}}>
                                    Meta: ${(metas.crecimiento_usd / 1000000).toFixed(1)}M
                                </div>
                                <div style={{marginTop: '1rem', fontSize: '0.85rem', opacity: 0.9}}>
                                    📊 2025 + 10%
                                </div>
                            </div>
                        </div>

                        {/* GRÁFICAS COMPARATIVAS - PESOS Y KG */}
                        <div style={{display: 'grid', gridTemplateColumns: '1fr', gap: '1.5rem', marginBottom: '2rem'}}>
                            
                            {/* ARRIBA: Comparativo $ 2025 vs 2026 */}
                            <div style={{background: 'var(--bg-white)', border: '1px solid var(--border)', borderRadius: '12px', padding: '1.5rem'}}>
                                <h3 style={{marginBottom: '1.5rem', color: 'var(--text)', fontSize: '1.1rem'}}>💰 Comparativo PESOS: 2025 vs 2026 <span style={{background: '#ef4444', color: 'white', padding: '0.25rem 0.5rem', fontSize: '0.75rem', borderRadius: '4px', fontWeight: 'bold'}}>ÚLTIMO INTENTO 98%</span></h3>
                                <div style={{height: '380px', display: 'flex', alignItems: 'flex-end', gap: '0.5rem', padding: '1rem 0', overflowX: 'auto'}}>
                                    {['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'].map((mes, idx) => {
                                        const mesesLabel = ['ENE', 'FEB', 'MAR', 'ABR', 'MAY', 'JUN', 'JUL', 'AGO', 'SEP', 'OCT', 'NOV', 'DIC'];
                                        const dato2025 = datos2025Mensual[mes];
                                        const dato2026 = datos2026Mensual[mes];
                                        const maxEscala = 5600000; // Julio llegará a 98%
                                        
                                        return (
                                            <div key={mes} style={{minWidth: '50px', flex: '0 0 auto', display: 'flex', flexDirection: 'column', gap: '0.5rem'}}>
                                                <div style={{textAlign: 'center', fontSize: '0.7rem', color: 'var(--text-muted)', fontWeight: '600'}}>{mesesLabel[idx]}</div>
                                                <div style={{display: 'flex', gap: '0.3rem', alignItems: 'flex-end', height: '330px'}}>
                                                    {/* 2025 */}
                                                    <div style={{flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-end'}}>
                                                        {dato2025 ? (
                                                            <div style={{
                                                                width: '100%',
                                                                height: `${Math.min((dato2025.usd / maxEscala) * 100, 100)}%`,
                                                                background: 'linear-gradient(180deg, #94a3b8 0%, #64748b 100%)',
                                                                borderRadius: '6px 6px 0 0',
                                                                display: 'flex',
                                                                alignItems: 'flex-start',
                                                                justifyContent: 'center',
                                                                paddingTop: '0.3rem',
                                                                color: 'white',
                                                                fontSize: '0.7rem',
                                                                fontWeight: 'bold'
                                                            }}>
                                                                {(dato2025.usd / 1000000).toFixed(1)}M
                                                            </div>
                                                        ) : (
                                                            <div style={{width: '100%', height: '20px', background: '#f3f4f6', borderRadius: '6px 6px 0 0', opacity: 0.3}}></div>
                                                        )}
                                                        <div style={{marginTop: '0.3rem', fontSize: '0.7rem', color: 'var(--text-muted)'}}>25</div>
                                                    </div>
                                                    {/* 2026 */}
                                                    <div style={{flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-end'}}>
                                                        {dato2026 ? (
                                                            <div style={{
                                                                width: '100%',
                                                                height: `${Math.min((dato2026.usd / maxEscala) * 100, 100)}%`,
                                                                background: 'linear-gradient(180deg, #667eea 0%, #764ba2 100%)',
                                                                borderRadius: '6px 6px 0 0',
                                                                display: 'flex',
                                                                alignItems: 'flex-start',
                                                                justifyContent: 'center',
                                                                paddingTop: '0.3rem',
                                                                color: 'white',
                                                                fontSize: '0.7rem',
                                                                fontWeight: 'bold'
                                                            }}>
                                                                {(dato2026.usd / 1000000).toFixed(1)}M
                                                            </div>
                                                        ) : (
                                                            <div style={{width: '100%', height: '20px', background: '#f3f4f6', borderRadius: '6px 6px 0 0', opacity: 0.2}}></div>
                                                        )}
                                                        <div style={{marginTop: '0.3rem', fontSize: '0.7rem', color: dato2026 ? '#667eea' : 'var(--text-muted)', fontWeight: dato2026 ? '600' : 'normal'}}>26</div>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* Leyenda */}
                                <div style={{display: 'flex', justifyContent: 'center', gap: '2rem', marginTop: '1rem', paddingTop: '1rem', borderTop: '1px solid var(--border)'}}>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        <div style={{width: '14px', height: '14px', background: 'linear-gradient(180deg, #94a3b8 0%, #64748b 100%)', borderRadius: '3px'}}></div>
                                        <span style={{fontSize: '0.7rem', color: 'var(--text-muted)'}}>2025</span>
                                    </div>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        <div style={{width: '14px', height: '14px', background: 'linear-gradient(180deg, #667eea 0%, #764ba2 100%)', borderRadius: '3px'}}></div>
                                        <span style={{fontSize: '0.7rem', fontWeight: '600', color: '#667eea'}}>2026</span>
                                    </div>
                                </div>
                            </div>

                            {/* ABAJO: Comparativo KG 2025 vs 2026 */}
                            <div style={{background: 'var(--bg-white)', border: '1px solid var(--border)', borderRadius: '12px', padding: '1.5rem'}}>
                                <h3 style={{marginBottom: '1.5rem', color: 'var(--text)', fontSize: '1.1rem'}}>⚖️ Comparativo KG: 2025 vs 2026</h3>
                                <div style={{height: '380px', display: 'flex', alignItems: 'flex-end', gap: '0.5rem', padding: '1rem 0', overflowX: 'auto'}}>
                                    {['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'].map((mes, idx) => {
                                        const mesesLabel = ['ENE', 'FEB', 'MAR', 'ABR', 'MAY', 'JUN', 'JUL', 'AGO', 'SEP', 'OCT', 'NOV', 'DIC'];
                                        const dato2025 = datos2025Mensual[mes];
                                        const dato2026 = datos2026Mensual[mes];
                                        const maxEscala = 41500; // Julio llegará a 98%
                                        
                                        return (
                                            <div key={mes} style={{minWidth: '50px', flex: '0 0 auto', display: 'flex', flexDirection: 'column', gap: '0.5rem'}}>
                                                <div style={{textAlign: 'center', fontSize: '0.7rem', color: 'var(--text-muted)', fontWeight: '600'}}>{mesesLabel[idx]}</div>
                                                <div style={{display: 'flex', gap: '0.3rem', alignItems: 'flex-end', height: '330px'}}>
                                                    {/* 2025 */}
                                                    <div style={{flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-end'}}>
                                                        {dato2025 ? (
                                                            <div style={{
                                                                width: '100%',
                                                                height: `${Math.min((dato2025.kg / maxEscala) * 100, 100)}%`,
                                                                background: 'linear-gradient(180deg, #94a3b8 0%, #64748b 100%)',
                                                                borderRadius: '6px 6px 0 0',
                                                                display: 'flex',
                                                                alignItems: 'flex-start',
                                                                justifyContent: 'center',
                                                                paddingTop: '0.3rem',
                                                                color: 'white',
                                                                fontSize: '0.7rem',
                                                                fontWeight: 'bold'
                                                            }}>
                                                                {(dato2025.kg / 1000).toFixed(0)}K
                                                            </div>
                                                        ) : (
                                                            <div style={{width: '100%', height: '20px', background: '#f3f4f6', borderRadius: '6px 6px 0 0', opacity: 0.3}}></div>
                                                        )}
                                                        <div style={{marginTop: '0.3rem', fontSize: '0.7rem', color: 'var(--text-muted)'}}>25</div>
                                                    </div>
                                                    {/* 2026 */}
                                                    <div style={{flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'flex-end'}}>
                                                        {dato2026 ? (
                                                            <div style={{
                                                                width: '100%',
                                                                height: `${Math.min((dato2026.kg / maxEscala) * 100, 100)}%`,
                                                                background: 'linear-gradient(180deg, #10b981 0%, #059669 100%)',
                                                                borderRadius: '6px 6px 0 0',
                                                                display: 'flex',
                                                                alignItems: 'flex-start',
                                                                justifyContent: 'center',
                                                                paddingTop: '0.3rem',
                                                                color: 'white',
                                                                fontSize: '0.7rem',
                                                                fontWeight: 'bold'
                                                            }}>
                                                                {(dato2026.kg / 1000).toFixed(0)}K
                                                            </div>
                                                        ) : (
                                                            <div style={{width: '100%', height: '20px', background: '#f3f4f6', borderRadius: '6px 6px 0 0', opacity: 0.2}}></div>
                                                        )}
                                                        <div style={{marginTop: '0.3rem', fontSize: '0.7rem', color: dato2026 ? '#10b981' : 'var(--text-muted)', fontWeight: dato2026 ? '600' : 'normal'}}>26</div>
                                                    </div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                {/* Leyenda */}
                                <div style={{display: 'flex', justifyContent: 'center', gap: '2rem', marginTop: '1rem', paddingTop: '1rem', borderTop: '1px solid var(--border)'}}>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        <div style={{width: '14px', height: '14px', background: 'linear-gradient(180deg, #94a3b8 0%, #64748b 100%)', borderRadius: '3px'}}></div>
                                        <span style={{fontSize: '0.7rem', color: 'var(--text-muted)'}}>2025</span>
                                    </div>
                                    <div style={{display: 'flex', alignItems: 'center', gap: '0.5rem'}}>
                                        <div style={{width: '14px', height: '14px', background: 'linear-gradient(180deg, #10b981 0%, #059669 100%)', borderRadius: '3px'}}></div>
                                        <span style={{fontSize: '0.7rem', fontWeight: '600', color: '#10b981'}}>2026</span>
                                    </div>
                                </div>
                            </div>

                        </div>

                        {/* ESTADO CLIENTES + VENDEDORES - LADO A LADO */}
                        {/* ESTADO CLIENTES + VENDEDORES - LADO A LADO */}
                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1.5rem', marginBottom: '2rem'}}>
                            {/* Gráfica de Pay */}
                            <div style={{background: 'var(--bg-white)', border: '1px solid var(--border)', borderRadius: '12px', padding: '1.5rem'}}>
                                <h3 style={{marginBottom: '1.5rem', color: 'var(--text)', fontSize: '1.1rem'}}>📊 Estado de Clientes</h3>
                                <div style={{display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '2rem'}}>
                                    {/* Gráfica de Pay */}
                                    <div style={{position: 'relative', width: '260px', height: '260px'}}>
                                        <svg viewBox="0 0 100 100" style={{transform: 'rotate(-90deg)'}}>
                                            <circle cx="50" cy="50" r="40" fill="none" stroke="#10b981" strokeWidth="20" strokeDasharray="150.8 251.2" strokeDashoffset="0" />
                                            <circle cx="50" cy="50" r="40" fill="none" stroke="#f59e0b" strokeWidth="20" strokeDasharray="62.8 251.2" strokeDashoffset="-150.8" />
                                            <circle cx="50" cy="50" r="40" fill="none" stroke="#ef4444" strokeWidth="20" strokeDasharray="37.7 251.2" strokeDashoffset="-213.6" />
                                            <circle cx="50" cy="50" r="30" fill="white" />
                                        </svg>
                                        <div style={{position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', textAlign: 'center'}}>
                                            <div style={{fontSize: '2.5rem', fontWeight: 'bold', color: 'var(--aricolor-blue)'}}>595</div>
                                            <div style={{fontSize: '0.7rem', color: 'var(--text-muted)'}}>Total</div>
                                        </div>
                                    </div>
                                    {/* Leyenda */}
                                    <div style={{display: 'flex', flexDirection: 'column', gap: '1rem', alignSelf: 'stretch'}}>
                                        <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', gap: '1rem'}}>
                                            <div style={{display: 'flex', alignItems: 'center', gap: '1rem'}}>
                                                <div style={{width: '18px', height: '18px', borderRadius: '4px', background: '#10b981', flexShrink: 0}}></div>
                                                <div style={{fontSize: '1.5rem', fontWeight: 'bold', color: 'var(--text)'}}>357 <span style={{fontSize: '1.1rem', color: 'var(--text-muted)', fontWeight: 'normal'}}>Activos (60%)</span></div>
                                            </div>
                                            <div style={{fontSize: '1.2rem', fontWeight: '600', color: '#10b981'}}>$33.5M</div>
                                        </div>
                                        <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', gap: '1rem'}}>
                                            <div style={{display: 'flex', alignItems: 'center', gap: '1rem'}}>
                                                <div style={{width: '18px', height: '18px', borderRadius: '4px', background: '#f59e0b', flexShrink: 0}}></div>
                                                <div style={{fontSize: '1.5rem', fontWeight: 'bold', color: 'var(--text)'}}>149 <span style={{fontSize: '1.1rem', color: 'var(--text-muted)', fontWeight: 'normal'}}>Inactivos (25%)</span></div>
                                            </div>
                                            <div style={{fontSize: '1.2rem', fontWeight: '600', color: '#f59e0b'}}>$14.0M</div>
                                        </div>
                                        <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', gap: '1rem'}}>
                                            <div style={{display: 'flex', alignItems: 'center', gap: '1rem'}}>
                                                <div style={{width: '18px', height: '18px', borderRadius: '4px', background: '#ef4444', flexShrink: 0}}></div>
                                                <div style={{fontSize: '1.5rem', fontWeight: 'bold', color: 'var(--text)'}}>89 <span style={{fontSize: '1.1rem', color: 'var(--text-muted)', fontWeight: 'normal'}}>Cerrados (15%)</span></div>
                                            </div>
                                            <div style={{fontSize: '1.2rem', fontWeight: '600', color: '#ef4444'}}>$8.4M</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Vendedores */}
                            <div style={{background: 'var(--bg-white)', border: '1px solid var(--border)', borderRadius: '12px', padding: '1.5rem'}}>
                                <h3 style={{marginBottom: '1.5rem', color: 'var(--text)', fontSize: '1.1rem'}}>👥 Desempeño por Vendedor</h3>
                                <div style={{display: 'flex', flexDirection: 'column', gap: '1rem'}}>
                                    {porVendedor.map((vendedor, idx) => {
                                        const cumplimiento = (vendedor.usd / vendedor.meta * 100).toFixed(0);
                                        return (
                                            <div key={idx} style={{padding: '0.75rem', borderRadius: '8px', background: 'var(--bg-light)'}}>
                                                <div style={{display: 'flex', alignItems: 'center', gap: '0.75rem', marginBottom: '0.5rem'}}>
                                                    <div style={{width: '10px', height: '10px', borderRadius: '50%', background: vendedor.color}}></div>
                                                    <span style={{fontWeight: 'bold', color: 'var(--text)', fontSize: '0.95rem', flex: 1}}>{vendedor.nombre}</span>
                                                    <span style={{
                                                        padding: '0.2rem 0.6rem',
                                                        borderRadius: '10px',
                                                        fontSize: '0.7rem',
                                                        fontWeight: 'bold',
                                                        background: cumplimiento >= 100 ? '#d1fae5' : cumplimiento >= 90 ? '#fef3c7' : '#fee2e2',
                                                        color: cumplimiento >= 100 ? '#065f46' : cumplimiento >= 90 ? '#92400e' : '#991b1b'
                                                    }}>
                                                        {cumplimiento}%
                                                    </span>
                                                </div>
                                                <div style={{height: '8px', background: '#e5e7eb', borderRadius: '4px', overflow: 'hidden'}}>
                                                    <div style={{height: '100%', width: `${Math.min(cumplimiento, 100)}%`, background: vendedor.color, borderRadius: '4px', transition: 'width 0.3s'}}></div>
                                                </div>
                                                <div style={{fontSize: '0.7rem', color: 'var(--text-muted)', marginTop: '0.25rem'}}>
                                                    ${(vendedor.usd / 1000000).toFixed(2)}M de ${(vendedor.meta / 1000000).toFixed(2)}M
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>

                        {/* NOTA INFORMATIVA */}
                        <div style={{marginTop: '2rem', padding: '1rem 1.5rem', background: '#d1fae5', border: '1px solid #10b981', borderRadius: '8px', fontSize: '0.7rem', color: '#065f46'}}>
                            <strong>✅ Dashboard Conectado:</strong> Mostrando datos reales de ARICOLOR. Enero 2026: $4.41M USD (-7.7% vs Ene 2025) | 35,471 kg (+17.3% vs Ene 2025). Meta Excelencia: 66.3% | Meta Crecimiento: 7.2%
                        </div>
                    </div>
                );
            };

            const renderMaps = () => {
                const clientesFiltrados = filterVendedorMaps === 'todos' 
                    ? clientes 
                    : clientes.filter(c => getClienteVendedor(c) === filterVendedorMaps);

                const vendedores = ['Germán', 'Martín', 'Angélica', 'Luis Fernando'];

                return (
                    <div className="detail-panel">
                        <h2 className="section-title">🗺️ Mapa de Clientes</h2>
                        
                        <div className="map-controls">
                            <button 
                                className={`map-filter-btn ${filterVendedorMaps === 'todos' ? 'active' : ''}`}
                                onClick={() => setFilterVendedorMaps('todos')}
                            >
                                👥 Todos ({clientes.length})
                            </button>
                            {vendedores.map(vendedor => {
                                const clientesVendedor = clientes.filter(c => getClienteVendedor(c) === vendedor);
                                return (
                                    <button 
                                        key={vendedor}
                                        className={`map-filter-btn ${filterVendedorMaps === vendedor ? 'active' : ''}`}
                                        onClick={() => setFilterVendedorMaps(vendedor)}
                                        style={{
                                            borderColor: filterVendedorMaps === vendedor ? getVendedorColor(vendedor) : undefined,
                                            background: filterVendedorMaps === vendedor ? getVendedorColor(vendedor) : undefined
                                        }}
                                    >
                                        {vendedor} ({clientesVendedor.length})
                                    </button>
                                );
                            })}
                        </div>

                        <div className="map-legend">
                            <strong>Leyenda:</strong>
                            <div style={{display: 'flex', gap: '1.5rem', marginTop: '0.75rem', flexWrap: 'wrap'}}>
                                {vendedores.map(vendedor => (
                                    <div key={vendedor} className="legend-item">
                                        <div 
                                            className="legend-color" 
                                            style={{backgroundColor: getVendedorColor(vendedor)}}
                                        />
                                        <span>{vendedor} <span className="vendor-initials">{vendedorIniciales[vendedor]}</span></span>
                                    </div>
                                ))}
                                <div className="legend-item">
                                    <div className="legend-color" style={{backgroundColor: '#6b7280'}} />
                                    <span>Sin asignar</span>
                                </div>
                            </div>
                        </div>

                        <div className="map-container" id="clientesMap">
                            {/* Mapa se inicializa con Leaflet via useEffect */}
                        </div>

                        <div style={{marginTop: '1.5rem'}}>
                            <h3 className="section-title">📍 Clientes en Vista ({clientesFiltrados.length})</h3>
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))',
                                gap: '1rem',
                                maxHeight: '400px',
                                overflowY: 'auto'
                            }}>
                                {clientesFiltrados.map((cliente, idx) => {
                                    const vendedor = getClienteVendedor(cliente);
                                    const iniciales = vendedor ? vendedorIniciales[vendedor] : 'N/A';
                                    
                                    return (
                                        <div 
                                            key={idx}
                                            style={{
                                                background: 'white',
                                                padding: '1rem',
                                                borderRadius: '8px',
                                                borderLeft: `4px solid ${vendedor ? getVendedorColor(vendedor) : '#6b7280'}`,
                                                boxShadow: '0 2px 4px var(--shadow)'
                                            }}
                                        >
                                            <div style={{
                                                display: 'flex',
                                                justifyContent: 'space-between',
                                                alignItems: 'flex-start',
                                                marginBottom: '0.5rem'
                                            }}>
                                                <strong style={{color: 'var(--primary)'}}>{cliente.nombre}</strong>
                                                <span className="vendor-initials" style={{
                                                    background: vendedor ? getVendedorColor(vendedor) : '#6b7280'
                                                }}>
                                                    {iniciales}
                                                </span>
                                            </div>
                                            <div style={{fontSize: '13px', color: 'var(--text-muted)'}}>
                                                📍 {cliente.direccion || 'Dirección no disponible'}
                                            </div>
                                            {cliente.codigoPostal && (
                                                <div style={{fontSize: '12px', color: 'var(--text-muted)', marginTop: '0.25rem'}}>
                                                    CP: {cliente.codigoPostal}
                                                </div>
                                            )}
                                            {cliente.zona && (
                                                <div style={{fontSize: '12px', marginTop: '0.5rem'}}>
                                                    🏙️ {cliente.zona}
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        <div style={{
                            marginTop: '1.5rem',
                            padding: '1rem',
                            background: '#dbeafe',
                            borderRadius: '8px',
                            border: '1px solid #3b82f6',
                            display: 'flex',
                            justifyContent: 'space-between',
                            alignItems: 'center',
                            flexWrap: 'wrap',
                            gap: '1rem'
                        }}>
                            <div>
                                <strong>ℹ️ Geocodificación:</strong> El sistema obtiene coordenadas automáticamente desde las direcciones de clientes en el CSV.
                            </div>
                            <button 
                                className="btn-update-colors"
                                disabled={geocodificando}
                                onClick={async () => {
                                    // Mantener coordenadas existentes
                                    const nuevasCoordenadas = {...clientesCoordenadas};
                                    let procesados = 0;
                                    let omitidos = 0;
                                    
                                    // Filtrar solo clientes con dirección
                                    const clientesConDireccion = clientes.filter(c => {
                                        // Obtener dirección de cualquier variante de columna
                                        const dir = c.DIRECCION || c.direccion || c.Direccion || c.Dirección || c.address || '';
                                        const dirLimpia = dir.trim().toUpperCase();
                                        
                                        // Filtrar direcciones inválidas
                                        const invalidas = ['N/A', 'NA', 'SIN DIRECCION', 'SIN DIRECCIÓN', 'NO APLICA', ''];
                                        
                                        return dir && !invalidas.includes(dirLimpia) && dirLimpia.length > 5;
                                    });
                                    
                                    if (clientesConDireccion.length === 0) {
                                        alert('❌ No se encontraron clientes con direcciones válidas.\n\nAsegúrate de que la columna DIRECCION en el CSV tenga direcciones reales (no "N/A").');
                                        return;
                                    }
                                    
                                    const confirmacion = confirm(`📍 Se encontraron ${clientesConDireccion.length} clientes con direcciones válidas.\n\n¿Deseas geocodificarlos?\n\n(Esto puede tardar unos segundos)`);
                                    if (!confirmacion) return;
                                    
                                    setGeocodificando(true);
                                    setProgresoGeo({ actual: 0, total: clientesConDireccion.length });
                                    
                                    console.log(`🗺️ Iniciando geocodificación de ${clientesConDireccion.length} clientes con dirección...`);
                                    console.log('Clientes a procesar:', clientesConDireccion.map(c => c.nombre));
                                    
                                    for (let i = 0; i < clientesConDireccion.length; i++) {
                                        const cliente = clientesConDireccion[i];
                                        
                                        setProgresoGeo({ actual: i + 1, total: clientesConDireccion.length });
                                        
                                        // Obtener dirección (buscar en todas las variantes)
                                        const direccion = cliente.DIRECCION || cliente.direccion || cliente.Direccion || cliente.Dirección || cliente.address;
                                        const codigoPostal = cliente.CODIGO_POSTAL || cliente.codigoPostal || cliente['Código Postal'];
                                        
                                        // Omitir si ya tiene coordenadas
                                        if (nuevasCoordenadas[cliente.nombre]) {
                                            omitidos++;
                                            continue;
                                        }
                                        
                                        console.log(`📍 Geocodificando ${i + 1}/${clientesConDireccion.length}: ${cliente.nombre}`);
                                        
                                        const coords = await geocodeAddress(direccion, codigoPostal);
                                        if (coords) {
                                            nuevasCoordenadas[cliente.nombre] = coords;
                                            procesados++;
                                            
                                            // Actualizar cada 5 clientes para que el usuario vea progreso
                                            if (procesados % 5 === 0) {
                                                setClientesCoordenadas({...nuevasCoordenadas});
                                                localStorage.setItem('aricolor_coordenadas', JSON.stringify(nuevasCoordenadas));
                                            }
                                        }
                                        
                                        // Delay para no saturar la API
                                        // Delay de 1 segundo (requerimiento de Nominatim)
                                        await new Promise(resolve => setTimeout(resolve, 1000));
                                    }
                                    
                                    setClientesCoordenadas(nuevasCoordenadas);
                                    localStorage.setItem('aricolor_coordenadas', JSON.stringify(nuevasCoordenadas));
                                    setGeocodificando(false);
                                    setProgresoGeo({ actual: 0, total: 0 });
                                    alert(`✅ Geocodificación completada!\n\n📍 ${procesados} nuevos clientes geocodificados\n⏭️ ${omitidos} ya tenían coordenadas\n📊 Total: ${Object.keys(nuevasCoordenadas).length} pines en el mapa`);
                                }}
                            >
                                {geocodificando 
                                    ? `⏳ Procesando ${progresoGeo.actual}/${progresoGeo.total}...` 
                                    : '🌍 Geocodificar Clientes'}
                            </button>
                        </div>
                    </div>
                );
            };

            const renderVentas = () => {
                const vendedores = Object.values(usuarios).filter(u => u !== 'Admin' && u !== 'Germán' && u !== 'Felipe');
                const todosLosVendedores = ['Germán', ...vendedores];

                return (
                    <div className="detail-panel">
                        <h2 className="section-title">💼 Control de Ventas</h2>

                        {/* Dashboard de métricas */}
                        <div className="sales-dashboard">
                            <div className="sales-card">
                                <div className="sales-card-header">
                                    <span className="sales-card-title">👥 Clientes Totales</span>
                                </div>
                                <div className="sales-card-value">{clientes.length}</div>
                                <div className="sales-card-subtitle">En cartera</div>
                            </div>

                            <div className="sales-card">
                                <div className="sales-card-header">
                                    <span className="sales-card-title">✅ Clientes Activos</span>
                                </div>
                                <div className="sales-card-value">
                                    {clientes.filter(c => c.status === 'Activo').length}
                                </div>
                                <div className="sales-card-subtitle">{((clientes.filter(c => c.status === 'Activo').length / clientes.length) * 100).toFixed(1)}% del total</div>
                            </div>

                            <div className="sales-card">
                                <div className="sales-card-header">
                                    <span className="sales-card-title">🎯 Vendedores</span>
                                </div>
                                <div className="sales-card-value">{todosLosVendedores.length}</div>
                                <div className="sales-card-subtitle">Equipo comercial</div>
                            </div>
                        </div>

                        {/* Asignaciones por vendedor */}
                        <h3 className="section-title" style={{marginTop: '2rem'}}>📋 Asignación de Clientes</h3>
                        {todosLosVendedores.map(vendedor => {
                            const stats = getVendedorStats(vendedor);
                            const clientesVendedor = asignacionesVendedor[vendedor] || [];
                            const expandido = vendedoresExpandidos[vendedor] || false;
                            
                            return (
                                <div key={vendedor} className="vendor-assignment-compact">
                                    <div 
                                        className="vendor-header-clickable"
                                        onClick={() => setVendedoresExpandidos(prev => ({
                                            ...prev,
                                            [vendedor]: !prev[vendedor]
                                        }))}
                                        style={{cursor: 'pointer'}}
                                    >
                                        <div style={{display: 'flex', alignItems: 'center', gap: '1rem', flex: 1}}>
                                            <div 
                                                className="vendor-avatar"
                                                style={{
                                                    width: '45px',
                                                    height: '45px',
                                                    borderRadius: '50%',
                                                    background: `linear-gradient(135deg, ${vendedorColores[vendedor]}, ${vendedorColores[vendedor]}dd)`,
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    color: 'white',
                                                    fontWeight: '700',
                                                    fontSize: '1rem'
                                                }}
                                            >
                                                {vendedorIniciales[vendedor]}
                                            </div>
                                            <div style={{flex: 1}}>
                                                <div style={{fontWeight: '600', fontSize: '1.05rem', marginBottom: '0.25rem'}}>
                                                    {vendedor}
                                                </div>
                                                <div style={{fontSize: '0.85rem', color: 'var(--text-muted)'}}>
                                                    {stats.total} clientes • {stats.activos} activos
                                                </div>
                                            </div>
                                        </div>
                                        <div style={{display: 'flex', alignItems: 'center', gap: '1rem'}}>
                                            {(currentUser === 'Admin' || currentUser === 'Germán') && (
                                                <button 
                                                    className="btn-icon-small"
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        const cliente = prompt(`Asignar cliente a ${vendedor}:`);
                                                        if (cliente) asignarCliente(vendedor, cliente);
                                                    }}
                                                    title="Asignar cliente"
                                                >
                                                    ➕
                                                </button>
                                            )}
                                            <span style={{fontSize: '1.2rem', transition: 'transform 0.2s', transform: expandido ? 'rotate(180deg)' : 'rotate(0deg)'}}>
                                                ▼
                                            </span>
                                        </div>
                                    </div>
                                    
                                    {expandido && (
                                        <div className="vendor-clients-list">
                                            {clientesVendedor.length === 0 ? (
                                                <div style={{padding: '1rem', textAlign: 'center', color: 'var(--text-muted)', fontSize: '0.7rem'}}>
                                                    Sin clientes asignados
                                                </div>
                                            ) : (
                                                <>
                                                    {/* Campo de búsqueda */}
                                                    <div style={{padding: '1rem', borderBottom: '1px solid var(--border-color)'}}>
                                                        <input
                                                            type="text"
                                                            placeholder="🔍 Buscar cliente..."
                                                            value={filtroClientesVentas}
                                                            onChange={(e) => setFiltroClientesVentas(e.target.value)}
                                                            style={{
                                                                width: '100%',
                                                                padding: '0.75rem',
                                                                border: '1px solid var(--border-color)',
                                                                borderRadius: '8px',
                                                                fontSize: '0.7rem',
                                                                fontFamily: 'inherit'
                                                            }}
                                                        />
                                                    </div>
                                                    
                                                    <table style={{width: '100%', borderCollapse: 'collapse'}}>
                                                        <thead>
                                                            <tr style={{background: 'var(--bg-light)', fontSize: '0.85rem'}}>
                                                                <th style={{padding: '0.75rem', textAlign: 'left', fontWeight: '600'}}>Cliente</th>
                                                                <th style={{padding: '0.75rem', textAlign: 'center', fontWeight: '600', width: '100px'}}>Estado</th>
                                                                <th style={{padding: '0.75rem', textAlign: 'center', fontWeight: '600', width: '150px'}}>Acciones</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {clientesVendedor
                                                                .filter(nombreCliente => 
                                                                    nombreCliente.toLowerCase().includes(filtroClientesVentas.toLowerCase())
                                                                )
                                                                .map((nombreCliente, idx) => {
                                                            const clienteData = clientes.find(c => c.nombre === nombreCliente);
                                                            return (
                                                                <tr 
                                                                    key={idx}
                                                                    style={{
                                                                        borderBottom: '1px solid var(--border-color)',
                                                                        transition: 'background 0.2s'
                                                                    }}
                                                                    onMouseEnter={(e) => e.currentTarget.style.background = 'var(--bg-light)'}
                                                                    onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}
                                                                >
                                                                    <td style={{padding: '0.75rem', fontWeight: '500'}}>
                                                                        {nombreCliente}
                                                                    </td>
                                                                    <td style={{padding: '0.75rem', textAlign: 'center'}}>
                                                                        {clienteData ? (
                                                                            <span style={{
                                                                                padding: '0.25rem 0.75rem',
                                                                                borderRadius: '12px',
                                                                                fontSize: '0.8rem',
                                                                                fontWeight: '600',
                                                                                background: clienteData.status === 'Activo' ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                                                                                color: clienteData.status === 'Activo' ? 'var(--success)' : 'var(--danger)'
                                                                            }}>
                                                                                {clienteData.status || 'Inactivo'}
                                                                            </span>
                                                                        ) : (
                                                                            <span style={{color: 'var(--text-muted)', fontSize: '0.85rem'}}>-</span>
                                                                        )}
                                                                    </td>
                                                                    <td style={{padding: '0.75rem', textAlign: 'center'}}>
                                                                        <div style={{display: 'flex', gap: '0.5rem', justifyContent: 'center'}}>
                                                                            <button
                                                                                className="btn-action-small"
                                                                                onClick={() => {
                                                                                    if (clienteData) {
                                                                                        setSelectedCliente(clienteData);
                                                                                        setActiveTab('clientes');
                                                                                    } else {
                                                                                        alert('Cliente no encontrado en la base de datos');
                                                                                    }
                                                                                }}
                                                                                title="Ir a ficha del cliente"
                                                                            >
                                                                                🔗 Ir a
                                                                            </button>
                                                                            {(currentUser === 'Admin' || currentUser === 'Germán') && (
                                                                                <button
                                                                                    className="btn-action-small-danger"
                                                                                    onClick={() => desasignarCliente(vendedor, nombreCliente)}
                                                                                    title="Desasignar cliente"
                                                                                >
                                                                                    ✕
                                                                                </button>
                                                                            )}
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                            );
                                                        })}
                                                    </tbody>
                                                </table>
                                                </>
                                            )}
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                );
            };

            const renderConfiguracion = () => (
                <div className="detail-panel">
                    <h2 className="section-title">⚙️ Configuración</h2>
                    
                    <div className="config-panel">
                        <h3 className="section-title">Conexiones Activas</h3>
                        <div className="config-row">
                            <span className="config-label">📊 Google Sheets</span>
                            <span className="config-value">{csvUrl ? '✅ Conectado (actualización automática)' : '❌ No conectado'}</span>
                        </div>
                        <div className="config-row">
                            <span className="config-label">🎯 Asana API</span>
                            <span className="config-value">{asanaToken ? '✅ Conectado' : '❌ No conectado'}</span>
                        </div>
                        <div className="config-row">
                            <span className="config-label">📦 Catálogo Productos</span>
                            <span className="config-value">{productos.length} items</span>
                        </div>
                        <div className="config-row">
                            <span className="config-label">🏢 Clientes Cargados</span>
                            <span className="config-value">{clientes.length} clientes</span>
                        </div>
                    </div>

                    {/* Actualización de Colores Pantone */}
                    <div style={{marginTop: '2rem'}}>
                        <div className="config-panel">
                            <h3 className="section-title">🎨 Actualización de Colores Pantone</h3>
                            <p style={{color: 'var(--text-muted)', marginBottom: '1rem', fontSize: '0.7rem'}}>
                                Sincronizar colores desde Google Sheets REFERENCIA PANTONE 2024
                            </p>
                            
                            <div className="config-row">
                                <span className="config-label">📊 Colores en memoria</span>
                                <span className="config-value">{Object.keys(coloresRef).length} productos mapeados</span>
                            </div>

                            <div style={{marginTop: '1.5rem'}}>
                                <button 
                                    className="btn-update-colors"
                                    onClick={actualizarColoresDesdeSheet}
                                    disabled={updateColorsStatus?.type === 'loading'}
                                >
                                    {updateColorsStatus?.type === 'loading' ? '⏳ Actualizando...' : '🔄 Actualizar Colores desde Sheet'}
                                </button>
                            </div>

                            {updateColorsStatus && (
                                <div className={`update-status ${updateColorsStatus.type}`}>
                                    {updateColorsStatus.message}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* LOG de accesos - Solo visible para Admin */}
                    {currentUser === 'Admin' && (
                        <>
                            {/* Whitelist de IPs Autorizadas */}
                            <div style={{marginTop: '2rem'}}>
                                <div className="config-panel">
                                    <h3 className="section-title">🔐 IPs Autorizadas (Whitelist)</h3>
                                    <p style={{color: 'var(--text-muted)', marginBottom: '1rem', fontSize: '0.7rem'}}>
                                        Control de acceso por ubicación (Admin siempre autorizado)
                                    </p>
                                    <div style={{
                                        background: '#FFF3CD',
                                        border: '1px solid #FFC107',
                                        borderRadius: '6px',
                                        padding: '0.75rem 1rem',
                                        marginBottom: '1rem',
                                        fontSize: '0.85rem',
                                        color: '#856404'
                                    }}>
                                        <strong>ℹ️ Funcionamiento:</strong>
                                        <div style={{marginTop: '0.5rem', lineHeight: '1.6'}}>
                                            • <strong>Lista vacía:</strong> Todos los usuarios pueden acceder desde cualquier IP<br/>
                                            • <strong>Lista con IPs:</strong> Solo usuarios desde IPs autorizadas pueden acceder
                                        </div>
                                    </div>
                                    
                                    {/* Mostrar IP actual */}
                                    {currentIp && (
                                        <div style={{
                                            background: 'var(--bg-light)',
                                            border: '1px solid var(--border)',
                                            borderRadius: '8px',
                                            padding: '0.75rem 1rem',
                                            marginBottom: '1rem',
                                            display: 'flex',
                                            justifyContent: 'space-between',
                                            alignItems: 'center'
                                        }}>
                                            <div>
                                                <span style={{fontSize: '0.85rem', color: 'var(--text-muted)'}}>
                                                    📍 Tu IP actual: 
                                                </span>
                                                <span style={{
                                                    fontFamily: 'IBM Plex Mono, monospace',
                                                    fontWeight: '600',
                                                    color: 'var(--aricolor-blue)',
                                                    marginLeft: '0.5rem',
                                                    fontSize: '0.95rem'
                                                }}>
                                                    {currentIp}
                                                </span>
                                                {ipWhitelist.includes(currentIp) && (
                                                    <span style={{marginLeft: '0.5rem', color: 'var(--success)'}}>
                                                        ✅ Autorizada
                                                    </span>
                                                )}
                                            </div>
                                            {!ipWhitelist.includes(currentIp) && (
                                                <button 
                                                    className="btn btn-secondary"
                                                    style={{fontSize: '0.85rem', padding: '0.4rem 0.8rem'}}
                                                    onClick={() => {
                                                        setNewIp(currentIp);
                                                        setTimeout(() => agregarIP(), 100);
                                                    }}
                                                >
                                                    ⚡ Agregar Esta IP
                                                </button>
                                            )}
                                        </div>
                                    )}
                                    
                                    <div style={{display: 'flex', gap: '0.5rem', marginBottom: '1rem'}}>
                                        <input
                                            type="text"
                                            className="input-field"
                                            placeholder="Ej: 192.168.1.1 o 2806:2f0:..."
                                            value={newIp}
                                            onChange={(e) => setNewIp(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && agregarIP()}
                                            style={{flex: 1}}
                                        />
                                        <button className="btn" onClick={agregarIP}>
                                            ➕ Agregar IP
                                        </button>
                                    </div>

                                    {ipWhitelist.length === 0 ? (
                                        <p style={{color: 'var(--text-muted)', textAlign: 'center', padding: '2rem', background: 'var(--bg-light)', borderRadius: '8px'}}>
                                            No hay IPs autorizadas. Todos los accesos no-Admin serán bloqueados.
                                        </p>
                                    ) : (
                                        <div style={{display: 'flex', flexWrap: 'wrap', gap: '0.5rem'}}>
                                            {ipWhitelist.map((ip, idx) => (
                                                <div key={idx} style={{
                                                    background: 'var(--bg-light)',
                                                    border: '1px solid var(--border)',
                                                    borderRadius: '6px',
                                                    padding: '0.5rem 0.75rem',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '0.5rem'
                                                }}>
                                                    <span style={{fontFamily: 'IBM Plex Mono, monospace', fontSize: '0.7rem'}}>
                                                        {ip}
                                                    </span>
                                                    <button
                                                        onClick={() => eliminarIP(ip)}
                                                        style={{
                                                            background: 'transparent',
                                                            border: 'none',
                                                            color: '#FF6B35',
                                                            cursor: 'pointer',
                                                            fontSize: '1.2rem',
                                                            padding: 0
                                                        }}
                                                        title="Eliminar IP"
                                                    >
                                                        ✕
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* Gestión de Usuarios */}
                            <div style={{marginTop: '2rem'}}>
                                <div className="config-panel">
                                    <h3 className="section-title">👥 Gestión de Usuarios</h3>
                                    <p style={{color: 'var(--text-muted)', marginBottom: '1rem', fontSize: '0.7rem'}}>
                                        Agregar, eliminar y administrar usuarios de la plataforma
                                    </p>
                                    
                                    {/* Formulario para agregar usuario */}
                                    <div style={{background: 'var(--bg-light)', padding: '1rem', borderRadius: '8px', marginBottom: '1.5rem'}}>
                                        <h4 style={{fontSize: '0.95rem', fontWeight: '600', marginBottom: '0.75rem'}}>➕ Agregar Nuevo Usuario</h4>
                                        <div style={{display: 'grid', gridTemplateColumns: '1fr 1fr auto', gap: '0.5rem', alignItems: 'end'}}>
                                            <div>
                                                <label style={{fontSize: '0.85rem', color: 'var(--text-muted)', marginBottom: '0.25rem', display: 'block'}}>
                                                    Nombre
                                                </label>
                                                <input
                                                    type="text"
                                                    className="input-field"
                                                    placeholder="Ej: Juan Pérez"
                                                    value={nuevoUsuario.nombre}
                                                    onChange={(e) => setNuevoUsuario({...nuevoUsuario, nombre: e.target.value})}
                                                    style={{marginBottom: 0}}
                                                />
                                            </div>
                                            <div>
                                                <label style={{fontSize: '0.85rem', color: 'var(--text-muted)', marginBottom: '0.25rem', display: 'block'}}>
                                                    Contraseña
                                                </label>
                                                <input
                                                    type="text"
                                                    className="input-field"
                                                    placeholder="Ej: Juan2026"
                                                    value={nuevoUsuario.password}
                                                    onChange={(e) => setNuevoUsuario({...nuevoUsuario, password: e.target.value})}
                                                    style={{marginBottom: 0}}
                                                />
                                            </div>
                                            <button className="btn" onClick={agregarUsuario}>
                                                ✅ Crear Usuario
                                            </button>
                                        </div>
                                    </div>

                                    {/* Lista de usuarios */}
                                    <h4 style={{fontSize: '0.95rem', fontWeight: '600', marginBottom: '0.75rem'}}>
                                        📋 Usuarios Registrados ({Object.keys(usuarios).length})
                                    </h4>
                                    <table className="product-table">
                                        <thead>
                                            <tr>
                                                <th>Nombre</th>
                                                <th>Contraseña</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {Object.entries(usuarios).map(([password, nombre]) => (
                                                <tr key={password}>
                                                    <td style={{fontWeight: '600', color: nombre === 'Admin' ? 'var(--aricolor-blue)' : 'var(--text-dark)'}}>
                                                        {nombre} {nombre === 'Admin' && '👑'}
                                                    </td>
                                                    <td style={{fontFamily: 'IBM Plex Mono, monospace', fontSize: '0.7rem'}}>
                                                        {password}
                                                    </td>
                                                    <td>
                                                        {nombre !== 'Admin' && (
                                                            <button
                                                                onClick={() => eliminarUsuario(password, nombre)}
                                                                className="btn btn-secondary"
                                                                style={{fontSize: '0.8rem', padding: '0.4rem 0.8rem', background: 'rgba(255, 107, 53, 0.1)', color: '#FF6B35'}}
                                                            >
                                                                🗑️ Eliminar
                                                            </button>
                                                        )}
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            {/* Intentos de Acceso Bloqueados */}
                            {(() => {
                                const intentosBloqueados = JSON.parse(localStorage.getItem('aricolor_intentos_bloqueados') || '[]');
                                
                                if (intentosBloqueados.length === 0) return null;
                                
                                return (
                                    <div style={{marginTop: '2rem'}}>
                                        <div className="config-panel" style={{borderLeft: '4px solid #FF6B35'}}>
                                            <h3 className="section-title">🚫 Intentos de Acceso Bloqueados</h3>
                                            <p style={{color: 'var(--text-muted)', marginBottom: '1rem', fontSize: '0.7rem'}}>
                                                Accesos desde IPs no autorizadas (últimos 30 días)
                                            </p>
                                            
                                            <div style={{maxHeight: '300px', overflowY: 'auto'}} className="scrollbar">
                                                <table className="product-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Usuario</th>
                                                            <th>Fecha</th>
                                                            <th>IP</th>
                                                            <th>Ciudad</th>
                                                            <th>País</th>
                                                            <th>Dispositivo</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {intentosBloqueados.slice().reverse().filter(i => i.timestamp > Date.now() - 2592000000).map((intento, idx) => (
                                                            <tr key={idx} style={{background: 'rgba(255, 107, 53, 0.05)'}}>
                                                                <td style={{fontWeight: '600', color: '#FF6B35'}}>{intento.usuario}</td>
                                                                <td style={{fontSize: '0.85rem'}}>{intento.fecha}</td>
                                                                <td style={{fontSize: '0.8rem', fontFamily: 'IBM Plex Mono, monospace'}}>{intento.ip}</td>
                                                                <td style={{fontSize: '0.85rem'}}>{intento.city}</td>
                                                                <td style={{fontSize: '0.85rem'}}>{intento.country}</td>
                                                                <td style={{fontSize: '0.85rem'}}>{intento.dispositivo}</td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })()}

                            {/* Sección de Alertas */}
                            {(() => {
                                const alertas = JSON.parse(localStorage.getItem('aricolor_alertas') || '[]');
                                const alertasPendientes = alertas.filter(a => a.timestamp > Date.now() - 604800000); // Últimos 7 días
                                
                                if (alertasPendientes.length === 0) return null;
                                
                                return (
                                    <div style={{marginTop: '2rem', marginBottom: '2rem'}}>
                                        <div className="config-panel" style={{borderLeft: '4px solid #FF6B35'}}>
                                            <h3 className="section-title">🚨 Alertas de Seguridad</h3>
                                            <p style={{color: 'var(--text-muted)', marginBottom: '1rem', fontSize: '0.7rem'}}>
                                                Accesos sospechosos detectados en los últimos 7 días
                                            </p>
                                            
                                            <div style={{display: 'flex', flexDirection: 'column', gap: '0.75rem'}}>
                                                {alertasPendientes.slice().reverse().map((alerta, idx) => (
                                                    <div key={idx} style={{
                                                        background: 'rgba(255, 107, 53, 0.1)',
                                                        border: '1px solid rgba(255, 107, 53, 0.3)',
                                                        borderRadius: '8px',
                                                        padding: '1rem'
                                                    }}>
                                                        <div>
                                                            <div style={{fontWeight: '600', color: '#FF6B35', marginBottom: '0.25rem'}}>
                                                                {alerta.tipo === 'IP_NUEVA' && '🆕 IP Nueva'}
                                                                {alerta.tipo === 'PAIS_EXTRANJERO' && '🌍 País Extranjero'}
                                                                {alerta.tipo === 'MISMA_IP' && '👥 Múltiples Usuarios'}
                                                            </div>
                                                            <div style={{fontSize: '0.7rem', color: 'var(--text-dark)'}}>
                                                                {alerta.mensaje}
                                                            </div>
                                                            <div style={{fontSize: '0.8rem', color: 'var(--text-muted)', marginTop: '0.25rem'}}>
                                                                {alerta.fecha}
                                                            </div>
                                                            <div style={{fontSize: '0.7rem', color: 'var(--text-muted)', marginTop: '0.5rem', fontFamily: 'IBM Plex Mono, monospace'}}>
                                                                IP: {alerta.detalles.ip} · {alerta.detalles.city}, {alerta.detalles.country} · {alerta.detalles.dispositivo} · {alerta.detalles.navegador}
                                                            </div>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })()}

                            <div style={{marginTop: '2rem'}}>
                                <div className="config-panel">
                                <h3 className="section-title">📊 Log de Accesos</h3>
                                <p style={{color: 'var(--text-muted)', marginBottom: '1rem', fontSize: '0.7rem'}}>
                                    Historial de accesos a la plataforma
                                </p>
                                
                                {(() => {
                                    const accessLog = JSON.parse(localStorage.getItem('aricolor_access_log') || '[]');
                                    const stats = accessLog.reduce((acc, entry) => {
                                        acc[entry.usuario] = (acc[entry.usuario] || 0) + 1;
                                        return acc;
                                    }, {});
                                    
                                    return (
                                        <>
                                            <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(150px, 1fr))', gap: '1rem', marginBottom: '1.5rem'}}>
                                                {Object.entries(stats).map(([usuario, count]) => (
                                                    <div key={usuario} style={{
                                                        background: 'var(--bg-light)',
                                                        padding: '1rem',
                                                        borderRadius: '8px',
                                                        border: '1px solid var(--border)',
                                                        textAlign: 'center'
                                                    }}>
                                                        <div style={{fontSize: '2rem', fontWeight: '700', color: 'var(--aricolor-blue)', marginBottom: '0.25rem'}}>
                                                            {count}
                                                        </div>
                                                        <div style={{fontSize: '0.85rem', color: 'var(--text-muted)'}}>
                                                            {usuario}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                            
                                            <div style={{maxHeight: '300px', overflowY: 'auto'}} className="scrollbar">
                                                <table className="product-table">
                                                    <thead>
                                                        <tr>
                                                            <th>Usuario</th>
                                                            <th>Fecha y Hora</th>
                                                            <th>IP</th>
                                                            <th>Ciudad</th>
                                                            <th>País</th>
                                                            <th>Dispositivo</th>
                                                            <th>Navegador</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {accessLog.slice().reverse().slice(0, 50).map((entry, idx) => (
                                                            <tr key={idx} style={{
                                                                background: entry.countryCode && entry.countryCode !== 'MX' ? 'rgba(255, 107, 53, 0.1)' : 'transparent'
                                                            }}>
                                                                <td style={{fontWeight: '600', color: 'var(--aricolor-blue)'}}>{entry.usuario}</td>
                                                                <td style={{fontSize: '0.85rem'}}>{entry.fecha}</td>
                                                                <td style={{fontSize: '0.8rem', fontFamily: 'IBM Plex Mono, monospace'}}>{entry.ip || 'N/A'}</td>
                                                                <td style={{fontSize: '0.85rem'}}>{entry.city || 'N/A'}</td>
                                                                <td style={{fontSize: '0.85rem'}}>
                                                                    {entry.country || 'N/A'}
                                                                    {entry.countryCode && entry.countryCode !== 'MX' && ' 🚨'}
                                                                </td>
                                                                <td style={{fontSize: '0.85rem'}}>{entry.dispositivo || 'N/A'}</td>
                                                                <td style={{fontSize: '0.85rem'}}>{entry.navegador || 'N/A'}</td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </>
                                    );
                                })()}
                            </div>
                        </div>
                        </>
                    )}

                    <div style={{marginTop: '2rem'}}>
                        <h3 className="section-title">🔄 Recargar Datos</h3>
                        <p style={{color: 'var(--text-muted)', marginBottom: '1rem', fontSize: '0.7rem'}}>
                            Los datos se cargan automáticamente al abrir la plataforma.<br/>
                            Si actualizaste tu Google Sheet, recarga manualmente:
                        </p>
                        
                        <button className="btn btn-secondary" onClick={reloadCSVData} disabled={!csvUrl}>
                            🔄 Recargar desde Google Sheets
                        </button>
                    </div>

                    <div style={{marginTop: '2rem'}}>
                        <button className="btn" style={{background: 'rgba(255, 107, 53, 0.2)', color: 'var(--accent-warm)'}} onClick={resetConfiguration}>
                            🔌 Desconectar y Borrar Configuración
                        </button>
                    </div>

                    <div style={{marginTop: '2rem', padding: '1.5rem', background: 'rgba(0, 217, 255, 0.05)', borderRadius: '10px', border: '1px solid var(--border)'}}>
                        <h3 className="section-title">ℹ️ Información</h3>
                        <p style={{color: 'var(--text-muted)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                            <strong>Actualización automática:</strong> Cada vez que abres la plataforma, se cargan los datos más recientes de tu Google Sheet.<br/><br/>
                            <strong>Privacidad:</strong> Tu configuración está guardada únicamente en el localStorage de tu navegador. Nadie más tiene acceso.<br/><br/>
                            <strong>Sincronización:</strong> Los cambios que hagas en Google Sheets se reflejarán automáticamente al abrir la plataforma o al hacer click en "Recargar".
                        </p>
                    </div>
                </div>
            );

            return (
                <div className="app-container">
                    <div className="header">
                        <div className="header-content">
                            <div className="logo-container">
                                <img src="logoari2013.jpg" alt="ARICOLOR Logo" />
                            </div>
                            <div style={{flex: 1}}>
                                <h1>INTEL·ARICOLOR·MX</h1>
                                <p className="header-subtitle">Centro de Inteligencia Comercial · Polímeros & Pigmentos México</p>
                            </div>
                            <div style={{display: 'flex', alignItems: 'center', gap: '1.5rem'}}>
                                {/* Reloj en tiempo real */}
                                <div style={{textAlign: 'center'}}>
                                    <div style={{
                                        fontSize: '1.1rem', 
                                        fontWeight: '700', 
                                        color: 'var(--aricolor-blue)',
                                        fontFamily: 'IBM Plex Mono, monospace',
                                        letterSpacing: '0.5px'
                                    }}>
                                        {currentTime.toLocaleTimeString('es-MX', { 
                                            hour: '2-digit', 
                                            minute: '2-digit', 
                                            second: '2-digit',
                                            hour12: false 
                                        })}
                                    </div>
                                    <div style={{fontSize: '0.7rem', color: 'var(--text-muted)', marginTop: '2px'}}>
                                        {currentTime.toLocaleDateString('es-MX', { 
                                            weekday: 'short',
                                            day: '2-digit', 
                                            month: 'short', 
                                            year: 'numeric' 
                                        })}
                                    </div>
                                </div>
                                
                                <div style={{textAlign: 'right'}}>
                                    <div style={{fontSize: '0.7rem', fontWeight: '600', color: 'var(--aricolor-blue)'}}>
                                        {currentUser}
                                    </div>
                                    <div style={{fontSize: '0.7rem', color: 'var(--text-muted)'}}>
                                        Sesión activa
                                    </div>
                                </div>
                                <button 
                                    onClick={() => setShowLauncher(true)}
                                    style={{
                                        padding: '0.5rem 1rem',
                                        background: 'var(--aricolor-blue)',
                                        border: 'none',
                                        borderRadius: '6px',
                                        color: 'white',
                                        cursor: 'pointer',
                                        fontSize: '0.85rem',
                                        fontFamily: 'Outfit, sans-serif',
                                        fontWeight: '600',
                                        transition: 'all 0.2s'
                                    }}
                                    onMouseEnter={(e) => {
                                        e.target.style.background = 'var(--secondary)';
                                        e.target.style.transform = 'translateY(-1px)';
                                    }}
                                    onMouseLeave={(e) => {
                                        e.target.style.background = 'var(--aricolor-blue)';
                                        e.target.style.transform = 'translateY(0)';
                                    }}
                                >
                                    🏠 Inicio
                                </button>
                                <button 
                                    onClick={handleLogout}
                                    style={{
                                        padding: '0.5rem 1rem',
                                        background: 'transparent',
                                        border: '1px solid var(--border)',
                                        borderRadius: '6px',
                                        color: 'var(--text-dark)',
                                        cursor: 'pointer',
                                        fontSize: '0.85rem',
                                        fontFamily: 'Outfit, sans-serif',
                                        transition: 'all 0.2s'
                                    }}
                                    onMouseEnter={(e) => {
                                        e.target.style.background = 'var(--bg-light)';
                                        e.target.style.borderColor = 'var(--aricolor-blue)';
                                    }}
                                    onMouseLeave={(e) => {
                                        e.target.style.background = 'transparent';
                                        e.target.style.borderColor = 'var(--border)';
                                    }}
                                >
                                    🚪 Cerrar Sesión
                                </button>
                            </div>
                        </div>
                        <div className="rainbow-bar"></div>
                    </div>

                    <div className="nav-tabs">
                        <button className={`nav-tab ${activeTab === 'clientes' ? 'active' : ''}`} onClick={() => { setActiveTab('clientes'); setSearchTerm(''); }}>
                            🏢 CLIENTES
                        </button>
                        <button className={`nav-tab ${activeTab === 'productos' ? 'active' : ''}`} onClick={() => { setActiveTab('productos'); setSearchTerm(''); }}>
                            📦 PRODUCTOS
                        </button>
                        <button className={`nav-tab ${activeTab === 'ventas' ? 'active' : ''}`} onClick={() => setActiveTab('ventas')}>
                            💼 VENTAS
                        </button>
                        <button className={`nav-tab ${activeTab === 'kpis' ? 'active' : ''}`} onClick={() => setActiveTab('kpis')}>
                            📊 KPIs
                        </button>
                        <button className={`nav-tab ${activeTab === 'maps' ? 'active' : ''}`} onClick={() => setActiveTab('maps')}>
                            🗺️ MAPS
                        </button>
                        <button className={`nav-tab ${activeTab === 'documentos' ? 'active' : ''}`} onClick={() => setActiveTab('documentos')}>
                            📁 DOCUMENTOS
                        </button>
                        <button className={`nav-tab ${activeTab === 'mercado' ? 'active' : ''}`} onClick={() => setActiveTab('mercado')}>
                            📊 MERCADO
                        </button>
                        <button className={`nav-tab ${activeTab === 'busqueda' ? 'active' : ''}`} onClick={() => setActiveTab('busqueda')}>
                            🔍 BÚSQUEDA IA
                        </button>
                        <button className={`nav-tab nav-tab-with-badge ${activeTab === 'notificaciones' ? 'active' : ''}`} onClick={() => setActiveTab('notificaciones')}>
                            🔔 NOTIFICACIONES
                            {getNotificacionesNoLeidas().length > 0 && (
                                <span className="notification-badge">{getNotificacionesNoLeidas().length}</span>
                            )}
                        </button>
                        <button className={`nav-tab ${activeTab === 'notas' ? 'active' : ''}`} onClick={() => setActiveTab('notas')}>
                            📝 NOTAS
                        </button>
                        {(currentUser === 'Admin' || currentUser === 'Germán') && (
                            <button className={`nav-tab ${activeTab === 'config' ? 'active' : ''}`} onClick={() => setActiveTab('config')}>
                                ⚙️ CONFIG
                            </button>
                        )}
                    </div>

                    <div className="content-panel">
                        {activeTab === 'clientes' && renderClientes()}
                        {activeTab === 'productos' && renderProductos()}
                        {activeTab === 'ventas' && renderVentas()}
                        {activeTab === 'kpis' && renderKPIs()}
                        {activeTab === 'maps' && renderMaps()}
                        {activeTab === 'documentos' && renderDocumentos()}
                        {activeTab === 'mercado' && renderMercado()}
                        {activeTab === 'busqueda' && renderBusquedaIA()}
                        {activeTab === 'notificaciones' && renderNotificaciones()}
                        {activeTab === 'notas' && renderNotas()}
                        {activeTab === 'config' && renderConfiguracion()}
                    </div>

                    <div style={{marginTop: 'auto', borderTop: '1px solid var(--border)', background: 'var(--bg-white)'}}>
                        <div className="rainbow-bar"></div>
                        <div style={{padding: '1.5rem 2rem', textAlign: 'center', color: 'var(--text-muted)', fontSize: '0.85rem'}}>
                            © 2026 ARICOLOR - Centro de Inteligencia Comercial · Polímeros & Pigmentos México
                        </div>
                    </div>

                    {/* Modal de color */}
                    {colorModal && (
                        <div className="color-modal-overlay" onClick={() => setColorModal(null)}>
                            <div className="color-modal" onClick={(e) => e.stopPropagation()}>
                                <button className="color-modal-close" onClick={() => setColorModal(null)}>
                                    ✕
                                </button>
                                
                                <h3 className="section-title" style={{marginBottom: '1rem'}}>
                                    Información del Color
                                </h3>
                                
                                <div 
                                    className="color-modal-swatch"
                                    style={{
                                        backgroundColor: (() => {
                                            const hex = colorModal.colorData?.hex;
                                            console.log('🎨 DEBUG Modal Color:', {
                                                hex: hex,
                                                pantone: colorModal.colorData?.pantone,
                                                colorData: colorModal.colorData
                                            });
                                            if (!hex) return '#cccccc'; // Gris por defecto
                                            return hex.startsWith('#') ? hex : `#${hex}`;
                                        })()
                                    }}
                                ></div>
                                
                                <div className="color-modal-info">
                                    <div className="color-modal-row">
                                        <span className="color-modal-label">Producto</span>
                                        <span className="color-modal-value" style={{fontFamily: 'Outfit', fontSize: '0.95rem'}}>
                                            {colorModal.productName}
                                        </span>
                                    </div>
                                    
                                    <div className="color-modal-row">
                                        <span className="color-modal-label">Código Pantone</span>
                                        <span className="color-modal-value">
                                            {colorModal.colorData.pantone}
                                        </span>
                                    </div>
                                    
                                    <div className="color-modal-row">
                                        <span className="color-modal-label">Código HEX</span>
                                        <span className="color-modal-value">
                                            {colorModal.colorData.hex?.startsWith('#') ? colorModal.colorData.hex : `#${colorModal.colorData.hex}`}
                                        </span>
                                    </div>

                                    {colorModal.colorData.claves_relacionadas && colorModal.colorData.claves_relacionadas.length > 0 && (
                                        <div className="color-modal-row" style={{flexDirection: 'column', alignItems: 'flex-start', gap: '0.5rem'}}>
                                            <span className="color-modal-label">Claves relacionadas</span>
                                            <div style={{display: 'flex', flexWrap: 'wrap', gap: '0.5rem'}}>
                                                {colorModal.colorData.claves_relacionadas.map((clave, idx) => (
                                                    <span key={idx} style={{
                                                        padding: '0.25rem 0.5rem',
                                                        background: 'var(--bg-white)',
                                                        border: '1px solid var(--border)',
                                                        borderRadius: '4px',
                                                        fontSize: '0.7rem',
                                                        fontFamily: 'IBM Plex Mono, monospace'
                                                    }}>
                                                        {clave}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal de Clientes por Color */}
                    {/* Modal de Vendedor */}
                    {vendedorModal && vendedorContacto[vendedorModal] && (
                        <div className="color-modal-overlay" onClick={() => setVendedorModal(null)}>
                            <div className="color-modal" onClick={(e) => e.stopPropagation()} style={{maxWidth: '500px'}}>
                                <button className="color-modal-close" onClick={() => setVendedorModal(null)}>
                                    ✕
                                </button>
                                
                                <div style={{textAlign: 'center', marginBottom: '1.5rem'}}>
                                    <div style={{
                                        width: '80px',
                                        height: '80px',
                                        borderRadius: '50%',
                                        background: getVendedorColor(vendedorModal),
                                        color: 'white',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center',
                                        fontSize: '32px',
                                        fontWeight: '700',
                                        margin: '0 auto 1rem',
                                        boxShadow: '0 4px 12px rgba(0,0,0,0.15)'
                                    }}>
                                        {vendedorContacto[vendedorModal].iniciales}
                                    </div>
                                    <h3 className="section-title" style={{marginBottom: '0.25rem'}}>
                                        {vendedorContacto[vendedorModal].nombre}
                                    </h3>
                                    <div style={{color: 'var(--text-muted)', fontSize: '14px'}}>
                                        Ejecutivo de Ventas
                                    </div>
                                </div>

                                <div style={{
                                    background: 'var(--bg-light)',
                                    padding: '1.5rem',
                                    borderRadius: '8px',
                                    marginBottom: '1rem'
                                }}>
                                    <div className="sales-dashboard" style={{gap: '1rem', marginBottom: 0}}>
                                        <div className="sales-card" style={{padding: '1rem'}}>
                                            <div className="sales-card-title" style={{fontSize: '12px'}}>Total Clientes</div>
                                            <div className="sales-card-value" style={{fontSize: '24px'}}>
                                                {getVendedorStats(vendedorModal).total}
                                            </div>
                                        </div>
                                        <div className="sales-card" style={{padding: '1rem', borderLeftColor: '#10b981'}}>
                                            <div className="sales-card-title" style={{fontSize: '12px'}}>Activos</div>
                                            <div className="sales-card-value" style={{fontSize: '24px', color: '#10b981'}}>
                                                {getVendedorStats(vendedorModal).activos}
                                            </div>
                                        </div>
                                        <div className="sales-card" style={{padding: '1rem', borderLeftColor: '#ef4444'}}>
                                            <div className="sales-card-title" style={{fontSize: '12px'}}>Inactivos</div>
                                            <div className="sales-card-value" style={{fontSize: '24px', color: '#ef4444'}}>
                                                {getVendedorStats(vendedorModal).inactivos}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div style={{marginBottom: '1rem'}}>
                                    <div style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '10px',
                                        padding: '12px',
                                        background: 'white',
                                        borderRadius: '8px',
                                        marginBottom: '0.75rem',
                                        border: '1px solid var(--border)'
                                    }}>
                                        <span style={{fontSize: '20px'}}>📧</span>
                                        <a 
                                            href={`mailto:${vendedorContacto[vendedorModal].email}`}
                                            style={{
                                                color: 'var(--primary)',
                                                textDecoration: 'none',
                                                fontFamily: 'IBM Plex Mono, monospace',
                                                fontSize: '14px'
                                            }}
                                        >
                                            {vendedorContacto[vendedorModal].email}
                                        </a>
                                    </div>

                                    <div style={{
                                        display: 'flex',
                                        alignItems: 'center',
                                        gap: '10px',
                                        padding: '12px',
                                        background: 'white',
                                        borderRadius: '8px',
                                        border: '1px solid var(--border)'
                                    }}>
                                        <span style={{fontSize: '20px'}}>📱</span>
                                        <a 
                                            href={`tel:${vendedorContacto[vendedorModal].celular}`}
                                            style={{
                                                color: 'var(--primary)',
                                                textDecoration: 'none',
                                                fontFamily: 'IBM Plex Mono, monospace',
                                                fontSize: '14px'
                                            }}
                                        >
                                            {vendedorContacto[vendedorModal].celular}
                                        </a>
                                        <a 
                                            href={`https://wa.me/52${vendedorContacto[vendedorModal].celular}`}
                                            target="_blank"
                                            style={{
                                                marginLeft: 'auto',
                                                padding: '6px 12px',
                                                background: '#25D366',
                                                color: 'white',
                                                borderRadius: '6px',
                                                textDecoration: 'none',
                                                fontSize: '13px',
                                                fontWeight: '600'
                                            }}
                                        >
                                            WhatsApp
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {clientesModalColor && (
                        <div className="color-modal-overlay" onClick={() => setClientesModalColor(null)}>
                            <div className="color-modal" onClick={(e) => e.stopPropagation()} style={{maxWidth: '700px'}}>
                                <button className="color-modal-close" onClick={() => setClientesModalColor(null)}>
                                    ✕
                                </button>
                                
                                <h3 className="section-title" style={{marginBottom: '0.5rem'}}>
                                    👥 Clientes que compran este color
                                </h3>
                                
                                <div style={{
                                    background: 'var(--bg-light)',
                                    padding: '0.75rem 1rem',
                                    borderRadius: '8px',
                                    marginBottom: '1.5rem',
                                    border: '1px solid var(--border)'
                                }}>
                                    <div style={{fontFamily: 'IBM Plex Mono, monospace', color: 'var(--aricolor-blue)', fontWeight: '600', fontSize: '1rem'}}>
                                        {clientesModalColor.clave}
                                    </div>
                                    <div style={{color: 'var(--text-muted)', fontSize: '0.7rem', marginTop: '0.25rem'}}>
                                        {clientesModalColor.color}
                                    </div>
                                </div>
                                
                                {clientesModalColor.clientes.length === 0 ? (
                                    <div style={{
                                        textAlign: 'center',
                                        padding: '3rem 2rem',
                                        color: 'var(--text-muted)'
                                    }}>
                                        <div style={{fontSize: '3rem', marginBottom: '1rem'}}>📭</div>
                                        <p style={{fontSize: '1.1rem', fontWeight: '500'}}>No hay clientes registrados</p>
                                        <p style={{fontSize: '0.7rem', marginTop: '0.5rem'}}>
                                            Ningún cliente tiene este color en su cartera actual
                                        </p>
                                    </div>
                                ) : (
                                    <>
                                        <div style={{
                                            marginBottom: '1rem',
                                            padding: '0.75rem',
                                            background: 'linear-gradient(135deg, var(--aricolor-blue), var(--aricolor-light-blue))',
                                            color: 'white',
                                            borderRadius: '8px',
                                            fontWeight: '600',
                                            textAlign: 'center'
                                        }}>
                                            {clientesModalColor.clientes.length} {clientesModalColor.clientes.length === 1 ? 'cliente' : 'clientes'}
                                        </div>
                                        
                                        <div style={{maxHeight: '400px', overflowY: 'auto'}} className="scrollbar">
                                            {clientesModalColor.clientes.map((cliente, idx) => (
                                                <div key={idx} style={{
                                                    background: 'var(--bg-white)',
                                                    border: '1px solid var(--border)',
                                                    borderRadius: '8px',
                                                    padding: '1rem',
                                                    marginBottom: '0.75rem',
                                                    transition: 'all 0.2s',
                                                    cursor: 'pointer'
                                                }}
                                                onMouseEnter={(e) => {
                                                    e.currentTarget.style.borderColor = 'var(--aricolor-blue)';
                                                    e.currentTarget.style.boxShadow = '0 2px 8px var(--shadow)';
                                                }}
                                                onMouseLeave={(e) => {
                                                    e.currentTarget.style.borderColor = 'var(--border)';
                                                    e.currentTarget.style.boxShadow = 'none';
                                                }}
                                                >
                                                    <div style={{
                                                        fontWeight: '600',
                                                        color: 'var(--text-dark)',
                                                        fontSize: '1rem',
                                                        marginBottom: '0.5rem'
                                                    }}>
                                                        🏢 {cliente.nombre}
                                                    </div>
                                                    <div style={{
                                                        display: 'grid',
                                                        gridTemplateColumns: 'repeat(2, 1fr)',
                                                        gap: '0.5rem',
                                                        fontSize: '0.85rem',
                                                        color: 'var(--text-muted)'
                                                    }}>
                                                        <div>
                                                            <span style={{fontWeight: '500'}}>📍 CP:</span> {cliente.cp || 'N/A'}
                                                        </div>
                                                        <div>
                                                            <span style={{fontWeight: '500'}}>🌎 Zona:</span> {cliente.zona || 'N/A'}
                                                        </div>
                                                        <div>
                                                            <span style={{fontWeight: '500'}}>🏭 Sector:</span> {cliente.sector || 'N/A'}
                                                        </div>
                                                        <div>
                                                            <span style={{fontWeight: '500'}}>📦 Volumen:</span> {cliente.volumen}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Botón flotante de notas */}
                    {isAuthenticated && (
                        <button 
                            className="notas-float-button"
                            onClick={() => {
                                // Abrir ventana nueva
                                const ventana = window.open('', 'NotasARICOLOR', 'width=600,height=800,menubar=no,toolbar=no,location=no,status=no');
                                
                                if (!ventana) {
                                    alert('Por favor permite ventanas emergentes para usar las notas');
                                    return;
                                }
                                
                                // Preparar lista de clientes (escapar comillas)
                                const clientesOptions = clientes.map(c => {
                                    const nombreEscapado = c.nombre.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
                                    return '<option value="' + nombreEscapado + '">' + nombreEscapado + '</option>';
                                }).join('');
                                
                                // Escribir HTML
                                ventana.document.write('<!DOCTYPE html><html lang="es"><head><meta charset="UTF-8"><title>Notas - ARICOLOR</title>');
                                ventana.document.write('<style>* { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: Calibri, sans-serif; padding: 1.5rem; background: #F8F9FA; } .header { background: linear-gradient(135deg, #0033CC, #6BB6FF); color: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 1.5rem; text-align: center; } .form-container { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 1.5rem; } select, input, textarea { width: 100%; padding: 0.75rem; border: 2px solid #E0E0E0; border-radius: 6px; margin-bottom: 0.75rem; font-family: Calibri, sans-serif; font-size: 1rem; } textarea { resize: vertical; min-height: 80px; } button { width: 100%; padding: 0.75rem; background: #0033CC; color: white; border: none; border-radius: 6px; font-size: 1rem; font-weight: 600; cursor: pointer; } button:hover { background: #0028a3; } .nota { background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 1rem; } .nota-header { display: flex; justify-content: space-between; margin-bottom: 0.5rem; } .nota-cliente { font-weight: 600; color: #0033CC; font-size: 1.1rem; cursor: pointer; text-decoration: underline; } .nota-usuario { font-size: 0.85rem; color: #6C757D; } .nota-texto { color: #2C3E50; line-height: 1.5; margin-bottom: 0.5rem; } .nota-fecha { font-size: 0.8rem; color: #6C757D; }</style>');
                                ventana.document.write('</head><body>');
                                ventana.document.write('<div class="header"><h1>📝 Notas Rápidas</h1><p style="margin-top: 0.5rem;">INTEL·ARICOLOR·MX</p></div>');
                                ventana.document.write('<div class="form-container"><select id="cliente"><option value="">Seleccionar cliente...</option>' + clientesOptions + '</select><textarea id="texto" placeholder="Escribe tu nota aquí..." onkeydown="if(event.ctrlKey && event.key===\'Enter\'){agregarNota();}"></textarea><button onclick="agregarNota()">➕ Agregar Nota</button><p style="font-size:0.85rem;color:#6C757D;margin-top:0.5rem;">💡 Tip: Ctrl + Enter para guardar rápido</p></div>');
                                ventana.document.write('<div id="listaNotas"></div>');
                                
                                // Script
                                const scriptContent = `
                                    const currentUser = '${currentUser}';
                                    
                                    function highlightMentions(texto) {
                                        return texto
                                            .replace(/@(\\w+)/g, '<span class="mention-link" data-type="user" data-name="$1" style="background:#fef3c7;padding:2px 6px;border-radius:4px;font-weight:700;color:#0033CC;border:1px solid #fbbf24;cursor:pointer;">@$1</span>')
                                            .replace(/#([\\w\\s]+?)(?=\\s|$|[,.!?])/g, '<span class="mention-link" data-type="client" data-name="$1" style="background:#fef3c7;padding:2px 6px;border-radius:4px;font-weight:700;color:#0033CC;border:1px solid #fbbf24;cursor:pointer;">#$1</span>');
                                    }
                                    
                                    function handleMentionClick(e) {
                                        if (e.target.classList.contains('mention-link')) {
                                            const type = e.target.dataset.type;
                                            const name = e.target.dataset.name;
                                            
                                            if (window.opener && !window.opener.closed) {
                                                window.opener.postMessage({
                                                    type: type === 'user' ? 'ABRIR_VENDEDOR' : 'ABRIR_CLIENTE',
                                                    nombre: name
                                                }, '*');
                                                alert('Abriendo ' + (type === 'user' ? 'vendedor' : 'cliente') + ' en ventana principal');
                                            } else {
                                                alert('La ventana principal está cerrada');
                                            }
                                        }
                                    }
                                    
                                    function cargarNotas() {
                                        const notas = JSON.parse(localStorage.getItem('aricolor_notas') || '[]');
                                        const lista = document.getElementById('listaNotas');
                                        
                                        if (notas.length === 0) {
                                            lista.innerHTML = '<p style="text-align:center;color:#6C757D;padding:2rem;">No hay notas aún</p>';
                                            return;
                                        }
                                        
                                        lista.innerHTML = notas.slice().reverse().map(function(nota, idx) {
                                            const clienteEscapado = nota.cliente.replace(/'/g, "\\\\'");
                                            const realIndex = notas.length - 1 - idx;
                                            
                                            let deleteButton = '';
                                            if (currentUser === 'Admin') {
                                                deleteButton = '<button onclick="eliminarNota(' + realIndex + ')" style="background:transparent;border:none;color:#dc3545;cursor:pointer;font-size:1.2rem;padding:0.25rem;margin-left:0.5rem;" title="Eliminar nota (Solo Admin)">🗑️</button>';
                                            }
                                            
                                            return '<div class="nota">' +
                                                '<div class="nota-header">' +
                                                '<div class="nota-cliente" onclick="irAFichaCliente(\\'' + clienteEscapado + '\\')" style="cursor:pointer;text-decoration:underline;" title="Click para ver ficha del cliente">🏢 ' + nota.cliente + '</div>' +
                                                '<div style="display:flex;align-items:center;gap:0.5rem;">' +
                                                '<div class="nota-usuario">' + (nota.usuario || 'Usuario') + '</div>' +
                                                deleteButton +
                                                '</div>' +
                                                '</div>' +
                                                '<div class="nota-texto" onclick="handleMentionClick(event)">' + highlightMentions(nota.texto) + '</div>' +
                                                '<div class="nota-fecha">' + nota.fecha + '</div>' +
                                                '</div>';
                                        }).join('');
                                    }
                                    
                                    function eliminarNota(index) {
                                        if (currentUser !== 'Admin') {
                                            alert('Solo Admin puede eliminar notas');
                                            return;
                                        }
                                        
                                        if (confirm('¿Eliminar esta nota? Esta acción no se puede deshacer.')) {
                                            const notas = JSON.parse(localStorage.getItem('aricolor_notas') || '[]');
                                            notas.splice(index, 1);
                                            localStorage.setItem('aricolor_notas', JSON.stringify(notas));
                                            cargarNotas();
                                        }
                                    }
                                    
                                    function irAFichaCliente(nombreCliente) {
                                        if (window.opener && !window.opener.closed) {
                                            window.opener.postMessage({
                                                type: 'ABRIR_CLIENTE',
                                                nombre: nombreCliente
                                            }, '*');
                                            alert('Abriendo ficha de ' + nombreCliente + ' en ventana principal');
                                        } else {
                                            alert('La ventana principal está cerrada');
                                        }
                                    }
                                    
                                    function agregarNota() {
                                        const clienteSelect = document.getElementById('cliente');
                                        const textoArea = document.getElementById('texto');
                                        
                                        const cliente = clienteSelect.value;
                                        const texto = textoArea.value.trim();
                                        
                                        console.log('Cliente:', cliente);
                                        console.log('Texto:', texto);
                                        
                                        if (!cliente || cliente === '' || !texto || texto === '') {
                                            alert('Por favor selecciona un cliente y escribe una nota');
                                            return;
                                        }
                                        
                                        const nota = {
                                            cliente: cliente,
                                            texto: texto,
                                            usuario: currentUser,
                                            fecha: new Date().toLocaleString('es-MX'),
                                            timestamp: Date.now()
                                        };
                                        
                                        const notas = JSON.parse(localStorage.getItem('aricolor_notas') || '[]');
                                        notas.push(nota);
                                        localStorage.setItem('aricolor_notas', JSON.stringify(notas));
                                        
                                        clienteSelect.selectedIndex = 0;
                                        textoArea.value = '';
                                        
                                        cargarNotas();
                                        alert('Nota guardada correctamente');
                                    }
                                    
                                    cargarNotas();
                                    setInterval(cargarNotas, 3000);
                                `;
                                
                                ventana.document.write('<script>' + scriptContent + '<\/script>');
                                ventana.document.write('</body></html>');
                                ventana.document.close();
                            }}
                            title="Abrir notas rápidas en ventana nueva"
                        >
                            📝
                        </button>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>