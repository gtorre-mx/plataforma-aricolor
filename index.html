<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INTEL¬∑ARICOLOR¬∑MX - Centro de Inteligencia Comercial</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0A1628;
            --secondary: #1E3A5F;
            --accent: #00D9FF;
            --accent-warm: #FF6B35;
            --surface: #0F1B2E;
            --surface-light: #1A2942;
            --text: #E8EDF5;
            --text-muted: #8B96A8;
            --border: #2A3F5F;
            --success: #00C896;
            --warning: #FFB800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, #0D1E33 50%, var(--secondary) 100%);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(0, 217, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 107, 53, 0.04) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .app-container {
            position: relative;
            z-index: 1;
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            background: rgba(15, 27, 46, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--accent) 0%, var(--accent-warm) 100%);
        }

        .header h1 {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent) 0%, #FFFFFF 50%, var(--accent-warm) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .header-subtitle {
            font-family: 'IBM Plex Mono', monospace;
            color: var(--text-muted);
            font-size: 0.95rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .nav-tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .nav-tab {
            font-family: 'IBM Plex Mono', monospace;
            background: rgba(15, 27, 46, 0.5);
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 1rem 1.75rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            letter-spacing: 0.03em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .nav-tab:hover {
            border-color: var(--accent);
            color: var(--text);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: rgba(0, 217, 255, 0.1);
            border-color: var(--accent);
            color: var(--accent);
        }

        .content-panel {
            background: rgba(15, 27, 46, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            min-height: 600px;
        }

        .search-container {
            position: relative;
            margin-bottom: 2rem;
        }

        .search-input {
            width: 100%;
            background: rgba(26, 41, 66, 0.8);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.25rem 1.5rem 1.25rem 3.5rem;
            color: var(--text);
            font-size: 1rem;
            font-family: 'Outfit', sans-serif;
            transition: all 0.3s ease;
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent);
            font-size: 1.2rem;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-warm) 100%);
            border: none;
            color: var(--primary);
            padding: 1rem 2rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'IBM Plex Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 217, 255, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: rgba(26, 41, 66, 0.8);
            border: 1px solid var(--border);
            color: var(--text);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
            background: rgba(0, 217, 255, 0.1);
        }

        .setup-panel {
            max-width: 700px;
            margin: 3rem auto;
            text-align: center;
        }

        .setup-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-warm) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .setup-description {
            color: var(--text-muted);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .input-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .input-label {
            display: block;
            color: var(--accent);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .input-field {
            width: 100%;
            background: rgba(26, 41, 66, 0.8);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
            color: var(--text);
            font-size: 0.95rem;
            font-family: 'Outfit', sans-serif;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.1);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: rgba(26, 41, 66, 0.5);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 1.75rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 0;
            background: linear-gradient(180deg, var(--accent) 0%, var(--accent-warm) 100%);
            transition: height 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            border-color: var(--accent);
            box-shadow: 0 8px 24px rgba(0, 217, 255, 0.15);
        }

        .card:hover::before {
            height: 100%;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .card-subtitle {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.75rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
        }

        .info-row {
            display: flex;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .info-label {
            font-weight: 600;
            color: var(--text);
            min-width: 90px;
        }

        .detail-panel {
            background: rgba(26, 41, 66, 0.8);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .detail-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .detail-subtitle {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .section-title {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
        }

        .status-badge {
            display: inline-block;
            padding: 0.4rem 0.9rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-family: 'IBM Plex Mono', monospace;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .status-activo {
            background: rgba(0, 200, 150, 0.15);
            border: 1px solid rgba(0, 200, 150, 0.4);
            color: var(--success);
        }

        .status-inactivo {
            background: rgba(139, 150, 168, 0.15);
            border: 1px solid rgba(139, 150, 168, 0.4);
            color: var(--text-muted);
        }

        .asana-panel {
            background: rgba(10, 22, 40, 0.4);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .asana-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .asana-stat {
            text-align: center;
            padding: 1rem;
            background: rgba(26, 41, 66, 0.5);
            border-radius: 8px;
        }

        .asana-stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            font-family: 'IBM Plex Mono', monospace;
        }

        .asana-stat-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.25rem;
        }

        .task-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .task-item {
            background: rgba(26, 41, 66, 0.3);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
        }

        .task-item:hover {
            background: rgba(26, 41, 66, 0.5);
            border-color: var(--accent);
        }

        .task-name {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .task-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .config-panel {
            background: rgba(26, 41, 66, 0.5);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .config-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .config-row:last-child {
            border-bottom: none;
        }

        .config-label {
            font-weight: 600;
            color: var(--text);
        }

        .config-value {
            color: var(--text-muted);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.9rem;
        }

        .product-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .product-table th {
            background: rgba(0, 217, 255, 0.1);
            color: var(--accent);
            padding: 0.75rem;
            text-align: left;
            font-size: 0.85rem;
            font-family: 'IBM Plex Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .product-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
            color: var(--text);
        }

        .product-table tr:hover {
            background: rgba(0, 217, 255, 0.05);
        }

        .price-cell {
            color: var(--success);
            font-weight: 600;
            font-family: 'IBM Plex Mono', monospace;
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 1rem;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }
        }

        .scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar::-webkit-scrollbar-track {
            background: rgba(26, 41, 66, 0.3);
            border-radius: 4px;
        }

        .scrollbar::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        .scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--accent-warm);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [activeTab, setActiveTab] = useState('clientes');
            const [isConfigured, setIsConfigured] = useState(false);
            const [csvUrl, setCsvUrl] = useState('');
            const [asanaToken, setAsanaToken] = useState('');
            const [clientes, setClientes] = useState([]);
            const [selectedCliente, setSelectedCliente] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [asanaData, setAsanaData] = useState(null);
            const [productos, setProductos] = useState([]);

            // Cargar cat√°logo de productos
            useEffect(() => {
                const loadProductos = async () => {
                    try {
                        console.log('üîÑ Intentando cargar productos_catalogo.json...');
                        const response = await fetch('./productos_catalogo.json');
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        const data = await response.json();
                        console.log(`üì¶ Datos recibidos: ${data.length} productos`);
                        setProductos(data);
                        console.log(`‚úÖ Cargados ${data.length} productos del cat√°logo`);
                        console.log('üìä Primeros 3 productos:', data.slice(0, 3));
                    } catch (err) {
                        console.error('‚ùå Error cargando productos_catalogo.json:', err);
                        setProductos([]);
                    }
                };
                loadProductos();
            }, []);

            // Cargar configuraci√≥n del localStorage
            useEffect(() => {
                const savedCsvUrl = localStorage.getItem('aricolor_csv_url');
                const savedAsanaToken = localStorage.getItem('aricolor_asana_token');
                
                if (savedCsvUrl && savedAsanaToken) {
                    setCsvUrl(savedCsvUrl);
                    setAsanaToken(savedAsanaToken);
                    setIsConfigured(true);
                    
                    // Cargar datos autom√°ticamente
                    loadClientesFromCSV(savedCsvUrl);
                }
            }, []);

            const saveConfiguration = async () => {
                if (!csvUrl || !asanaToken) {
                    alert('Por favor completa ambos campos');
                    return;
                }

                // Validar formato del CSV URL
                if (!csvUrl.includes('docs.google.com') || !csvUrl.includes('output=csv')) {
                    alert('‚ö†Ô∏è El link CSV no parece v√°lido.\n\nAseg√∫rate de que:\n1. Sea de Google Sheets\n2. Termine con "output=csv"\n3. Sea un link publicado');
                    return;
                }

                setIsLoading(true);
                try {
                    // Probar la conexi√≥n y cargar datos
                    await loadClientesFromCSV(csvUrl);
                    
                    // Si funcion√≥, guardar configuraci√≥n
                    localStorage.setItem('aricolor_csv_url', csvUrl);
                    localStorage.setItem('aricolor_asana_token', asanaToken);
                    setIsConfigured(true);
                    
                    alert(`‚úÖ Configuraci√≥n guardada!\n\nLos datos se cargar√°n autom√°ticamente cada vez que abras la plataforma.`);
                } catch (error) {
                    alert(`‚ùå Error al conectar:\n\n${error.message}\n\nVerifica el link CSV.`);
                    setIsLoading(false);
                }
            };

            const reloadCSVData = async () => {
                if (!csvUrl) {
                    alert('No hay URL CSV configurada');
                    return;
                }
                
                await loadClientesFromCSV(csvUrl);
            };

            const resetConfiguration = () => {
                if (confirm('¬øEst√°s seguro de que quieres desconectar y borrar toda la configuraci√≥n?')) {
                    localStorage.removeItem('aricolor_csv_url');
                    localStorage.removeItem('aricolor_asana_token');
                    setCsvUrl('');
                    setAsanaToken('');
                    setIsConfigured(false);
                    setClientes([]);
                    setSelectedCliente(null);
                }
            };

            const parseCSVLine = (line) => {
                const result = [];
                let current = '';
                let inQuotes = false;
                
                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        result.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                result.push(current.trim());
                return result;
            };

            const loadClientesFromCSV = async (url) => {
                setIsLoading(true);
                try {
                    console.log('üîÑ Cargando datos desde Google Sheets...');
                    
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const csvText = await response.text();
                    const rows = csvText.split('\n').filter(row => row.trim());
                    
                    if (rows.length < 2) {
                        throw new Error('El CSV est√° vac√≠o o solo tiene encabezados');
                    }

                    const clientesData = [];

                    for (let i = 1; i < rows.length; i++) {
                        const values = parseCSVLine(rows[i]);
                        if (values.length < 7) continue;

                        const productos = [];
                        // Leer productos desde columna 6 hasta columna 65 (BM)
                        // No leer m√°s all√° para evitar columnas auxiliares BO+
                        const maxColumna = Math.min(66, values.length); // Hasta columna 66 (BN) m√°ximo
                        for (let j = 6; j < maxColumna; j += 2) {
                            const productoNombre = values[j]?.replace(/^["']|["']$/g, '').trim();
                            const productoPrecio = values[j+1]?.replace(/^["']|["']$/g, '').trim();
                            
                            // Mostrar producto si tiene nombre (con o sin precio)
                            if (productoNombre && productoNombre !== 'x' && productoNombre !== '') {
                                productos.push({
                                    nombre: productoNombre,
                                    precio: productoPrecio || 'Pendiente'
                                });
                            }
                        }

                        const nombreCliente = values[0]?.replace(/^["']|["']$/g, '').trim();
                        if (!nombreCliente) continue;

                        clientesData.push({
                            nombre: nombreCliente,
                            asana: values[1]?.replace(/^["']|["']$/g, '').trim() || '',
                            sector: values[2]?.replace(/^["']|["']$/g, '').trim() || '',
                            status: values[3]?.replace(/^["']|["']$/g, '').trim() || '',
                            responsable: values[4]?.replace(/^["']|["']$/g, '').trim() || '',
                            zona: values[5]?.replace(/^["']|["']$/g, '').trim() || '',
                            productos: productos
                        });
                    }

                    setClientes(clientesData);
                    console.log(`‚úÖ Cargados ${clientesData.length} clientes desde Google Sheets`);
                } catch (error) {
                    console.error('‚ùå Error cargando datos:', error);
                    alert(`Error cargando datos de Google Sheets:\n\n${error.message}\n\nVerifica que el link CSV sea correcto.`);
                }
                setIsLoading(false);
            };

            const loadAsanaData = async (projectUrl) => {
                if (!asanaToken || !projectUrl) return;

                // Extraer project ID del URL
                const projectMatch = projectUrl.match(/\/(\d+)\//);
                if (!projectMatch) return;

                const projectId = projectMatch[1];

                try {
                    setIsLoading(true);
                    
                    // Obtener tareas del proyecto
                    const response = await fetch(`https://app.asana.com/api/1.0/projects/${projectId}/tasks`, {
                        headers: {
                            'Authorization': `Bearer ${asanaToken}`
                        }
                    });

                    const data = await response.json();
                    
                    if (data.data) {
                        // Obtener detalles de cada tarea
                        const tasksDetails = await Promise.all(
                            data.data.slice(0, 15).map(async (task) => {
                                const taskResponse = await fetch(`https://app.asana.com/api/1.0/tasks/${task.gid}`, {
                                    headers: {
                                        'Authorization': `Bearer ${asanaToken}`
                                    }
                                });
                                const taskData = await taskResponse.json();
                                return taskData.data;
                            })
                        );

                        // Procesar estad√≠sticas
                        const sections = {};
                        tasksDetails.forEach(task => {
                            const section = task.memberships?.[0]?.section?.name || 'Sin Secci√≥n';
                            sections[section] = (sections[section] || 0) + 1;
                        });

                        setAsanaData({
                            tasks: tasksDetails,
                            sections: sections
                        });
                    }
                } catch (error) {
                    console.error('Error cargando datos de Asana:', error);
                }
                setIsLoading(false);
            };

            useEffect(() => {
                if (selectedCliente && selectedCliente.asana) {
                    loadAsanaData(selectedCliente.asana);
                }
            }, [selectedCliente]);

            const filteredClientes = clientes.filter(c =>
                (c.nombre && String(c.nombre).toLowerCase().includes(searchTerm.toLowerCase())) ||
                (c.sector && String(c.sector).toLowerCase().includes(searchTerm.toLowerCase())) ||
                (c.zona && String(c.zona).toLowerCase().includes(searchTerm.toLowerCase()))
            );

            const filteredProductos = searchTerm.trim() === '' 
                ? productos 
                : productos.filter(p => {
                    const search = searchTerm.toLowerCase();
                    const clave = String(p.Clave || '').toLowerCase();
                    const color = String(p.Color || '').toLowerCase();
                    const resina = String(p.Resina || '').toLowerCase();
                    return clave.includes(search) || color.includes(search) || resina.includes(search);
                });

            if (!isConfigured) {
                return (
                    <div className="app-container">
                        <div className="header">
                            <h1>INTEL¬∑ARICOLOR¬∑MX</h1>
                            <p className="header-subtitle">Centro de Inteligencia Comercial</p>
                        </div>

                        <div className="content-panel">
                            <div className="setup-panel">
                                <div className="setup-title">üöÄ Configuraci√≥n Inicial</div>
                                <p className="setup-description">
                                    Conecta tu Google Sheet y Asana para activar la plataforma.<br/>
                                    Solo necesitas hacer esto una vez.
                                </p>

                                <div className="input-group">
                                    <label className="input-label">üìä Link CSV de Google Sheet</label>
                                    <input
                                        type="text"
                                        className="input-field"
                                        placeholder="https://docs.google.com/spreadsheets/.../pub?gid=0&single=true&output=csv"
                                        value={csvUrl}
                                        onChange={(e) => setCsvUrl(e.target.value)}
                                    />
                                    <p style={{fontSize: '0.85rem', color: 'var(--text-muted)', marginTop: '0.5rem', lineHeight: '1.5'}}>
                                        üí° <strong>Usa tu link actual:</strong><br/>
                                        <code style={{background: 'rgba(0,217,255,0.1)', padding: '0.25rem 0.5rem', borderRadius: '4px', fontSize: '0.8rem'}}>
                                            https://docs.google.com/spreadsheets/d/e/2PACX-1vRl9fmzoNnqUSqg29otLpAKhbLkgzN72pW1zjet045NQWX9Iyux7BKrIpa1L-wA2VLlqAoGWq2mnIBQ/pub?gid=0&single=true&output=csv
                                        </code>
                                    </p>
                                </div>

                                <div className="input-group">
                                    <label className="input-label">üîê Token de Asana</label>
                                    <input
                                        type="password"
                                        className="input-field"
                                        placeholder="1/1234567890:abcdef..."
                                        value={asanaToken}
                                        onChange={(e) => setAsanaToken(e.target.value)}
                                    />
                                    <p style={{fontSize: '0.85rem', color: 'var(--text-muted)', marginTop: '0.5rem', lineHeight: '1.5'}}>
                                        üí° <strong>C√≥mo obtener el token:</strong><br/>
                                        1. En Asana, click en tu foto de perfil<br/>
                                        2. My Settings ‚Üí Apps ‚Üí Personal Access Tokens<br/>
                                        3. Click "New access token" ‚Üí Dale un nombre ‚Üí Copia el token
                                    </p>
                                </div>

                                <button 
                                    className="btn" 
                                    onClick={saveConfiguration}
                                    disabled={isLoading}
                                >
                                    {isLoading ? 'Conectando...' : 'Conectar Plataforma'}
                                </button>

                                <div style={{marginTop: '2rem', padding: '1.5rem', background: 'rgba(0, 217, 255, 0.05)', borderRadius: '10px', border: '1px solid var(--border)'}}>
                                    <p style={{fontSize: '0.9rem', color: 'var(--text-muted)', lineHeight: '1.6'}}>
                                        ‚ÑπÔ∏è <strong>Nota:</strong> Tus credenciales se guardan solo en tu navegador (localStorage). 
                                        Nadie m√°s tiene acceso a ellas. Los datos siempre se cargan en tiempo real desde tus fuentes.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            const renderClientes = () => (
                <>
                    <div className="search-container">
                        <span className="search-icon">üîç</span>
                        <input
                            type="text"
                            className="search-input"
                            placeholder="Buscar por cliente, sector, o zona..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                    </div>

                    {selectedCliente ? (
                        <div className="detail-panel">
                            <div className="detail-header">
                                <div>
                                    <h2 className="detail-title">{selectedCliente.nombre}</h2>
                                    <p className="detail-subtitle">{selectedCliente.sector}</p>
                                </div>
                                <button className="btn btn-secondary" onClick={() => { setSelectedCliente(null); setAsanaData(null); }}>
                                    Cerrar
                                </button>
                            </div>

                            <div style={{marginBottom: '2rem'}}>
                                <div className="info-row">
                                    <span className="info-label">üìç Zona:</span>
                                    <span>{selectedCliente.zona}</span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">üë§ Responsable:</span>
                                    <span>{selectedCliente.responsable}</span>
                                </div>
                                <div className="info-row">
                                    <span className="info-label">üìä Status:</span>
                                    <span className={`status-badge ${selectedCliente.status && selectedCliente.status.toLowerCase().includes('activo') ? 'status-activo' : 'status-inactivo'}`}>
                                        {selectedCliente.status}
                                    </span>
                                </div>
                                {selectedCliente.asana && (
                                    <div className="info-row">
                                        <span className="info-label">üéØ Asana:</span>
                                        <a href={selectedCliente.asana} target="_blank" style={{color: 'var(--accent)', textDecoration: 'underline'}}>
                                            Ver Proyecto
                                        </a>
                                    </div>
                                )}
                            </div>

                            <h3 className="section-title">üí∞ Productos y Precios</h3>
                            {selectedCliente.productos.length > 0 ? (
                                <table className="product-table">
                                    <thead>
                                        <tr>
                                            <th>Producto</th>
                                            <th>Precio</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {selectedCliente.productos.map((prod, idx) => (
                                            <tr key={idx}>
                                                <td>{prod.nombre}</td>
                                                <td className="price-cell">{prod.precio}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            ) : (
                                <p style={{color: 'var(--text-muted)', textAlign: 'center', padding: '2rem'}}>
                                    No hay productos registrados para este cliente
                                </p>
                            )}

                            {asanaData && (
                                <div className="asana-panel">
                                    <h3 className="section-title">üìä Dashboard Asana</h3>
                                    
                                    <div className="asana-stats">
                                        {Object.entries(asanaData.sections).map(([section, count]) => (
                                            <div key={section} className="asana-stat">
                                                <div className="asana-stat-number">{count}</div>
                                                <div className="asana-stat-label">{section}</div>
                                            </div>
                                        ))}
                                    </div>

                                    <h3 className="section-title" style={{marginTop: '1.5rem'}}>üìã Actividad Reciente (√öltimos 4 meses)</h3>
                                    <div className="task-list scrollbar">
                                        {asanaData.tasks
                                            .filter(task => {
                                                const taskDate = new Date(task.created_at);
                                                const fourMonthsAgo = new Date();
                                                fourMonthsAgo.setMonth(fourMonthsAgo.getMonth() - 4);
                                                return taskDate >= fourMonthsAgo;
                                            })
                                            .map(task => (
                                                <div key={task.gid} className="task-item">
                                                    <div className="task-name">{task.name}</div>
                                                    <div className="task-meta">
                                                        <span>üìÖ {new Date(task.created_at).toLocaleDateString('es-MX')}</span>
                                                        <span>üìå {task.memberships?.[0]?.section?.name || 'Sin Secci√≥n'}</span>
                                                        {task.completed && <span style={{color: 'var(--success)'}}>‚úÖ Completado</span>}
                                                    </div>
                                                </div>
                                            ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    ) : (
                        <>
                            {isLoading ? (
                                <div className="loading">Cargando clientes...</div>
                            ) : (
                                <div className="grid">
                                    {filteredClientes.map((cliente, idx) => (
                                        <div key={idx} className="card" onClick={() => setSelectedCliente(cliente)}>
                                            <h3 className="card-title">{cliente.nombre}</h3>
                                            <p className="card-subtitle">{cliente.sector}</p>
                                            <div className="info-row">
                                                <span className="info-label">üìç Zona:</span>
                                                <span>{cliente.zona}</span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">üë§ Responsable:</span>
                                                <span>{cliente.responsable}</span>
                                            </div>
                                            <div className="info-row">
                                                <span className="info-label">üì¶ Productos:</span>
                                                <span>{cliente.productos.length}</span>
                                            </div>
                                            <div style={{marginTop: '0.75rem'}}>
                                                <span className={`status-badge ${cliente.status && cliente.status.toLowerCase().includes('activo') ? 'status-activo' : 'status-inactivo'}`}>
                                                    {cliente.status}
                                                </span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}

                            {filteredClientes.length === 0 && !isLoading && (
                                <div className="empty-state">
                                    <div className="empty-state-icon">üîç</div>
                                    <p>No se encontraron clientes</p>
                                </div>
                            )}
                        </>
                    )}
                </>
            );

            const renderProductos = () => (
                <>
                    <div className="search-container">
                        <span className="search-icon">üîç</span>
                        <input
                            type="text"
                            className="search-input"
                            placeholder="Buscar por clave, color, resina..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                    </div>

                    <h3 className="section-title">üì¶ Cat√°logo T√©cnico ({filteredProductos.length} productos)</h3>
                    
                    <div style={{maxHeight: '600px', overflowY: 'auto'}} className="scrollbar">
                        <table className="product-table">
                            <thead>
                                <tr>
                                    <th>Clave</th>
                                    <th>Color</th>
                                    <th>Resina</th>
                                    <th>Acabado</th>
                                    <th>Certificaci√≥n</th>
                                    <th>Aplicaci√≥n</th>
                                </tr>
                            </thead>
                            <tbody>
                                {filteredProductos.slice(0, 100).map((prod, idx) => (
                                    <tr key={idx}>
                                        <td style={{fontFamily: 'IBM Plex Mono, monospace', color: 'var(--accent)'}}>{prod.Clave}</td>
                                        <td>{prod.Color}</td>
                                        <td style={{fontSize: '0.85rem'}}>{prod.Resina}</td>
                                        <td>{prod.Acabado}</td>
                                        <td style={{fontSize: '0.85rem'}}>{prod.Certificacion}</td>
                                        <td>{prod.Aplicacion}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                        {filteredProductos.length > 100 && (
                            <p style={{textAlign: 'center', color: 'var(--text-muted)', padding: '1rem'}}>
                                Mostrando 100 de {filteredProductos.length} resultados. Refina tu b√∫squeda para ver m√°s.
                            </p>
                        )}
                    </div>
                </>
            );

            const renderMercado = () => (
                <div className="detail-panel">
                    <h2 className="section-title">üìä An√°lisis de Mercado</h2>
                    <p style={{color: 'var(--text-muted)', marginBottom: '2rem'}}>
                        Perspectivas y datos del mercado mexicano de pol√≠meros y pigmentos
                    </p>

                    <div style={{display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '1.5rem'}}>
                        <div className="config-panel">
                            <h3 className="section-title">Pol√≠meros en M√©xico</h3>
                            <p style={{color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Polietileno:</strong> Braskem Idesa √∫nico productor integrado (1.05M ton/a√±o). Dow l√≠der en tecnolog√≠a y distribuci√≥n.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Polipropileno:</strong> Indelpro (Alpek) √∫nico productor nacional. Mercado complementado con importaciones.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>PVC:</strong> Orbia (Vestolit) l√≠der con m√∫ltiples plantas. Capacidad total >700K ton/a√±o en M√©xico.
                            </p>
                        </div>

                        <div className="config-panel">
                            <h3 className="section-title">Recubrimientos</h3>
                            <p style={{color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Arquitect√≥nicos:</strong> PPG Comex domina con ~50% mercado. Sherwin-Williams segundo jugador importante.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Industriales:</strong> BASF l√≠der en automotriz OEM. PPG y Sherwin-Williams fuertes en general industrial.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Capacidad:</strong> PPG Comex produce 1.3-1.5M litros/d√≠a en temporada alta.
                            </p>
                        </div>

                        <div className="config-panel">
                            <h3 className="section-title">Pigmentos</h3>
                            <p style={{color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>L√≠deres:</strong> Clariant especializada en preparaciones pigmentarias. BASF y PPG integrados en recubrimientos.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Tecnolog√≠a:</strong> M√©xico produce preparaciones acuosas y solvente de √∫ltima generaci√≥n.
                            </p>
                            <p style={{marginTop: '1rem', color: 'var(--text)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                                <strong>Aplicaciones:</strong> Automotriz, construcci√≥n, impresi√≥n, pl√°sticos, textiles.
                            </p>
                        </div>

                        <div className="config-panel">
                            <h3 className="section-title">Tendencias Clave</h3>
                            <div style={{color: 'var(--text)', lineHeight: '1.9', fontSize: '0.95rem'}}>
                                <div>‚ñ∏ Econom√≠a circular: Inversi√≥n en reciclado (PET, PE, PP)</div>
                                <div>‚ñ∏ Sustentabilidad: Productos bajos en VOC, bio-basados</div>
                                <div>‚ñ∏ Nearshoring: Expansi√≥n de capacidad productiva</div>
                                <div>‚ñ∏ Tecnolog√≠a: Metalocenos, pol√≠meros especiales</div>
                                <div>‚ñ∏ Certificaciones: ISO 9001, 14001, IATF 16949</div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            const renderBusquedaIA = () => {
                const [query, setQuery] = useState('');
                const [result, setResult] = useState('');
                const [searching, setSearching] = useState(false);

                const handleSearch = async () => {
                    if (!query.trim()) return;
                    
                    setSearching(true);
                    try {
                        const response = await fetch("https://api.anthropic.com/v1/messages", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                model: "claude-sonnet-4-20250514",
                                max_tokens: 1000,
                                messages: [{
                                    role: "user",
                                    content: `Como experto en procesos termopl√°sticos y pigmentaci√≥n en M√©xico, responde esta consulta de manera t√©cnica y concisa: ${query}`
                                }],
                                tools: [{
                                    type: "web_search_20250305",
                                    name: "web_search"
                                }]
                            })
                        });

                        const data = await response.json();
                        const resultText = data.content
                            .filter(item => item.type === "text")
                            .map(item => item.text)
                            .join("\n");

                        setResult(resultText || "B√∫squeda completada. Intenta otra consulta.");
                    } catch (error) {
                        setResult("Error en la b√∫squeda. Por favor intenta nuevamente.");
                    }
                    setSearching(false);
                };

                return (
                    <div className="detail-panel">
                        <h2 className="section-title">üîç B√∫squeda Especializada con IA</h2>
                        <p style={{color: 'var(--text-muted)', marginBottom: '2rem'}}>
                            Consulta informaci√≥n actualizada sobre procesos termopl√°sticos y pigmentaci√≥n con b√∫squeda web en tiempo real
                        </p>

                        <div className="search-container">
                            <span className="search-icon">ü§ñ</span>
                            <input
                                type="text"
                                className="search-input"
                                placeholder="Ej: ¬øCu√°les son las mejores pr√°cticas para pigmentaci√≥n de polipropileno?"
                                value={query}
                                onChange={(e) => setQuery(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                            />
                        </div>

                        <button 
                            className="btn" 
                            onClick={handleSearch}
                            disabled={searching || !query.trim()}
                        >
                            {searching ? 'Buscando...' : 'Buscar con IA'}
                        </button>

                        {result && (
                            <div style={{marginTop: '2rem', padding: '1.5rem', background: 'rgba(0, 217, 255, 0.05)', borderRadius: '10px', border: '1px solid var(--border)'}}>
                                <h3 className="section-title">üí° Resultado</h3>
                                <p style={{color: 'var(--text)', lineHeight: '1.7', whiteSpace: 'pre-wrap'}}>{result}</p>
                            </div>
                        )}

                        <div style={{marginTop: '2rem'}}>
                            <h3 className="section-title">üí° Ejemplos de B√∫squeda</h3>
                            <div style={{color: 'var(--text-muted)', lineHeight: '1.9', fontSize: '0.95rem'}}>
                                <div>‚ñ∏ ¬øC√≥mo mejorar la dispersi√≥n de pigmentos en LDPE?</div>
                                <div>‚ñ∏ Temperaturas recomendadas para extrusi√≥n de masterbatch</div>
                                <div>‚ñ∏ Diferencias entre pigmentos org√°nicos e inorg√°nicos</div>
                                <div>‚ñ∏ Procesos de inyecci√≥n para productos con contacto alimenticio</div>
                                <div>‚ñ∏ Normativas FDA para pigmentos en empaques</div>
                            </div>
                        </div>
                    </div>
                );
            };

            const renderConfiguracion = () => (
                <div className="detail-panel">
                    <h2 className="section-title">‚öôÔ∏è Configuraci√≥n</h2>
                    
                    <div className="config-panel">
                        <h3 className="section-title">Conexiones Activas</h3>
                        <div className="config-row">
                            <span className="config-label">üìä Google Sheets</span>
                            <span className="config-value">{csvUrl ? '‚úÖ Conectado (actualizaci√≥n autom√°tica)' : '‚ùå No conectado'}</span>
                        </div>
                        <div className="config-row">
                            <span className="config-label">üéØ Asana API</span>
                            <span className="config-value">{asanaToken ? '‚úÖ Conectado' : '‚ùå No conectado'}</span>
                        </div>
                        <div className="config-row">
                            <span className="config-label">üì¶ Cat√°logo Productos</span>
                            <span className="config-value">{productos.length} items</span>
                        </div>
                        <div className="config-row">
                            <span className="config-label">üè¢ Clientes Cargados</span>
                            <span className="config-value">{clientes.length} clientes</span>
                        </div>
                    </div>

                    <div style={{marginTop: '2rem'}}>
                        <h3 className="section-title">üîÑ Recargar Datos</h3>
                        <p style={{color: 'var(--text-muted)', marginBottom: '1rem', fontSize: '0.9rem'}}>
                            Los datos se cargan autom√°ticamente al abrir la plataforma.<br/>
                            Si actualizaste tu Google Sheet, recarga manualmente:
                        </p>
                        
                        <button className="btn btn-secondary" onClick={reloadCSVData} disabled={!csvUrl}>
                            üîÑ Recargar desde Google Sheets
                        </button>
                    </div>

                    <div style={{marginTop: '2rem'}}>
                        <button className="btn" style={{background: 'rgba(255, 107, 53, 0.2)', color: 'var(--accent-warm)'}} onClick={resetConfiguration}>
                            üîå Desconectar y Borrar Configuraci√≥n
                        </button>
                    </div>

                    <div style={{marginTop: '2rem', padding: '1.5rem', background: 'rgba(0, 217, 255, 0.05)', borderRadius: '10px', border: '1px solid var(--border)'}}>
                        <h3 className="section-title">‚ÑπÔ∏è Informaci√≥n</h3>
                        <p style={{color: 'var(--text-muted)', lineHeight: '1.7', fontSize: '0.95rem'}}>
                            <strong>Actualizaci√≥n autom√°tica:</strong> Cada vez que abres la plataforma, se cargan los datos m√°s recientes de tu Google Sheet.<br/><br/>
                            <strong>Privacidad:</strong> Tu configuraci√≥n est√° guardada √∫nicamente en el localStorage de tu navegador. Nadie m√°s tiene acceso.<br/><br/>
                            <strong>Sincronizaci√≥n:</strong> Los cambios que hagas en Google Sheets se reflejar√°n autom√°ticamente al abrir la plataforma o al hacer click en "Recargar".
                        </p>
                    </div>
                </div>
            );

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>INTEL¬∑ARICOLOR¬∑MX</h1>
                        <p className="header-subtitle">Centro de Inteligencia Comercial ¬∑ Pol√≠meros & Pigmentos M√©xico</p>
                    </div>

                    <div className="nav-tabs">
                        <button className={`nav-tab ${activeTab === 'clientes' ? 'active' : ''}`} onClick={() => { setActiveTab('clientes'); setSearchTerm(''); }}>
                            üè¢ CLIENTES
                        </button>
                        <button className={`nav-tab ${activeTab === 'productos' ? 'active' : ''}`} onClick={() => { setActiveTab('productos'); setSearchTerm(''); }}>
                            üì¶ PRODUCTOS
                        </button>
                        <button className={`nav-tab ${activeTab === 'mercado' ? 'active' : ''}`} onClick={() => setActiveTab('mercado')}>
                            üìä MERCADO
                        </button>
                        <button className={`nav-tab ${activeTab === 'busqueda' ? 'active' : ''}`} onClick={() => setActiveTab('busqueda')}>
                            üîç B√öSQUEDA IA
                        </button>
                        <button className={`nav-tab ${activeTab === 'config' ? 'active' : ''}`} onClick={() => setActiveTab('config')}>
                            ‚öôÔ∏è CONFIG
                        </button>
                    </div>

                    <div className="content-panel">
                        {activeTab === 'clientes' && renderClientes()}
                        {activeTab === 'productos' && renderProductos()}
                        {activeTab === 'mercado' && renderMercado()}
                        {activeTab === 'busqueda' && renderBusquedaIA()}
                        {activeTab === 'config' && renderConfiguracion()}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
